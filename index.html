<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>CS:ROLL ‚Äî The Ultimate CSGO Experience</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Barlow:wght@300;400;500;600&family=Barlow+Condensed:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d0e12;--bg2:#13141a;--bg3:#1a1b23;--bg4:#22232e;--bg5:#2a2b38;
  --accent:#f0a500;--accent2:#ff6b35;--accent3:#00c8ff;
  --consumer:#b0c3d9;--industrial:#5e98d9;--milspec:#4b69ff;
  --restricted:#8847ff;--classified:#d32ce6;--covert:#eb4b4b;--knife:#e4ae39;
  --text:#e8e9f0;--text2:#9a9bb0;--text3:#5a5b70;
  --green:#2ecc71;--red:#e74c3c;--gold:#f1c40f;
  --sidebar:220px;--header:56px;
  --radius:8px;--radius2:12px;
  --shadow:0 4px 24px rgba(0,0,0,.5);
  font-size:15px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Barlow',sans-serif;min-height:100vh;overflow-x:hidden}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--bg2)}
::-webkit-scrollbar-thumb{background:var(--bg5);border-radius:3px}
button{cursor:pointer;border:none;outline:none;font-family:'Barlow',sans-serif}
input,select{font-family:'Barlow',sans-serif;outline:none}
a{color:inherit;text-decoration:none}
.hidden{display:none!important}
.flex{display:flex}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:8px}.gap-2{gap:12px}.gap-3{gap:20px}.wrap{flex-wrap:wrap}
.grid{display:grid}.g2{grid-template-columns:repeat(2,1fr)}.g3{grid-template-columns:repeat(3,1fr)}.g4{grid-template-columns:repeat(4,1fr)}.g5{grid-template-columns:repeat(5,1fr)}
.w-full{width:100%}.h-full{height:100%}
.p-1{padding:8px}.p-2{padding:16px}.p-3{padding:24px}.mt-1{margin-top:8px}.mt-2{margin-top:16px}.mb-1{margin-bottom:8px}
.text-sm{font-size:12px}.text-lg{font-size:18px}.text-xl{font-size:24px}.text-2xl{font-size:32px}
.font-bold{font-weight:700}.font-mono{font-family:'Barlow Condensed',sans-serif}
.rounded{border-radius:var(--radius)}.rounded-2{border-radius:var(--radius2)}
.card{background:var(--bg3);border:1px solid var(--bg5);border-radius:var(--radius2);padding:16px}
.card-dark{background:var(--bg2);border:1px solid var(--bg4);border-radius:var(--radius2)}
.btn{display:inline-flex;align-items:center;justify-content:center;padding:8px 18px;border-radius:var(--radius);font-weight:600;font-size:14px;transition:all .15s;letter-spacing:.3px}
.btn-primary{background:linear-gradient(135deg,#f0a500,#ff6b35);color:#000}
.btn-primary:hover{opacity:.9;transform:translateY(-1px);box-shadow:0 4px 16px rgba(240,165,0,.3)}
.btn-secondary{background:var(--bg4);color:var(--text);border:1px solid var(--bg5)}
.btn-secondary:hover{background:var(--bg5);border-color:var(--accent)}
.btn-green{background:#1a3a27;color:var(--green);border:1px solid #2ecc7140}
.btn-green:hover{background:#2ecc7120}
.btn-red{background:#3a1a1a;color:var(--red);border:1px solid #e74c3c40}
.btn-red:hover{background:#e74c3c20}
.btn-sm{padding:5px 12px;font-size:12px}
.btn-lg{padding:12px 28px;font-size:16px}
.tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;letter-spacing:.5px}
.badge{background:var(--accent);color:#000;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700}

/* ===== LOGIN PAGE ===== */
#login-page{position:fixed;inset:0;background:linear-gradient(135deg,#0a0b10 0%,#0d0e16 50%,#0a0c14 100%);display:flex;align-items:center;justify-content:center;z-index:9999}
#login-page::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 40% at 50% 50%,rgba(240,165,0,.06),transparent);pointer-events:none}
.login-box{background:var(--bg2);border:1px solid var(--bg5);border-radius:20px;padding:40px 48px;width:420px;max-width:95vw;position:relative;overflow:hidden}
.login-box::before{content:'';position:absolute;top:-1px;left:20%;right:20%;height:2px;background:linear-gradient(90deg,transparent,var(--accent),var(--accent2),transparent)}
.login-logo{text-align:center;margin-bottom:32px}
.login-logo .logo-text{font-family:'Rajdhani',sans-serif;font-size:38px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.login-logo .logo-sub{color:var(--text2);font-size:13px;letter-spacing:2px;margin-top:2px}
.login-tabs{display:flex;background:var(--bg4);border-radius:8px;padding:4px;margin-bottom:24px}
.login-tab{flex:1;padding:8px;text-align:center;border-radius:6px;font-weight:600;font-size:14px;cursor:pointer;transition:.2s;color:var(--text2)}
.login-tab.active{background:var(--bg2);color:var(--text);box-shadow:var(--shadow)}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:12px;color:var(--text2);margin-bottom:6px;letter-spacing:.5px;text-transform:uppercase}
.form-group input{width:100%;background:var(--bg4);border:1px solid var(--bg5);border-radius:8px;padding:10px 14px;color:var(--text);font-size:14px;transition:.2s}
.form-group input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(240,165,0,.1)}
.login-btn{width:100%;padding:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#000;font-weight:700;font-size:15px;border-radius:8px;transition:.15s;font-family:'Rajdhani',sans-serif;letter-spacing:.5px}
.login-btn:hover{opacity:.9;transform:translateY(-1px);box-shadow:0 6px 20px rgba(240,165,0,.3)}
.login-error{color:var(--red);font-size:13px;text-align:center;margin-top:12px;min-height:20px}

/* ===== MAIN LAYOUT ===== */
#app{display:flex;height:100vh;overflow:hidden}
.sidebar{width:var(--sidebar);background:var(--bg2);border-right:1px solid var(--bg4);display:flex;flex-direction:column;flex-shrink:0;overflow-y:auto;overflow-x:hidden;z-index:100}
.sidebar-logo{padding:16px 20px;border-bottom:1px solid var(--bg4);flex-shrink:0}
.sidebar-logo .brand{font-family:'Rajdhani',sans-serif;font-size:26px;font-weight:700;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.sidebar-logo .brand-sub{font-size:10px;color:var(--text3);letter-spacing:1.5px}
.sidebar-balance{padding:12px 20px;border-bottom:1px solid var(--bg4);background:var(--bg3)}
.balance-amount{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;color:var(--accent)}
.balance-label{font-size:10px;color:var(--text3);letter-spacing:1px}
.balance-xp{margin-top:8px}
.xp-bar{height:4px;background:var(--bg5);border-radius:2px;margin-top:4px;overflow:hidden}
.xp-fill{height:100%;background:linear-gradient(90deg,var(--accent3),var(--accent));border-radius:2px;transition:width .5s}
.nav-section{padding:8px 0}
.nav-label{padding:8px 20px 4px;font-size:10px;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 20px;cursor:pointer;transition:.15s;color:var(--text2);font-size:13px;font-weight:500;position:relative}
.nav-item:hover{background:var(--bg3);color:var(--text)}
.nav-item.active{background:linear-gradient(90deg,rgba(240,165,0,.1),transparent);color:var(--accent);border-right:2px solid var(--accent)}
.nav-item .nav-icon{width:18px;text-align:center;font-size:15px;flex-shrink:0}
.nav-item .nav-badge{margin-left:auto;background:var(--accent2);color:#fff;font-size:9px;padding:1px 5px;border-radius:10px;font-weight:700}
.sidebar-user{margin-top:auto;padding:12px 20px;border-top:1px solid var(--bg4);background:var(--bg2)}
.user-info{display:flex;align-items:center;gap:10px}
.user-avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:#000;flex-shrink:0}
.user-name{font-size:13px;font-weight:600}
.user-rank{font-size:11px;color:var(--text2)}
.logout-btn{margin-left:auto;background:none;color:var(--text3);font-size:18px;padding:4px;transition:.15s}
.logout-btn:hover{color:var(--red)}

/* ===== MAIN CONTENT ===== */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden}
.topbar{height:var(--header);background:var(--bg2);border-bottom:1px solid var(--bg4);display:flex;align-items:center;padding:0 20px;gap:16px;flex-shrink:0}
.topbar-title{font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;flex:1}
.topbar-stat{display:flex;align-items:center;gap:6px;padding:6px 12px;background:var(--bg3);border-radius:8px;font-size:12px}
.topbar-stat .val{font-weight:700;color:var(--accent);font-family:'Barlow Condensed',sans-serif}
.mobile-menu-btn{display:none;background:none;color:var(--text);font-size:22px;padding:4px}
.page{flex:1;overflow-y:auto;padding:20px;display:none}
.page.active{display:block}
.page-header{margin-bottom:24px}
.page-title{font-family:'Rajdhani',sans-serif;font-size:28px;font-weight:700;margin-bottom:4px}
.page-subtitle{color:var(--text2);font-size:14px}
.section-title{font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.section-title::after{content:'';flex:1;height:1px;background:var(--bg4);margin-left:8px}

/* ===== CLICKER PAGE ===== */
.click-area{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center}
.click-btn-wrap{position:relative;margin:20px 0}
.click-btn{width:200px;height:200px;border-radius:50%;background:radial-gradient(circle at 35% 35%,#2a2b38,#13141a);border:3px solid var(--accent);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:64px;transition:.08s;box-shadow:0 0 30px rgba(240,165,0,.2),0 0 60px rgba(240,165,0,.05);position:relative;overflow:hidden}
.click-btn:active{transform:scale(.94);box-shadow:0 0 50px rgba(240,165,0,.4)}
.click-btn::after{content:'';position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 50% 0%,rgba(255,255,255,.1),transparent 60%)}
.click-value{font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:700;color:var(--accent);margin-bottom:8px}
.click-cps{font-size:13px;color:var(--text2)}
.float-text{position:absolute;pointer-events:none;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:20px;color:var(--accent);animation:floatUp .8s ease-out forwards}
@keyframes floatUp{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-60px)}}
.upgrades-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-top:16px}
.upgrade-card{background:var(--bg3);border:1px solid var(--bg5);border-radius:var(--radius2);padding:14px;display:flex;gap:12px;align-items:center;cursor:pointer;transition:.15s;position:relative;overflow:hidden}
.upgrade-card:hover:not(.locked){background:var(--bg4);border-color:var(--accent)}
.upgrade-card.locked{opacity:.5;cursor:not-allowed}
.upgrade-card.owned{border-color:var(--green);}
.upgrade-icon{font-size:28px;flex-shrink:0}
.upgrade-info{flex:1}
.upgrade-name{font-weight:600;font-size:14px;margin-bottom:2px}
.upgrade-desc{font-size:11px;color:var(--text2);margin-bottom:6px}
.upgrade-cost{font-family:'Barlow Condensed',sans-serif;font-size:16px;font-weight:700;color:var(--accent)}
.upgrade-owned-badge{position:absolute;top:8px;right:8px;font-size:10px;color:var(--green);font-weight:700}
.passive-income{background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1px solid rgba(240,165,0,.2);border-radius:var(--radius2);padding:16px;text-align:center;margin-bottom:20px}

/* ===== CASES PAGE ===== */
.cases-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:16px;margin-bottom:24px}
.case-card{background:var(--bg3);border:1px solid var(--bg5);border-radius:var(--radius2);padding:14px;text-align:center;cursor:pointer;transition:.2s;position:relative;overflow:hidden}
.case-card:hover{border-color:var(--accent);transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.4)}
.case-img{font-size:52px;margin-bottom:10px;display:block;filter:drop-shadow(0 4px 8px rgba(0,0,0,.5))}
.case-name{font-size:12px;font-weight:600;margin-bottom:4px;line-height:1.3}
.case-price{font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700;color:var(--accent)}
.case-shine{position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(105deg,transparent,rgba(255,255,255,.05),transparent);transition:left .4s}
.case-card:hover .case-shine{left:140%}

/* ===== CASE OPENER ===== */
#case-modal{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:1000;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);animation:fadeIn .2s}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.case-modal-inner{background:var(--bg2);border:1px solid var(--bg4);border-radius:20px;width:90%;max-width:900px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column}
.case-modal-header{padding:16px 24px;border-bottom:1px solid var(--bg4);display:flex;align-items:center;justify-content:space-between}
.modal-close{background:none;color:var(--text2);font-size:24px;transition:.15s}
.modal-close:hover{color:var(--text)}
.case-spinner-wrap{padding:20px;position:relative}
.spinner-container{overflow:hidden;border-radius:12px;position:relative}
.spinner-container::before,.spinner-container::after{content:'';position:absolute;top:0;bottom:0;width:100px;z-index:2;pointer-events:none}
.spinner-container::before{left:0;background:linear-gradient(90deg,var(--bg2),transparent)}
.spinner-container::after{right:0;background:linear-gradient(-90deg,var(--bg2),transparent)}
.spinner-track{display:flex;gap:8px;padding:12px;transition:transform .0s;will-change:transform}
.spinner-item{flex-shrink:0;width:120px;height:140px;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;border:2px solid var(--bg5);background:var(--bg3);position:relative;overflow:hidden}
.spinner-item .item-icon{font-size:36px}
.spinner-item .item-name{font-size:10px;text-align:center;padding:0 6px;font-weight:500;line-height:1.3}
.spinner-item .item-rarity{width:100%;height:3px;position:absolute;bottom:0}
.spinner-needle{position:absolute;top:0;bottom:0;left:50%;width:2px;background:var(--accent);z-index:5;box-shadow:0 0 8px var(--accent)}
.spinner-needle::before{content:'‚ñº';position:absolute;top:-8px;left:50%;transform:translateX(-50%);color:var(--accent);font-size:14px}
.case-modal-actions{padding:16px 24px;border-top:1px solid var(--bg4);display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap}
.quantity-btn{padding:6px 14px;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;color:var(--text);font-weight:600;font-size:13px;cursor:pointer;transition:.15s}
.quantity-btn.active,.quantity-btn:hover{background:var(--accent);color:#000;border-color:var(--accent)}
.win-display{padding:24px;text-align:center;display:none;flex-direction:column;align-items:center}
.win-skin-icon{font-size:80px;margin-bottom:12px;animation:bounceIn .5s}
@keyframes bounceIn{0%{transform:scale(0.5);opacity:0}70%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
.win-skin-name{font-family:'Rajdhani',sans-serif;font-size:28px;font-weight:700;margin-bottom:4px}
.win-skin-value{font-family:'Barlow Condensed',sans-serif;font-size:32px;color:var(--accent);margin-bottom:16px}
.win-rarity-text{font-size:13px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:20px}

/* Rarity borders */
.rarity-consumer{border-color:#b0c3d9!important;color:#b0c3d9}
.rarity-industrial{border-color:#5e98d9!important;color:#5e98d9}
.rarity-milspec{border-color:#4b69ff!important;color:#4b69ff}
.rarity-restricted{border-color:#8847ff!important;color:#8847ff}
.rarity-classified{border-color:#d32ce6!important;color:#d32ce6}
.rarity-covert{border-color:#eb4b4b!important;color:#eb4b4b}
.rarity-knife{border-color:#e4ae39!important;color:#e4ae39}
.rarity-bg-consumer{background:#b0c3d940}
.rarity-bg-industrial{background:#5e98d940}
.rarity-bg-milspec{background:#4b69ff40}
.rarity-bg-restricted{background:#8847ff40}
.rarity-bg-classified{background:#d32ce640}
.rarity-bg-covert{background:#eb4b4b40}
.rarity-bg-knife{background:#e4ae3940}

/* ===== INVENTORY ===== */
.inventory-filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.filter-btn{padding:5px 12px;border-radius:6px;background:var(--bg4);border:1px solid var(--bg5);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:.15s}
.filter-btn.active,.filter-btn:hover{color:var(--text);border-color:var(--accent)}
.inv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px}
.inv-item{background:var(--bg3);border-radius:var(--radius2);overflow:hidden;cursor:pointer;transition:.2s;position:relative;border:2px solid transparent}
.inv-item:hover{transform:translateY(-2px)}
.inv-item-img{height:90px;display:flex;align-items:center;justify-content:center;font-size:40px}
.inv-item-info{padding:8px;background:var(--bg4)}
.inv-item-name{font-size:11px;font-weight:600;margin-bottom:2px;line-height:1.3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.inv-item-price{font-family:'Barlow Condensed',sans-serif;font-size:15px;font-weight:700;color:var(--accent)}
.inv-item-float{font-size:10px;color:var(--text3)}
.fav-star{position:absolute;top:6px;right:6px;color:var(--text3);font-size:14px;cursor:pointer;transition:.15s;z-index:1;background:none;padding:2px}
.fav-star.active{color:var(--gold)}
.fav-star:hover{color:var(--gold)}

/* ===== CASINO GAMES ===== */
.games-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;margin-bottom:30px}
.game-card{background:var(--bg3);border:1px solid var(--bg5);border-radius:var(--radius2);overflow:hidden;cursor:pointer;transition:.2s;position:relative}
.game-card:hover{border-color:var(--accent);transform:translateY(-3px)}
.game-card-banner{height:120px;display:flex;align-items:center;justify-content:center;font-size:52px;position:relative;overflow:hidden}
.game-card-body{padding:12px}
.game-card-name{font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;margin-bottom:2px}
.game-card-desc{font-size:12px;color:var(--text2)}
.game-panel{display:none}
.game-panel.active{display:block}

/* BLACKJACK */
.bj-table{background:radial-gradient(ellipse 100% 80% at 50% 60%,#1a3a25,#0d1f12);border-radius:20px;padding:24px;position:relative;min-height:360px;border:2px solid #2d5a1e;margin-bottom:16px}
.bj-label{font-size:12px;color:#88b87a;letter-spacing:1px;text-transform:uppercase;margin-bottom:8px;font-weight:600}
.bj-cards{display:flex;gap:-4px;flex-wrap:wrap;gap:6px;min-height:100px;align-items:center}
.card-item{width:60px;height:86px;background:white;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700;box-shadow:0 3px 10px rgba(0,0,0,.5);position:relative;flex-shrink:0}
.card-item.red{color:#c0392b}
.card-item.black{color:#111}
.card-back{background:linear-gradient(135deg,#1a3a7a,#0d1f4a);color:#5e98d9;font-size:28px}
.bj-score{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;color:#a8d8a8;margin-top:8px}
.bj-controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:16px}

/* ROULETTE */
.roulette-wrap{text-align:center;padding:20px}
.roulette-wheel{width:220px;height:220px;border-radius:50%;margin:0 auto;position:relative;border:4px solid var(--accent)}
.roulette-belt{background:var(--bg3);border-radius:12px;overflow:hidden;position:relative;margin:16px 0;height:60px;border:1px solid var(--bg5)}
.roulette-belt-inner{display:flex;height:100%;transition:transform 3s cubic-bezier(.17,.67,.12,.99)}
.roulette-num{width:50px;height:60px;display:flex;align-items:center;justify-content:center;font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;flex-shrink:0;border-right:1px solid rgba(255,255,255,.05)}
.roulette-bets{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:16px}
.roulette-bet-btn{padding:10px;border-radius:8px;font-weight:700;font-size:14px;cursor:pointer;border:2px solid transparent;transition:.15s;font-family:'Barlow Condensed',sans-serif;letter-spacing:.5px}

/* CRASH */
.crash-canvas-wrap{background:var(--bg3);border-radius:var(--radius2);overflow:hidden;position:relative;margin-bottom:16px;border:1px solid var(--bg5)}
#crash-canvas{display:block;width:100%;height:250px}
.crash-multiplier{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:'Barlow Condensed',sans-serif;font-size:64px;font-weight:700;color:var(--green);text-shadow:0 0 20px currentColor;transition:.1s}
.crash-multiplier.crashed{color:var(--red)}

/* MINES */
.mines-grid-wrap{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;max-width:340px;margin:0 auto 16px}
.mine-cell{aspect-ratio:1;background:var(--bg4);border:1px solid var(--bg5);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;transition:.15s;position:relative}
.mine-cell:hover:not(.revealed){background:var(--bg5)}
.mine-cell.revealed-safe{background:#1a3a27;border-color:#2ecc7160;animation:revealCell .2s}
.mine-cell.revealed-mine{background:#3a1a1a;border-color:#e74c3c60;animation:shakeMine .3s}
@keyframes revealCell{0%{transform:scale(.8);opacity:.5}100%{transform:scale(1);opacity:1}}
@keyframes shakeMine{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}
.mine-cell.revealed{cursor:default}

/* SLOTS */
.slots-machine{background:var(--bg3);border:2px solid var(--accent);border-radius:16px;padding:20px;max-width:400px;margin:0 auto;text-align:center}
.slots-reels{display:flex;gap:8px;justify-content:center;margin:16px 0}
.slot-reel{width:80px;height:80px;background:var(--bg2);border-radius:8px;border:2px solid var(--bg5);overflow:hidden;position:relative;font-size:40px;display:flex;align-items:center;justify-content:center}
.slot-reel.spinning{animation:spinReel .1s linear infinite}
@keyframes spinReel{0%{filter:blur(2px)}100%{filter:blur(2px)}}

/* PLINKO */
#plinko-canvas{display:block;border-radius:var(--radius2);border:1px solid var(--bg5)}

/* COINFLIP */
.coin-wrap{width:120px;height:120px;margin:20px auto;perspective:600px}
.coin{width:100%;height:100%;border-radius:50%;position:relative;transform-style:preserve-3d;transition:transform 1.5s cubic-bezier(.4,0,.2,1)}
.coin.flipping{animation:flipCoin 1.5s ease-out forwards}
@keyframes flipCoin{0%{transform:rotateY(0)}100%{transform:rotateY(1440deg)}}
.coin-face{position:absolute;inset:0;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:40px;backface-visibility:hidden}
.coin-heads{background:radial-gradient(circle,#f0a500,#c8860a);border:3px solid #e4ae39}
.coin-tails{background:radial-gradient(circle,#5e98d9,#3a6cb8);border:3px solid #4b69ff;transform:rotateY(180deg)}

/* JACKPOT */
.jackpot-pot{background:linear-gradient(135deg,#1a1200,#2a1e00);border:2px solid var(--gold);border-radius:var(--radius2);padding:20px;text-align:center;margin-bottom:16px}
.jackpot-total{font-family:'Barlow Condensed',sans-serif;font-size:48px;font-weight:700;color:var(--gold);text-shadow:0 0 20px rgba(241,196,15,.4)}
.jackpot-entries{display:flex;flex-direction:column;gap:6px;max-height:200px;overflow-y:auto}
.jackpot-entry{display:flex;align-items:center;gap:10px;padding:8px;background:var(--bg3);border-radius:8px}
.jackpot-bar{height:8px;border-radius:4px;transition:width .3s}
.jackpot-wheel{height:60px;overflow:hidden;border-radius:8px;position:relative;margin:12px 0;background:var(--bg3)}
.jackpot-strip{display:flex;height:60px;transition:transform 4s cubic-bezier(.17,.67,.12,.99)}
.jackpot-strip-seg{height:60px;display:flex;align-items:center;justify-content:center;flex-shrink:0;padding:0 20px;font-weight:700;font-size:18px}

/* ===== ROULETTE NUMBERS ===== */
.rl-red{background:#c0392b}
.rl-black{background:#1a1a1a}
.rl-green{background:#27ae60}

/* ===== STATS PAGE ===== */
.stat-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-bottom:24px}
.stat-card{background:var(--bg3);border:1px solid var(--bg5);border-radius:var(--radius2);padding:14px;text-align:center}
.stat-val{font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:700;color:var(--accent);margin-bottom:2px}
.stat-label{font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:.8px}
.profit-chart{background:var(--bg3);border:1px solid var(--bg5);border-radius:var(--radius2);padding:16px;margin-bottom:16px}
#stats-canvas{display:block;width:100%;border-radius:8px}

/* ===== HISTORY ===== */
.history-panel{background:var(--bg2);border:1px solid var(--bg4);border-radius:var(--radius2);max-height:320px;overflow-y:auto}
.history-item{display:flex;align-items:center;gap:10px;padding:8px 14px;border-bottom:1px solid var(--bg4);font-size:12px;animation:slideIn .2s}
@keyframes slideIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
.history-item:last-child{border-bottom:none}
.history-icon{font-size:18px;flex-shrink:0}
.history-desc{flex:1}
.history-val{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:15px}
.history-val.pos{color:var(--green)}
.history-val.neg{color:var(--red)}
.history-time{color:var(--text3);font-size:10px;flex-shrink:0}

/* ===== BANK ===== */
.bank-vault{background:linear-gradient(135deg,#1a1200,#0d0e12);border:2px solid #d4a30060;border-radius:20px;padding:24px;text-align:center;margin-bottom:16px}
.vault-total{font-family:'Barlow Condensed',sans-serif;font-size:52px;font-weight:700;color:var(--gold)}
.bank-stats{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:16px}
.bank-stat{background:var(--bg3);border-radius:10px;padding:12px;text-align:center}

/* ===== MARKETPLACE ===== */
.market-item{background:var(--bg3);border:1px solid var(--bg5);border-radius:var(--radius2);padding:12px;display:flex;align-items:center;gap:12px;transition:.15s}
.market-item:hover{border-color:var(--accent)}
.market-item-img{font-size:32px;flex-shrink:0}
.market-item-info{flex:1}
.market-price{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;color:var(--accent)}
.market-btn{padding:6px 14px;border-radius:6px;background:var(--accent);color:#000;font-weight:700;font-size:12px;cursor:pointer;border:none;transition:.15s}
.market-btn:hover{opacity:.85}

/* ===== BATTLE PASS ===== */
.bp-track{display:flex;gap:0;overflow-x:auto;padding-bottom:8px;margin-bottom:16px}
.bp-node{flex-shrink:0;width:90px;text-align:center;position:relative}
.bp-node::before{content:'';position:absolute;top:24px;right:-45px;left:-45px;height:2px;background:var(--bg5);z-index:0}
.bp-node:first-child::before{left:50%}
.bp-node:last-child::before{right:50%}
.bp-circle{width:48px;height:48px;border-radius:50%;background:var(--bg4);border:2px solid var(--bg5);display:flex;align-items:center;justify-content:center;font-size:22px;margin:0 auto 6px;position:relative;z-index:1}
.bp-circle.completed{background:var(--bg4);border-color:var(--accent);box-shadow:0 0 12px rgba(240,165,0,.3)}
.bp-circle.current{background:var(--accent);border-color:var(--accent);box-shadow:0 0 20px rgba(240,165,0,.4);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{box-shadow:0 0 20px rgba(240,165,0,.4)}50%{box-shadow:0 0 30px rgba(240,165,0,.6)}}
.bp-reward{font-size:9px;color:var(--text2);line-height:1.2}
.bp-label{font-size:10px;font-weight:600;margin-bottom:2px}
.bp-xp-bar{background:var(--bg5);border-radius:4px;height:6px;overflow:hidden;margin:8px 0}
.bp-xp-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:4px;transition:width .5s}

/* ===== MISSIONS ===== */
.mission-card{background:var(--bg3);border:1px solid var(--bg5);border-radius:var(--radius2);padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:14px}
.mission-icon{font-size:28px;flex-shrink:0}
.mission-info{flex:1}
.mission-name{font-weight:600;font-size:14px;margin-bottom:4px}
.mission-prog{background:var(--bg5);border-radius:4px;height:6px;overflow:hidden;margin-top:6px}
.mission-fill{height:100%;background:linear-gradient(90deg,var(--accent3),var(--accent));border-radius:4px;transition:width .5s}
.mission-reward{font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700;color:var(--accent);text-align:right}
.mission-claim-btn{padding:6px 12px;border-radius:6px;background:var(--green);color:#000;font-size:12px;font-weight:700;cursor:pointer;border:none;margin-top:4px;display:none}

/* ===== CASE BATTLES ===== */
.battle-setup{background:var(--bg3);border-radius:var(--radius2);padding:20px;margin-bottom:16px}
.battle-slots{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px}
.battle-slot{background:var(--bg4);border:2px dashed var(--bg5);border-radius:var(--radius2);padding:20px;text-align:center;min-height:150px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px}
.battle-slot.active{border-color:var(--accent);border-style:solid}
.battle-result-wrap{display:none;animation:fadeIn .3s}
.battle-result-row{display:flex;gap:16px;margin-bottom:12px;align-items:stretch}
.battle-col{flex:1;background:var(--bg3);border-radius:var(--radius2);padding:16px;text-align:center}
.battle-col.winner{border:2px solid var(--gold);background:rgba(225,190,60,.05)}
.battle-items{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-top:12px}
.battle-item{width:60px;height:80px;background:var(--bg4);border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;font-size:24px;border:1px solid var(--bg5)}
.battle-item-val{font-size:10px;color:var(--accent);font-weight:700;font-family:'Barlow Condensed',sans-serif}

/* ===== ADMIN PANEL ===== */
.admin-panel{background:linear-gradient(135deg,var(--bg2),#1a0d1a);border:1px solid #8847ff40;border-radius:var(--radius2);padding:20px;margin-bottom:16px}
.admin-title{font-family:'Rajdhani',sans-serif;font-size:22px;color:#8847ff;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.admin-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.admin-input-wrap{display:flex;gap:8px}
.admin-input{background:var(--bg4);border:1px solid var(--bg5);border-radius:8px;padding:8px 12px;color:var(--text);font-size:13px;flex:1}

/* ===== MARKET/TRADE CHARTS ===== */
.market-chart-wrap{background:var(--bg3);border:1px solid var(--bg5);border-radius:var(--radius2);padding:16px;margin-bottom:16px}

/* ===== LEADERBOARD ===== */
.lb-item{display:flex;align-items:center;gap:12px;padding:10px 14px;background:var(--bg3);border-radius:10px;margin-bottom:8px;border:1px solid var(--bg5)}
.lb-rank{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;width:32px;text-align:center;color:var(--text3)}
.lb-rank.gold{color:var(--gold)}
.lb-rank.silver{color:#aaa}
.lb-rank.bronze{color:#cd7f32}
.lb-avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;flex-shrink:0}
.lb-info{flex:1}
.lb-name{font-weight:600;font-size:14px}
.lb-val{font-size:12px;color:var(--text2)}
.lb-amount{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;color:var(--accent)}

/* ===== REBIRTH ===== */
.rebirth-card{background:linear-gradient(135deg,#1a0a00,#0d0e12);border:2px solid var(--accent2);border-radius:20px;padding:32px;text-align:center;max-width:500px;margin:0 auto}
.rebirth-flame{font-size:64px;animation:flamePulse 2s infinite}
@keyframes flamePulse{0%,100%{filter:drop-shadow(0 0 8px var(--accent2))}50%{filter:drop-shadow(0 0 20px var(--accent2))}}

/* ===== PROFILE ===== */
.profile-card{background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1px solid var(--bg5);border-radius:20px;padding:24px;margin-bottom:16px;display:flex;align-items:center;gap:20px}
.profile-avatar-lg{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:700;color:#000;flex-shrink:0;border:3px solid var(--accent)}
.rank-badge{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:20px;font-size:13px;font-weight:700;letter-spacing:.5px;margin-top:6px}

/* ===== NOTIFICATIONS ===== */
.notif-container{position:fixed;top:16px;right:16px;z-index:9000;pointer-events:none;display:flex;flex-direction:column;gap:8px;max-width:300px}
.notif{background:var(--bg3);border-left:3px solid var(--accent);border-radius:8px;padding:10px 14px;font-size:13px;box-shadow:var(--shadow);animation:notifIn .3s;pointer-events:auto}
.notif.success{border-color:var(--green)}
.notif.error{border-color:var(--red)}
.notif.rare{border-color:var(--knife);box-shadow:0 0 20px rgba(228,174,57,.3)}
@keyframes notifIn{from{opacity:0;transform:translateX(100%)}to{opacity:1;transform:translateX(0)}}
@keyframes notifOut{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(100%)}}

/* ===== SPECIAL EFFECTS ===== */
.knife-overlay{position:fixed;inset:0;z-index:5000;pointer-events:none;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.8);animation:overlayIn .3s;flex-direction:column;gap:12px}
@keyframes overlayIn{from{opacity:0}to{opacity:1}}
.knife-glow{font-size:120px;animation:knifeGlow 1s ease-out forwards,knifeFloat 3s ease-in-out infinite}
@keyframes knifeGlow{0%{filter:drop-shadow(0 0 0px gold)}100%{filter:drop-shadow(0 0 40px gold)}}
@keyframes knifeFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.knife-text{font-family:'Rajdhani',sans-serif;font-size:48px;font-weight:700;background:linear-gradient(135deg,#e4ae39,#fff,#e4ae39);-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:knifeTextGlow 1s infinite alternate;text-align:center}
@keyframes knifeTextGlow{from{filter:drop-shadow(0 0 8px gold)}to{filter:drop-shadow(0 0 20px gold)}}
.gold-particles{position:fixed;inset:0;pointer-events:none;z-index:4999;overflow:hidden}
.particle{position:absolute;width:6px;height:6px;background:var(--gold);border-radius:50%;animation:particleFly var(--dur) ease-out forwards}
@keyframes particleFly{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--tx),var(--ty)) scale(0);opacity:0}}

/* ===== LOADING / WEEKEND BANNER ===== */
.event-banner{background:linear-gradient(135deg,rgba(240,165,0,.15),rgba(255,107,53,.1));border:1px solid rgba(240,165,0,.3);border-radius:10px;padding:10px 16px;display:flex;align-items:center;gap:10px;margin-bottom:16px;font-size:13px}

/* ===== TRADE-UP / CRAFTING ===== */
.tradeup-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin:12px 0}
.tradeup-slot{aspect-ratio:1;background:var(--bg4);border:2px dashed var(--bg5);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;transition:.15s}
.tradeup-slot.filled{border-style:solid}
.tradeup-slot:hover{border-color:var(--accent)}

/* ===== SPIN WHEEL ===== */
#spin-canvas{border-radius:50%;box-shadow:0 0 40px rgba(240,165,0,.3),0 0 80px rgba(240,165,0,.1);border:3px solid rgba(240,165,0,.3)}
/* ===== UPGRADE CATEGORIES ===== */
.upgrades-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-top:16px;align-items:start}
.upgrade-cat-header{grid-column:1/-1;padding:4px 0}
/* ===== INSPECTOR ===== */
#inspect-modal[style*="flex"]{display:flex!important}

@media (max-width: 900px){
  :root{--sidebar:0px}
  .sidebar{position:fixed;left:-260px;width:260px;height:100%;transition:left .3s;z-index:500}
  .sidebar.open{left:0}
  .mobile-menu-btn{display:block}
  .sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:499}
  .sidebar-overlay.open{display:block}
  .main{width:100%}
  .cases-grid{grid-template-columns:repeat(auto-fill,minmax(130px,1fr))}
  .inv-grid{grid-template-columns:repeat(auto-fill,minmax(110px,1fr))}
  .g4{grid-template-columns:repeat(2,1fr)}
  .g5{grid-template-columns:repeat(3,1fr)}
  .battle-slots{grid-template-columns:1fr}
  .bp-track{padding-bottom:16px}
}
@media (max-width: 480px){
  .page{padding:12px}
  .bj-table{padding:12px}
  .login-box{padding:24px 20px}
  .cases-grid{grid-template-columns:repeat(auto-fill,minmax(110px,1fr))}
  .spinner-item{width:90px;height:110px}
  .case-modal-inner{width:98%;max-height:96vh}
  .crash-multiplier{font-size:42px}
}
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="login-page">
  <div class="login-box">
    <div class="login-logo">
      <div class="logo-text">CS:ROLL</div>
      <div class="logo-sub">THE ULTIMATE CSGO EXPERIENCE</div>
    </div>
    <div class="login-tabs">
      <div class="login-tab active" onclick="switchLoginTab('login')">Sign In</div>
      <div class="login-tab" onclick="switchLoginTab('register')">Register</div>
    </div>
    <div id="login-form">
      <div class="form-group"><label>Username</label><input type="text" id="login-user" placeholder="Enter username" autocomplete="username"/></div>
      <div class="form-group"><label>Password</label><input type="password" id="login-pass" placeholder="Enter password" autocomplete="current-password"/></div>
      <button class="login-btn" onclick="doLogin()">SIGN IN</button>
    </div>
    <div id="register-form" style="display:none">
      <div class="form-group"><label>Username</label><input type="text" id="reg-user" placeholder="Choose username"/></div>
      <div class="form-group"><label>Email</label><input type="email" id="reg-email" placeholder="Enter email"/></div>
      <div class="form-group"><label>Password</label><input type="password" id="reg-pass" placeholder="Choose password"/></div>
      <button class="login-btn" onclick="doRegister()">CREATE ACCOUNT</button>
    </div>
    <div class="login-error" id="auth-error"></div>
  </div>
</div>

<div id="sidebar-overlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

<!-- MAIN APP -->
<div id="app" style="display:none">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="brand">CS:ROLL</div>
      <div class="brand-sub">PREMIUM SIMULATOR</div>
    </div>
    <div class="sidebar-balance">
      <div class="balance-label">WALLET</div>
      <div class="balance-amount" id="sb-balance">$0.00</div>
      <div class="balance-xp">
        <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text3);margin-bottom:2px">
          <span id="sb-level">LVL 1</span><span id="sb-xp-text">0 / 100 XP</span>
        </div>
        <div class="xp-bar"><div class="xp-fill" id="sb-xp-bar" style="width:0%"></div></div>
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-label">Play</div>
      <div class="nav-item active" onclick="showPage('clicker')"><span class="nav-icon">üëÜ</span>Click Farm</div>
      <div class="nav-item" onclick="showPage('cases')"><span class="nav-icon">üì¶</span>Cases</div>
      <div class="nav-item" onclick="showPage('casino')"><span class="nav-icon">üé≤</span>Casino<span class="nav-badge">HOT</span></div>
      <div class="nav-item" onclick="showPage('battles')"><span class="nav-icon">‚öîÔ∏è</span>Case Battles</div>
      <div class="nav-item" onclick="showPage('jackpot')"><span class="nav-icon">üí∞</span>Jackpot</div>
      <div class="nav-item" onclick="showPage('tradeup')"><span class="nav-icon">üîÑ</span>Trade-Up</div>
    </div>
    <div class="nav-section">
      <div class="nav-label">Account</div>
      <div class="nav-item" onclick="showPage('inventory')"><span class="nav-icon">üéí</span>Inventory</div>
      <div class="nav-item" onclick="showPage('bank')"><span class="nav-icon">üè¶</span>Bank</div>
      <div class="nav-item" onclick="showPage('market')"><span class="nav-icon">üè™</span>Marketplace</div>
      <div class="nav-item" onclick="showPage('profile')"><span class="nav-icon">üë§</span>Profile</div>
    </div>
    <div class="nav-section">
      <div class="nav-label">Progress</div>
      <div class="nav-item" onclick="showPage('missions')"><span class="nav-icon">üìã</span>Missions<span class="nav-badge" id="mission-badge" style="display:none">!</span></div>
      <div class="nav-item" onclick="showPage('battlepass')"><span class="nav-icon">üé´</span>Battle Pass</div>
      <div class="nav-item" onclick="showPage('stats')"><span class="nav-icon">üìä</span>Stats</div>
      <div class="nav-item" onclick="showPage('leaderboard')"><span class="nav-icon">üèÜ</span>Leaderboard</div>
    </div>
    <div class="nav-section">
      <div class="nav-label">Settings</div>
      <div class="nav-item" onclick="showPage('settings')"><span class="nav-icon">‚öôÔ∏è</span>Settings</div>
      <div class="nav-item" onclick="openSpinModal()"><span class="nav-icon">üé°</span>Daily Spin<span class="nav-badge" id="spin-badge" style="background:var(--green)">FREE</span></div>
      <div class="nav-item" id="admin-nav" style="display:none" onclick="showPage('admin')"><span class="nav-icon">üõ°Ô∏è</span>Admin Panel</div>
    </div>
    <div class="sidebar-user">
      <div class="user-info">
        <div class="user-avatar" id="sb-avatar">?</div>
        <div>
          <div class="user-name" id="sb-username">Guest</div>
          <div class="user-rank" id="sb-rank">Silver I</div>
        </div>
        <button class="logout-btn" onclick="doLogout()" title="Logout">‚èª</button>
      </div>
    </div>
  </aside>

  <div class="main">
    <div class="topbar">
      <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
      <div class="topbar-title" id="topbar-title">Click Farm</div>
      <div class="topbar-stat"><span>üíé</span><span class="val" id="top-inv-count">0</span><span>items</span></div>
      <div class="topbar-stat"><span>üèÜ</span><span class="val" id="top-rank">S1</span></div>
      <div class="topbar-stat" id="weekend-stat" style="display:none;border-color:rgba(240,165,0,.4)"><span>üçÄ</span><span class="val" style="color:var(--gold)">2x LUCK</span></div>
      <div class="topbar-stat" id="streak-stat" style="display:none;border-color:rgba(235,75,75,.4)"><span>üî•</span><span class="val" id="streak-val" style="color:#eb4b4b">0</span></div>
    </div>

    <!-- CLICKER PAGE -->
    <div class="page active" id="page-clicker">
      <div id="weekend-banner" class="event-banner hidden"><span>üçÄ</span><b style="color:var(--gold)">Weekend Bonus Active!</b> ‚Äî 2x Luck on all case openings until Sunday midnight</div>
      <div class="flex gap-3">
        <div style="flex:1">
          <div class="click-area">
            <div class="passive-income">
              <div style="font-size:11px;color:var(--text2);letter-spacing:1px;margin-bottom:4px">PASSIVE INCOME</div>
              <div style="font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:700;color:var(--accent3)" id="cps-display">$0.00/s</div>
            </div>
            <div class="click-btn-wrap">
              <button class="click-btn" id="click-btn" onclick="doClick(event)">üí∞</button>
            </div>
            <div class="click-value" id="click-val-display">+$0.01 per click</div>
            <div class="click-cps" id="total-clicks-display">0 total clicks</div>
          </div>
        </div>
        <div style="width:320px;flex-shrink:0" class="hidden-mobile">
          <div class="section-title">üìú History</div>
          <div class="history-panel" id="history-panel"></div>
        </div>
      </div>
      <div class="section-title">‚¨ÜÔ∏è Upgrades</div>
      <div class="upgrades-grid" id="upgrades-grid"></div>
      <div class="section-title mt-2">üîÅ Rebirth</div>
      <div class="rebirth-card">
        <div class="rebirth-flame">üî•</div>
        <div style="font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;color:var(--accent2);margin:8px 0">REBIRTH SYSTEM</div>
        <div style="color:var(--text2);font-size:13px;margin-bottom:16px">Reset your progress for a permanent <b style="color:var(--accent2)">+25% luck boost</b> and special Rebirth badge! You keep your inventory.</div>
        <div style="font-family:'Barlow Condensed',sans-serif;font-size:14px;color:var(--text3);margin-bottom:12px">Rebirths: <span id="rebirth-count" style="color:var(--accent2)">0</span> ‚Äî Luck Bonus: <span id="rebirth-luck" style="color:var(--green)">+0%</span></div>
        <button class="btn btn-primary btn-lg" onclick="doRebirth()">üî• REBIRTH (Requires $100,000)</button>
      </div>
    </div>

    <!-- CASES PAGE -->
    <div class="page" id="page-cases">
      <div class="page-header">
        <div class="page-title">üì¶ Cases</div>
        <div class="page-subtitle">Open cases to win rare skins. Same odds as real CS:GO!</div>
      </div>
      <div id="weekend-banner2" class="event-banner hidden"><span>üçÄ</span><b style="color:var(--gold)">Weekend Bonus Active!</b> ‚Äî 2x Luck on all case openings!</div>
      <div class="section-title">üéÅ CSGO Cases</div>
      <div class="cases-grid" id="cases-grid"></div>
    </div>

    <!-- CASINO PAGE -->
    <div class="page" id="page-casino">
      <div class="page-header">
        <div class="page-title">üé≤ Casino</div>
        <div class="page-subtitle">Play fair simulated casino games</div>
      </div>
      <div id="casino-hub">
        <div class="games-grid" id="games-grid"></div>
      </div>
      <!-- Blackjack -->
      <div id="game-blackjack" class="game-panel">
        <button class="btn btn-secondary btn-sm mb-1" onclick="showCasinoHub()">‚Üê Back</button>
        <div class="page-title" style="margin-bottom:16px">üÉè Blackjack</div>
        <div class="bj-table">
          <div class="bj-label">Dealer</div>
          <div class="bj-cards" id="dealer-cards"></div>
          <div class="bj-score" id="dealer-score">?</div>
          <div style="position:absolute;bottom:24px;left:24px;right:24px">
            <div class="bj-label">Your Hand</div>
            <div class="bj-cards" id="player-cards"></div>
            <div class="bj-score" id="player-score">0</div>
          </div>
        </div>
        <div class="flex items-center justify-center gap-2 mb-1">
          <div style="font-size:13px;color:var(--text2)">Bet:</div>
          <input type="number" id="bj-bet" value="10" min="1" style="width:90px;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:6px 10px;color:var(--text)">
          <button class="btn btn-secondary btn-sm" onclick="setBet('bj-bet',0.5)">¬Ω</button>
          <button class="btn btn-secondary btn-sm" onclick="setBet('bj-bet',2)">2√ó</button>
          <button class="btn btn-secondary btn-sm" onclick="setBetMax('bj-bet')">Max</button>
        </div>
        <div class="bj-controls">
          <button class="btn btn-primary btn-lg" id="bj-deal" onclick="bjDeal()">üÉè Deal</button>
          <button class="btn btn-green" id="bj-hit" onclick="bjHit()" style="display:none">Hit</button>
          <button class="btn btn-secondary" id="bj-stand" onclick="bjStand()" style="display:none">Stand</button>
          <button class="btn btn-secondary" id="bj-double" onclick="bjDouble()" style="display:none">Double Down</button>
        </div>
        <div id="bj-result" style="text-align:center;margin-top:16px;font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;min-height:30px"></div>
      </div>
      <!-- Roulette -->
      <div id="game-roulette" class="game-panel">
        <button class="btn btn-secondary btn-sm mb-1" onclick="showCasinoHub()">‚Üê Back</button>
        <div class="page-title" style="margin-bottom:16px">üéØ Roulette</div>
        <div class="roulette-wrap">
          <div class="roulette-belt">
            <div class="roulette-belt-inner" id="rl-belt"></div>
          </div>
          <div style="width:3px;height:60px;background:var(--accent);position:absolute;top:0;bottom:0;margin:auto 0;left:50%;transform:translateX(-50%);z-index:5;pointer-events:none"></div>
          <div class="flex items-center justify-center gap-2 mb-1 mt-2">
            <div style="font-size:13px;color:var(--text2)">Bet:</div>
            <input type="number" id="rl-bet" value="10" min="1" style="width:90px;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:6px 10px;color:var(--text)">
            <button class="btn btn-secondary btn-sm" onclick="setBet('rl-bet',0.5)">¬Ω</button>
            <button class="btn btn-secondary btn-sm" onclick="setBet('rl-bet',2)">2√ó</button>
          </div>
          <div class="roulette-bets">
            <button class="roulette-bet-btn rl-red" style="background:#c0392b;color:white;border-color:#c0392b" onclick="rlBet('red')">üî¥ RED 2√ó</button>
            <button class="roulette-bet-btn rl-green" style="background:#27ae60;color:white;border-color:#27ae60" onclick="rlBet('green')">üü¢ GREEN 14√ó</button>
            <button class="roulette-bet-btn rl-black" style="background:#2a2b38;color:white;border:2px solid #555" onclick="rlBet('black')">‚ö´ BLACK 2√ó</button>
          </div>
          <div id="rl-result" style="text-align:center;margin-top:12px;font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;min-height:30px"></div>
        </div>
      </div>
      <!-- Crash -->
      <div id="game-crash" class="game-panel">
        <button class="btn btn-secondary btn-sm mb-1" onclick="showCasinoHub()">‚Üê Back</button>
        <div class="page-title" style="margin-bottom:16px">üöÄ Crash</div>
        <div class="crash-canvas-wrap">
          <canvas id="crash-canvas" width="800" height="250"></canvas>
          <div class="crash-multiplier" id="crash-mult">1.00√ó</div>
        </div>
        <div class="flex items-center justify-center gap-2 mb-2">
          <div style="font-size:13px;color:var(--text2)">Bet:</div>
          <input type="number" id="crash-bet" value="10" min="1" style="width:90px;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:6px 10px;color:var(--text)">
          <div style="font-size:13px;color:var(--text2)">Auto Cash-out:</div>
          <input type="number" id="crash-auto" value="2" step="0.1" min="1.1" style="width:80px;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:6px 10px;color:var(--text)">
        </div>
        <div style="text-align:center;display:flex;gap:12px;justify-content:center">
          <button class="btn btn-primary btn-lg" id="crash-bet-btn" onclick="crashBet()">üöÄ Place Bet</button>
          <button class="btn btn-green btn-lg" id="crash-cashout-btn" onclick="crashCashout()" style="display:none">üí∞ Cash Out</button>
        </div>
        <div id="crash-result" style="text-align:center;margin-top:12px;font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;min-height:28px"></div>
      </div>
      <!-- Mines -->
      <div id="game-mines" class="game-panel">
        <button class="btn btn-secondary btn-sm mb-1" onclick="showCasinoHub()">‚Üê Back</button>
        <div class="page-title" style="margin-bottom:16px">üí£ Mines</div>
        <div class="flex items-center justify-center gap-3 mb-2 flex-wrap">
          <div class="flex items-center gap-2">
            <span style="font-size:13px;color:var(--text2)">Bet:</span>
            <input type="number" id="mines-bet" value="10" min="1" style="width:90px;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:6px 10px;color:var(--text)">
          </div>
          <div class="flex items-center gap-2">
            <span style="font-size:13px;color:var(--text2)">Mines:</span>
            <select id="mines-count" style="background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:6px;color:var(--text)">
              <option value="1">1</option><option value="3">3</option><option value="5" selected>5</option>
              <option value="10">10</option><option value="15">15</option>
            </select>
          </div>
          <button class="btn btn-primary" id="mines-start-btn" onclick="minesStart()">üí£ Start Game</button>
          <button class="btn btn-green" id="mines-cashout-btn" onclick="minesCashout()" style="display:none">üí∞ Cash Out <span id="mines-mult">1.00√ó</span></button>
        </div>
        <div class="mines-grid-wrap" id="mines-grid"></div>
        <div id="mines-result" style="text-align:center;margin-top:8px;font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;min-height:28px"></div>
      </div>
      <!-- Slots -->
      <div id="game-slots" class="game-panel">
        <button class="btn btn-secondary btn-sm mb-1" onclick="showCasinoHub()">‚Üê Back</button>
        <div class="page-title" style="margin-bottom:16px">üé∞ Slots</div>
        <div class="slots-machine">
          <div style="font-family:'Rajdhani',sans-serif;font-size:16px;color:var(--text2);letter-spacing:1px;margin-bottom:8px">JACKPOT SLOTS</div>
          <div class="slots-reels" id="slots-reels">
            <div class="slot-reel" id="reel-0">üçí</div>
            <div class="slot-reel" id="reel-1">üçã</div>
            <div class="slot-reel" id="reel-2">üçá</div>
          </div>
          <div id="slots-result" style="font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;min-height:28px;margin-bottom:12px"></div>
          <div class="flex items-center justify-center gap-2 mb-2">
            <span style="font-size:13px;color:var(--text2)">Bet:</span>
            <input type="number" id="slots-bet" value="5" min="1" style="width:80px;background:var(--bg2);border:1px solid var(--bg5);border-radius:6px;padding:6px;color:var(--text)">
          </div>
          <button class="btn btn-primary btn-lg w-full" id="slots-spin-btn" onclick="slotsPlay()">üé∞ SPIN</button>
        </div>
        <div style="margin-top:16px;background:var(--bg3);border-radius:10px;padding:14px">
          <div class="section-title" style="font-size:14px">Paytable</div>
          <div class="grid g2 gap-1 mt-1" style="font-size:12px">
            <div>üíéüíéüíé = 100√ó</div><div>7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£ = 50√ó</div>
            <div>üçíüçíüçí = 20√ó</div><div>üçãüçãüçã = 15√ó</div>
            <div>üçáüçáüçá = 12√ó</div><div>üîîüîîüîî = 10√ó</div>
            <div>‚≠ê‚≠ê‚≠ê = 8√ó</div><div>Any 3 match = 5√ó</div>
          </div>
        </div>
      </div>
      <!-- Plinko -->
      <div id="game-plinko" class="game-panel">
        <button class="btn btn-secondary btn-sm mb-1" onclick="showCasinoHub()">‚Üê Back</button>
        <div class="page-title" style="margin-bottom:16px">üîµ Plinko</div>
        <div class="flex items-center justify-center gap-2 mb-2">
          <span style="font-size:13px;color:var(--text2)">Bet:</span>
          <input type="number" id="plinko-bet" value="10" min="1" style="width:90px;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:6px 10px;color:var(--text)">
          <button class="btn btn-primary" onclick="plinkoDrop()">Drop Ball</button>
        </div>
        <div style="text-align:center">
          <canvas id="plinko-canvas" width="400" height="380" style="max-width:100%"></canvas>
        </div>
        <div id="plinko-result" style="text-align:center;margin-top:8px;font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;min-height:28px"></div>
      </div>
      <!-- Coinflip -->
      <div id="game-coinflip" class="game-panel">
        <button class="btn btn-secondary btn-sm mb-1" onclick="showCasinoHub()">‚Üê Back</button>
        <div class="page-title" style="margin-bottom:16px">ü™ô Coinflip</div>
        <div style="text-align:center">
          <div class="coin-wrap"><div class="coin" id="coin">
            <div class="coin-face coin-heads">üî∂</div>
            <div class="coin-face coin-tails">üî∑</div>
          </div></div>
          <div class="flex items-center justify-center gap-2 mb-2">
            <span style="font-size:13px;color:var(--text2)">Bet:</span>
            <input type="number" id="cf-bet" value="10" min="1" style="width:90px;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:6px 10px;color:var(--text)">
          </div>
          <div class="flex gap-3 justify-center mt-2">
            <button class="btn btn-lg" style="background:#c0392b;color:white" onclick="coinflip('heads')">üî∂ CT (Heads)</button>
            <button class="btn btn-lg" style="background:#1a3a7a;color:white" onclick="coinflip('tails')">üî∑ T (Tails)</button>
          </div>
          <div id="cf-result" style="margin-top:16px;font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;min-height:30px"></div>
        </div>
      </div>
    </div>

    <!-- CASE BATTLES PAGE -->
    <div class="page" id="page-battles">
      <div class="page-header">
        <div class="page-title">‚öîÔ∏è Case Battles</div>
        <div class="page-subtitle">Battle other players ‚Äî highest skin wins everything!</div>
      </div>
      <div class="card mb-2">
        <div class="section-title">Create Battle</div>
        <div class="flex gap-2 flex-wrap mb-2">
          <select id="battle-case-select" style="background:var(--bg4);border:1px solid var(--bg5);border-radius:8px;padding:8px 12px;color:var(--text);flex:1">
          </select>
          <select id="battle-mode" style="background:var(--bg4);border:1px solid var(--bg5);border-radius:8px;padding:8px 12px;color:var(--text)">
            <option value="1v1">1v1</option>
            <option value="2v2">2v2</option>
            <option value="ffa4">FFA (4 players)</option>
          </select>
          <select id="battle-rounds" style="background:var(--bg4);border:1px solid var(--bg5);border-radius:8px;padding:8px 12px;color:var(--text)">
            <option value="1">1 Case</option>
            <option value="3" selected>3 Cases</option>
            <option value="5">5 Cases</option>
          </select>
          <button class="btn btn-primary" onclick="startBattle()">‚öîÔ∏è Start Battle</button>
        </div>
      </div>
      <div id="battle-result-wrap" class="battle-result-wrap"></div>
      <div class="section-title">Active Battles</div>
      <div id="battle-list" class="grid g2 gap-2"></div>
    </div>

    <!-- JACKPOT PAGE -->
    <div class="page" id="page-jackpot">
      <div class="page-header">
        <div class="page-title">üí∞ Jackpot</div>
        <div class="page-subtitle">Enter cash ‚Äî random winner takes the pot!</div>
      </div>
      <div class="jackpot-pot">
        <div style="font-size:12px;color:var(--text2);letter-spacing:1px;margin-bottom:4px">CURRENT POT</div>
        <div class="jackpot-total" id="jp-total">$0.00</div>
        <div style="font-size:12px;color:var(--text2);margin-top:4px" id="jp-players-count">0 players</div>
      </div>
      <div class="jackpot-wheel" id="jp-wheel-wrap" style="display:none">
        <div class="jackpot-strip" id="jp-strip"></div>
      </div>
      <div class="flex gap-2 items-center mb-2">
        <input type="number" id="jp-bet-input" value="50" min="1" style="flex:1;background:var(--bg4);border:1px solid var(--bg5);border-radius:8px;padding:10px 14px;color:var(--text);font-size:14px">
        <button class="btn btn-primary" onclick="jpEnter()">Enter Jackpot</button>
        <button class="btn btn-secondary" id="jp-spin-btn" onclick="jpSpin()">üé∞ Spin</button>
      </div>
      <div id="jp-result" style="text-align:center;font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;min-height:28px;margin-bottom:12px"></div>
      <div class="section-title">Entries</div>
      <div class="jackpot-entries" id="jp-entries"></div>
    </div>

    <!-- TRADE-UP PAGE -->
    <div class="page" id="page-tradeup">
      <div class="page-header">
        <div class="page-title">üîÑ Trade-Up Contract</div>
        <div class="page-subtitle">Combine 10 skins of the same rarity for a chance at higher tier!</div>
      </div>
      <div class="card">
        <div class="section-title">Select 10 Skins</div>
        <div class="tradeup-grid" id="tradeup-grid"></div>
        <div style="text-align:center;margin-top:16px">
          <div id="tradeup-info" style="color:var(--text2);font-size:13px;margin-bottom:12px">Select 10 skins of the same rarity to proceed</div>
          <button class="btn btn-primary btn-lg" onclick="doTradeup()">üîÑ Execute Trade-Up</button>
        </div>
      </div>
      <div id="tradeup-result" style="text-align:center;margin-top:16px;font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;min-height:28px"></div>
    </div>

    <!-- INVENTORY PAGE -->
    <div class="page" id="page-inventory">
      <div class="page-header">
        <div class="page-title">üéí Inventory</div>
        <div class="page-subtitle">All your skins ‚Äî filter, sort, favorite, and sell!</div>
      </div>
      <div class="inventory-filters" id="inv-filters">
        <button class="filter-btn active" onclick="invFilter('all')">All</button>
        <button class="filter-btn" onclick="invFilter('consumer')" style="color:var(--consumer)">Consumer</button>
        <button class="filter-btn" onclick="invFilter('industrial')" style="color:var(--industrial)">Industrial</button>
        <button class="filter-btn" onclick="invFilter('milspec')" style="color:var(--milspec)">Mil-Spec</button>
        <button class="filter-btn" onclick="invFilter('restricted')" style="color:var(--restricted)">Restricted</button>
        <button class="filter-btn" onclick="invFilter('classified')" style="color:var(--classified)">Classified</button>
        <button class="filter-btn" onclick="invFilter('covert')" style="color:var(--covert)">Covert</button>
        <button class="filter-btn" onclick="invFilter('knife')" style="color:var(--knife)">‚òÖ Knife/Rare</button>
        <button class="filter-btn" onclick="invFilter('favorites')" style="color:var(--gold)">‚≠ê Favorites</button>
        <select id="inv-sort" onchange="invSort(this.value)" style="margin-left:auto;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:5px 10px;color:var(--text);font-size:12px">
          <option value="date">Newest</option>
          <option value="price-h">Price ‚Üì</option>
          <option value="price-l">Price ‚Üë</option>
          <option value="rarity">Rarity</option>
        </select>
      </div>
      <div style="margin-bottom:12px;display:flex;justify-content:space-between;align-items:center">
        <div style="font-size:13px;color:var(--text2)">Total value: <span style="color:var(--accent);font-weight:700;font-family:'Barlow Condensed',sans-serif" id="inv-total-val">$0.00</span></div>
        <button class="btn btn-red btn-sm" onclick="sellAll()">Sell All</button>
      </div>
      <div class="inv-grid" id="inventory-grid"></div>
    </div>

    <!-- BANK PAGE -->
    <div class="page" id="page-bank">
      <div class="page-header">
        <div class="page-title">üè¶ Bank</div>
        <div class="page-subtitle">Store money, earn interest, and manage loans</div>
      </div>
      <div class="bank-vault">
        <div style="font-size:11px;color:#d4a300;letter-spacing:1px;margin-bottom:4px">VAULT BALANCE</div>
        <div class="vault-total" id="bank-total">$0.00</div>
        <div style="color:#d4a30080;font-size:12px;margin-top:4px">Interest: 2% daily | Loan Rate: 10% daily</div>
      </div>
      <div class="grid g2 gap-2 mb-2">
        <div class="card">
          <div style="font-size:13px;color:var(--text2);margin-bottom:8px">üí∞ Deposit</div>
          <div class="flex gap-2">
            <input type="number" id="deposit-amount" placeholder="Amount" style="flex:1;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:8px;color:var(--text)">
            <button class="btn btn-green" onclick="bankDeposit()">Deposit</button>
          </div>
        </div>
        <div class="card">
          <div style="font-size:13px;color:var(--text2);margin-bottom:8px">üí∏ Withdraw</div>
          <div class="flex gap-2">
            <input type="number" id="withdraw-amount" placeholder="Amount" style="flex:1;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:8px;color:var(--text)">
            <button class="btn btn-red" onclick="bankWithdraw()">Withdraw</button>
          </div>
        </div>
      </div>
      <div class="card mb-2">
        <div style="font-size:13px;color:var(--text2);margin-bottom:8px">‚ö†Ô∏è Loan (High Risk ‚Äî 10% daily interest)</div>
        <div class="flex gap-2 flex-wrap">
          <input type="number" id="loan-amount" placeholder="Loan amount" style="flex:1;min-width:120px;background:var(--bg4);border:1px solid var(--bg5);border-radius:6px;padding:8px;color:var(--text)">
          <button class="btn btn-secondary" onclick="takeLoan()">Take Loan</button>
          <button class="btn btn-red" onclick="repayLoan()">Repay Loan</button>
        </div>
        <div style="margin-top:8px;font-size:12px;color:var(--text3)">Outstanding loan: <span id="loan-display" style="color:var(--red);font-weight:700">$0.00</span></div>
      </div>
      <div class="section-title">üè¶ Locked Skins</div>
      <div id="bank-skins" class="inv-grid"></div>
    </div>

    <!-- MARKETPLACE PAGE -->
    <div class="page" id="page-market">
      <div class="page-header">
        <div class="page-title">üè™ Marketplace</div>
        <div class="page-subtitle">Buy and sell skins with dynamic pricing</div>
      </div>
      <div class="market-chart-wrap">
        <div style="font-size:13px;color:var(--text2);margin-bottom:8px">üìà Market Trend</div>
        <canvas id="market-canvas" width="600" height="100" style="width:100%;display:block"></canvas>
      </div>
      <div class="flex gap-2 mb-2">
        <input type="text" id="market-search" placeholder="üîç Search skins..." onkeyup="renderMarket()" style="flex:1;background:var(--bg4);border:1px solid var(--bg5);border-radius:8px;padding:9px 14px;color:var(--text);font-size:13px">
        <select id="market-sort" onchange="renderMarket()" style="background:var(--bg4);border:1px solid var(--bg5);border-radius:8px;padding:9px;color:var(--text)">
          <option value="popular">Popular</option>
          <option value="price-h">Price ‚Üì</option>
          <option value="price-l">Price ‚Üë</option>
        </select>
      </div>
      <div id="market-list" style="display:flex;flex-direction:column;gap:8px"></div>
    </div>

    <!-- PROFILE PAGE -->
    <div class="page" id="page-profile">
      <div class="page-header">
        <div class="page-title">üë§ Profile</div>
      </div>
      <div class="profile-card">
        <div class="profile-avatar-lg" id="profile-avatar">?</div>
        <div style="flex:1">
          <div style="font-family:'Rajdhani',sans-serif;font-size:26px;font-weight:700" id="profile-name">Username</div>
          <div class="rank-badge" id="profile-rank-badge" style="background:rgba(107,107,255,.15);color:var(--milspec)">üèÖ Silver I</div>
          <div style="margin-top:8px;font-size:13px;color:var(--text2)">Member since: <span id="profile-since" style="color:var(--text)">Today</span></div>
          <div style="margin-top:4px;font-size:13px;color:var(--text2)">Rebirths: <span id="profile-rebirths" style="color:var(--accent2)">0</span></div>
        </div>
      </div>
      <div class="card mb-2">
        <div class="section-title">Level Progress</div>
        <div class="flex justify-between items-center mb-1">
          <div style="font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;color:var(--accent3)" id="profile-level">Level 1</div>
          <div style="font-size:13px;color:var(--text2)" id="profile-xp-text">0 / 100 XP</div>
        </div>
        <div class="xp-bar" style="height:8px"><div class="xp-fill" id="profile-xp-bar" style="width:0%"></div></div>
      </div>
      <div class="section-title">üèÜ Achievements</div>
      <div id="achievements-grid" class="grid g2 gap-2"></div>
    </div>

    <!-- MISSIONS PAGE -->
    <div class="page" id="page-missions">
      <div class="page-header">
        <div class="page-title">üìã Missions & Achievements</div>
      </div>
      <div class="section-title">Daily Missions</div>
      <div id="daily-missions"></div>
      <div class="section-title mt-2">Weekly Missions</div>
      <div id="weekly-missions"></div>
    </div>

    <!-- BATTLE PASS PAGE -->
    <div class="page" id="page-battlepass">
      <div class="page-header">
        <div class="page-title">üé´ Battle Pass</div>
        <div class="page-subtitle">Free and Premium tiers ‚Äî earn XP to unlock rewards</div>
      </div>
      <div class="card mb-2">
        <div class="flex justify-between items-center mb-1">
          <div>
            <div style="font-size:12px;color:var(--text2);letter-spacing:1px">BATTLE PASS LEVEL</div>
            <div style="font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:700;color:var(--accent)" id="bp-level-display">1</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:12px;color:var(--text2)">XP Progress</div>
            <div style="font-family:'Barlow Condensed',sans-serif;font-size:16px;color:var(--text)" id="bp-xp-display">0 / 500</div>
          </div>
        </div>
        <div class="bp-xp-bar"><div class="bp-xp-fill" id="bp-xp-bar" style="width:0%"></div></div>
      </div>
      <div class="bp-track" id="bp-track"></div>
      <div id="premium-upgrade" style="text-align:center;margin-top:16px">
        <button class="btn btn-primary btn-lg" onclick="upgradeToPremium()">‚≠ê Upgrade to Premium ‚Äî $9.99</button>
        <div style="font-size:12px;color:var(--text2);margin-top:6px">(Simulated ‚Äî free in this game!)</div>
      </div>
    </div>

    <!-- STATS PAGE -->
    <div class="page" id="page-stats">
      <div class="page-header">
        <div class="page-title">üìä Statistics</div>
      </div>
      <div class="stat-cards" id="stat-cards"></div>
      <div class="profit-chart">
        <div class="section-title">Net Worth Over Time</div>
        <canvas id="stats-canvas" height="150"></canvas>
      </div>
      <div class="section-title">üìú Recent Activity</div>
      <div class="history-panel" id="stats-history"></div>
    </div>

    <!-- LEADERBOARD PAGE -->
    <div class="page" id="page-leaderboard">
      <div class="page-header">
        <div class="page-title">üèÜ Leaderboard</div>
      </div>
      <div class="flex gap-2 mb-2">
        <button class="filter-btn active" onclick="showLB('wealth')">Wealthiest</button>
        <button class="filter-btn" onclick="showLB('opens')">Most Opens</button>
        <button class="filter-btn" onclick="showLB('wins')">Casino Wins</button>
      </div>
      <div id="leaderboard-list"></div>
    </div>

    <!-- SETTINGS PAGE -->
    <div class="page" id="page-settings">
      <div class="page-header">
        <div class="page-title">‚öôÔ∏è Settings</div>
      </div>
      <div class="card mb-2">
        <div class="section-title">Sound</div>
        <div class="flex items-center gap-3 mb-1">
          <span style="font-size:13px">Sound Effects</span>
          <label style="position:relative;display:inline-block;width:44px;height:24px;flex-shrink:0">
            <input type="checkbox" id="sfx-toggle" checked onchange="toggleSFX()" style="opacity:0;width:0;height:0">
            <span style="position:absolute;cursor:pointer;inset:0;background:var(--bg5);border-radius:24px;transition:.3s"></span>
            <span id="sfx-knob" style="position:absolute;content:'';height:18px;width:18px;left:3px;bottom:3px;background:var(--accent);border-radius:50%;transition:.3s;transform:translateX(0)"></span>
          </label>
        </div>
      </div>
      <div class="card mb-2">
        <div class="section-title">Display</div>
        <div class="flex gap-2 mb-1">
          <button class="btn btn-secondary" onclick="setTheme('dark')" id="theme-dark">üåô Dark</button>
          <button class="btn btn-secondary" onclick="setTheme('light')" id="theme-light">‚òÄÔ∏è Light</button>
        </div>
      </div>
      <div class="card">
        <div class="section-title">Account</div>
        <div style="font-size:13px;color:var(--text2);margin-bottom:8px">Reset all data (can't undo!)</div>
        <button class="btn btn-red" onclick="resetAllData()">üóëÔ∏è Reset Account</button>
      </div>
    </div>

    <!-- ADMIN PAGE -->
    <div class="page" id="page-admin">
      <div class="page-header">
        <div class="page-title" style="color:#8847ff">üõ°Ô∏è Admin Panel</div>
      </div>
      <div class="admin-panel">
        <div class="admin-title">üõ°Ô∏è Economy Controls</div>
        <div class="admin-grid">
          <div class="card-dark p-2 rounded-2">
            <div style="font-size:12px;color:var(--text2);margin-bottom:6px">Add Balance</div>
            <div class="admin-input-wrap">
              <input type="number" class="admin-input" id="admin-balance" value="1000">
              <button class="btn btn-primary btn-sm" onclick="adminAddBalance()">Add</button>
            </div>
          </div>
          <div class="card-dark p-2 rounded-2">
            <div style="font-size:12px;color:var(--text2);margin-bottom:6px">Add XP</div>
            <div class="admin-input-wrap">
              <input type="number" class="admin-input" id="admin-xp" value="500">
              <button class="btn btn-primary btn-sm" onclick="adminAddXP()">Add</button>
            </div>
          </div>
          <div class="card-dark p-2 rounded-2">
            <div style="font-size:12px;color:var(--text2);margin-bottom:6px">Spawn Skin</div>
            <div class="admin-input-wrap">
              <select class="admin-input" id="admin-skin-rarity">
                <option value="consumer">Consumer</option>
                <option value="industrial">Industrial</option>
                <option value="milspec">Mil-Spec</option>
                <option value="restricted">Restricted</option>
                <option value="classified">Classified</option>
                <option value="covert">Covert</option>
                <option value="knife">Knife ‚òÖ</option>
              </select>
              <button class="btn btn-primary btn-sm" onclick="adminSpawnSkin()">Spawn</button>
            </div>
          </div>
          <div class="card-dark p-2 rounded-2">
            <div style="font-size:12px;color:var(--text2);margin-bottom:6px">Set Level</div>
            <div class="admin-input-wrap">
              <input type="number" class="admin-input" id="admin-level" value="50" min="1">
              <button class="btn btn-primary btn-sm" onclick="adminSetLevel()">Set</button>
            </div>
          </div>
          <div class="card-dark p-2 rounded-2">
            <div style="font-size:12px;color:var(--text2);margin-bottom:6px">Toggle 2x Luck</div>
            <button class="btn btn-primary" onclick="adminToggleLuck()">Toggle 2√ó Luck</button>
          </div>
          <div class="card-dark p-2 rounded-2">
            <div style="font-size:12px;color:var(--text2);margin-bottom:6px">Max Upgrades</div>
            <button class="btn btn-primary" onclick="adminMaxUpgrades()">Buy All Upgrades</button>
          </div>
        </div>
      </div>
    </div>

  </div><!-- .main -->
</div><!-- #app -->

<!-- CASE OPENING MODAL -->
<div id="case-modal" style="display:none">
  <div class="case-modal-inner">
    <div class="case-modal-header">
      <div style="font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700" id="modal-case-name">Case</div>
      <button class="modal-close" onclick="closeCase()">‚úï</button>
    </div>
    <div class="case-spinner-wrap" id="spinner-section">
      <div class="spinner-container" id="spinner-container">
        <div class="spinner-track" id="spinner-track"></div>
        <div class="spinner-needle"></div>
      </div>
    </div>
    <div class="win-display" id="win-display">
      <div id="win-icon" style="width:200px;height:140px;overflow:hidden;border-radius:12px;margin-bottom:12px;border:2px solid transparent" class="rarity-consumer"></div>
      <div class="win-skin-name" id="win-name">Skin Name</div>
      <div class="win-rarity-text" id="win-rarity">Covert</div>
      <div class="win-skin-value" id="win-value">$0.00</div>
      <div class="flex gap-2">
        <button class="btn btn-green" onclick="addWinToInventory()">‚úì Keep</button>
        <button class="btn btn-red" onclick="sellWin()">üí∞ Sell</button>
      </div>
    </div>
    <div class="case-modal-actions" id="modal-actions">
      <div class="flex gap-1 items-center">
        <span style="font-size:12px;color:var(--text2)">Qty:</span>
        <button class="quantity-btn active" onclick="setOpenQty(1)">√ó1</button>
        <button class="quantity-btn" onclick="setOpenQty(3)">√ó3</button>
        <button class="quantity-btn" onclick="setOpenQty(5)">√ó5</button>
        <button class="quantity-btn" onclick="setOpenQty(10)">√ó10</button>
      </div>
      <button class="btn btn-primary btn-lg" id="open-btn" onclick="openCase()">üîì Open Case</button>
      <div id="case-cost-display" style="font-size:13px;color:var(--text2)"></div>
    </div>
  </div>
</div>

<!-- SKIN INSPECT MODAL -->
<div id="inspect-modal" style="position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:2000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(6px)"
  onclick="if(event.target===this)closeInspect()">
  <div style="background:var(--bg2);border-radius:20px;width:90%;max-width:520px;overflow:hidden;border:1px solid var(--bg5)">
    <div style="padding:16px 20px;border-bottom:1px solid var(--bg4);display:flex;align-items:center;justify-content:space-between">
      <div style="font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700" id="inspect-title">Inspect</div>
      <button onclick="closeInspect()" style="background:none;color:var(--text2);font-size:22px;cursor:pointer">‚úï</button>
    </div>
    <div style="padding:0;background:#0d0e14;height:220px;overflow:hidden" id="inspect-art"></div>
    <div style="padding:20px">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
        <div><div style="font-size:10px;color:var(--text3);letter-spacing:1px">WEAPON</div><div style="font-weight:700" id="inspect-weapon">‚Äî</div></div>
        <div><div style="font-size:10px;color:var(--text3);letter-spacing:1px">FINISH</div><div style="font-weight:700" id="inspect-finish">‚Äî</div></div>
        <div><div style="font-size:10px;color:var(--text3);letter-spacing:1px">RARITY</div><div style="font-weight:700" id="inspect-rarity">‚Äî</div></div>
        <div><div style="font-size:10px;color:var(--text3);letter-spacing:1px">WEAR</div><div style="font-weight:700" id="inspect-wear">‚Äî</div></div>
        <div><div style="font-size:10px;color:var(--text3);letter-spacing:1px">FLOAT</div><div style="font-family:'Barlow Condensed',sans-serif;font-size:16px;font-weight:700" id="inspect-float">‚Äî</div></div>
        <div><div style="font-size:10px;color:var(--text3);letter-spacing:1px">PATTERN SEED</div><div style="font-family:'Barlow Condensed',sans-serif;font-size:16px;font-weight:700" id="inspect-seed">‚Äî</div></div>
      </div>
      <div style="background:var(--bg4);border-radius:8px;padding:3px;margin-bottom:16px">
        <div style="height:8px;border-radius:6px;background:linear-gradient(90deg,#2ecc71,#f0a500,#eb4b4b);position:relative">
          <div id="inspect-float-marker" style="position:absolute;top:-4px;width:4px;height:16px;background:#fff;border-radius:2px;box-shadow:0 0 6px rgba(255,255,255,.5);transform:translateX(-50%)"></div>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:9px;color:var(--text3);margin-top:2px"><span>FN</span><span>MW</span><span>FT</span><span>WW</span><span>BS</span></div>
      </div>
      <div style="text-align:center;margin-bottom:4px">
        <div style="font-family:'Barlow Condensed',sans-serif;font-size:32px;font-weight:700" id="inspect-price">$0.00</div>
      </div>
      <div style="display:flex;gap:8px;justify-content:center">
        <button class="btn btn-red" onclick="sellInspected()">üí∞ Sell</button>
        <button class="btn btn-secondary" onclick="closeInspect()">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- DAILY SPIN MODAL -->
<div id="spin-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:2000;align-items:center;justify-content:center;backdrop-filter:blur(4px)">
  <div style="background:var(--bg2);border-radius:20px;width:90%;max-width:480px;overflow:hidden;border:1px solid var(--bg5);text-align:center;padding:32px">
    <div style="font-family:'Rajdhani',sans-serif;font-size:28px;font-weight:700;color:var(--accent);margin-bottom:4px">üé° Daily Spin</div>
    <div style="font-size:13px;color:var(--text2);margin-bottom:24px">One free spin every 24 hours!</div>
    <div style="position:relative;width:280px;height:280px;margin:0 auto 24px">
      <canvas id="spin-canvas" width="280" height="280"></canvas>
      <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:30px;height:30px;background:var(--bg2);border-radius:50%;border:3px solid var(--accent);z-index:2"></div>
      <div style="position:absolute;top:-10px;left:50%;transform:translateX(-50%);font-size:24px;z-index:3;filter:drop-shadow(0 2px 4px rgba(0,0,0,.5))">‚ñº</div>
    </div>
    <div id="spin-result" style="font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;min-height:28px;margin-bottom:16px"></div>
    <button class="btn btn-primary btn-lg" id="spin-btn" onclick="doSpin()">üé° SPIN!</button>
    <button class="btn btn-secondary" onclick="closeSpinModal()" style="margin-left:8px">Close</button>
  </div>
</div>

<!-- NOTIFICATIONS -->
<div class="notif-container" id="notif-container"></div>
<div id="knife-overlay" style="display:none" onclick="closeKnifeOverlay()">
  <div class="gold-particles" id="particles"></div>
  <div style="font-family:'Rajdhani',sans-serif;font-size:16px;color:var(--text2);letter-spacing:2px">EXTRAORDINARY ITEM!</div>
  <div class="knife-glow" id="knife-icon">üî™</div>
  <div class="knife-text" id="knife-name">‚òÖ Karambit | Doppler</div>
  <div style="font-family:'Barlow Condensed',sans-serif;font-size:32px;color:var(--gold);margin:4px 0" id="knife-val">$450.00</div>
  <div style="font-size:12px;color:var(--text2);margin-top:8px">Click anywhere to continue</div>
</div>

<script>
// ============================================================
// GAME DATA
// ============================================================
const RARITIES = {
  consumer:{name:'Consumer Grade',color:'#b0c3d9',key:'consumer'},
  industrial:{name:'Industrial Grade',color:'#5e98d9',key:'industrial'},
  milspec:{name:'Mil-Spec Grade',color:'#4b69ff',key:'milspec'},
  restricted:{name:'Restricted',color:'#8847ff',key:'restricted'},
  classified:{name:'Classified',color:'#d32ce6',key:'classified'},
  covert:{name:'Covert',color:'#eb4b4b',key:'covert'},
  knife:{name:'‚òÖ Extraordinary',color:'#e4ae39',key:'knife'},
};

// CSGO Drop Rates
const DROP_RATES = [
  {rarity:'consumer',weight:7992},
  {rarity:'industrial',weight:1598},
  {rarity:'milspec',weight:320},
  {rarity:'restricted',weight:64},
  {rarity:'classified',weight:13},
  {rarity:'covert',weight:2},
  {rarity:'knife',weight:1},
];
const TOTAL_WEIGHT = DROP_RATES.reduce((s,r)=>s+r.weight,0);

const WEAPONS = {
  pistols:['Glock-18','USP-S','P250','Five-SeveN','Tec-9','CZ75-Auto','Desert Eagle','Dual Berettas','P2000','R8 Revolver'],
  smgs:['MP9','MP7','MAC-10','PP-Bizon','MP5-SD','UMP-45','P90'],
  rifles:['AK-47','M4A4','M4A1-S','SG 553','AUG','FAMAS','Galil AR','SSG 08','SCAR-20','G3SG1','AWP'],
  heavy:['XM1014','Nova','MAG-7','Sawed-Off','M249','Negev'],
  knives:['‚òÖ Karambit','‚òÖ Butterfly Knife','‚òÖ M9 Bayonet','‚òÖ Bayonet','‚òÖ Flip Knife','‚òÖ Gut Knife','‚òÖ Huntsman Knife','‚òÖ Falchion Knife','‚òÖ Shadow Daggers','‚òÖ Bowie Knife','‚òÖ Ursus Knife','‚òÖ Navaja Knife','‚òÖ Stiletto Knife','‚òÖ Talon Knife','‚òÖ Classic Knife','‚òÖ Skeleton Knife','‚òÖ Paracord Knife','‚òÖ Survival Knife','‚òÖ Nomad Knife'],
};
const ALL_GUNS = [...WEAPONS.pistols,...WEAPONS.smgs,...WEAPONS.rifles,...WEAPONS.heavy];

const FINISHES = {
  consumer:['Forest DDPAT','Sand Dune','Groundwater','Urban DDPAT','Contractor','Stained','Safari Mesh','Olive Plaid','Rust Coat','Faded'],
  industrial:['Boreal Forest','Tornado','Silver','Gila','Faded Zebra','Amber Fade','Mudder','Splatter','Polar Mesh','Full Stop'],
  milspec:['Teardown','Muertos','Torque','Whiteout','Cobalt Halftone','Corticera','Death by Kitty','Blue Spruce','Graphite','Hazard'],
  restricted:['Cyrex','Varicamo','Valence','Oxide Blaze','Buzz Kill','Flashback','Twilight Galaxy','Vortex','Nitro','Brass'],
  classified:['Empress','Blood Tiger','Asiimov','Redline','Neo-Noir','Temukau','Wildfire','Desolate Space','Emerald','Crimson Web'],
  covert:['Dragon Lore','Fade','Doppler','Hyper Beast','Fire Serpent','Printstream','Howl','Skull Crusher','Wild Lotus','Duality'],
  knife:['Doppler','Fade','Tiger Tooth','Marble Fade','Ultraviolet','Night','Crimson Web','Slaughter','Autotropic','Case Hardened'],
};

const SKIN_ICONS = {
  consumer:'üî´',industrial:'üî´',milspec:'üî´',restricted:'üî´',classified:'üî´',covert:'‚ö°',knife:'üî™',
};

function rarityBasePrice(rarity){
  const prices={consumer:[0.03,0.15],industrial:[0.1,0.5],milspec:[0.5,3],restricted:[3,15],classified:[15,80],covert:[80,500],knife:[200,2000]};
  const r=prices[rarity];
  return +(r[0]+Math.random()*(r[1]-r[0])).toFixed(2);
}

function generateSkin(rarity,caseSource=''){
  const weapon = rarity==='knife' ? WEAPONS.knives[Math.floor(Math.random()*WEAPONS.knives.length)] : ALL_GUNS[Math.floor(Math.random()*ALL_GUNS.length)];
  const finish = FINISHES[rarity][Math.floor(Math.random()*FINISHES[rarity].length)];
  const float = +(Math.random()).toFixed(8);
  let wear='';
  if(float<0.07)wear='Factory New';
  else if(float<0.15)wear='Minimal Wear';
  else if(float<0.38)wear='Field-Tested';
  else if(float<0.45)wear='Well-Worn';
  else wear='Battle-Scarred';
  const pattern = Math.floor(Math.random()*1000);
  const price = rarityBasePrice(rarity);
  const id = Date.now()+Math.random();
  return {id,weapon,finish,name:`${weapon} | ${finish}`,rarity,float,wear,pattern,price,icon:SKIN_ICONS[rarity],case:caseSource,date:Date.now(),fav:false,banked:false};
}

const CASES = [
  // Classic Series
  {id:'cs1',name:'CS:GO Weapon Case',price:0.05,color:'#4b69ff',theme:'blue',special:'Classic Knives'},
  {id:'cs2',name:'CS:GO Weapon Case 2',price:0.05,color:'#8847ff',theme:'purple'},
  {id:'cs3',name:'CS:GO Weapon Case 3',price:0.05,color:'#d32ce6',theme:'pink'},
  {id:'esports13',name:'eSports 2013 Case',price:0.05,color:'#f0a500',theme:'gold'},
  {id:'esports14',name:'eSports 2014 Summer Case',price:0.08,color:'#00c8ff',theme:'cyan'},
  // Operation Series
  {id:'bravo',name:'Operation Bravo Case',price:35,color:'#e4ae39',theme:'knife',special:'Rare & Valuable'},
  {id:'phoenix',name:'Operation Phoenix Case',price:0.10,color:'#ff6b35',theme:'orange'},
  {id:'hydra',name:'Operation Hydra Case',price:1.50,color:'#2ecc71',theme:'green',special:'Hydra Gloves'},
  {id:'vanguard',name:'Operation Vanguard Case',price:0.08,color:'#5e98d9',theme:'blue'},
  {id:'wildfire',name:'Operation Wildfire Case',price:0.12,color:'#eb4b4b',theme:'red'},
  // Chroma Series
  {id:'chroma',name:'Chroma Case',price:0.07,color:'#d32ce6',theme:'purple'},
  {id:'chroma2',name:'Chroma 2 Case',price:0.15,color:'#eb4b4b',theme:'red'},
  {id:'chroma3',name:'Chroma 3 Case',price:0.15,color:'#8847ff',theme:'violet'},
  // Color Series
  {id:'shadow',name:'Shadow Case',price:0.12,color:'#3a3b50',theme:'dark'},
  {id:'falchion',name:'Falchion Case',price:0.20,color:'#eb4b4b',theme:'red'},
  {id:'revolver',name:'Revolver Case',price:0.04,color:'#8b7355',theme:'tan'},
  {id:'winter',name:'Winter Offensive Case',price:0.12,color:'#5e98d9',theme:'ice',special:'Cold Skins'},
  {id:'breakout',name:'Breakout Case',price:0.06,color:'#ff6b35',theme:'orange'},
  // Gamma Series
  {id:'gamma',name:'Gamma Case',price:0.14,color:'#2ecc71',theme:'green'},
  {id:'gamma2',name:'Gamma 2 Case',price:0.18,color:'#00c8ff',theme:'teal'},
  // Glove Special
  {id:'glove',name:'Glove Case',price:2.10,color:'#e4ae39',theme:'gold',special:'‚òÖ Gloves'},
  // Spectrum
  {id:'spectrum',name:'Spectrum Case',price:0.20,color:'#ff6b35',theme:'spectrum'},
  {id:'spectrum2',name:'Spectrum 2 Case',price:0.25,color:'#8847ff',theme:'purple'},
  // Danger Zone
  {id:'danger',name:'Danger Zone Case',price:0.34,color:'#eb4b4b',theme:'red'},
  // Horizon Series
  {id:'horizon',name:'Horizon Case',price:0.45,color:'#ff6b35',theme:'sunset'},
  // Prisma Series
  {id:'prisma',name:'PRISMA Case',price:0.68,color:'#d32ce6',theme:'prism'},
  {id:'prisma2',name:'PRISMA 2 Case',price:0.52,color:'#00c8ff',theme:'cyan'},
  // CS20
  {id:'cs20',name:'CS20 Case',price:0.55,color:'#f0a500',theme:'anniversary',special:'20th Anniversary'},
  // Fracture
  {id:'fracture',name:'Fracture Case',price:0.45,color:'#eb4b4b',theme:'red'},
  // Snakebite
  {id:'snakebite',name:'Snakebite Case',price:0.38,color:'#2ecc71',theme:'green'},
  // Dreams & Nightmares
  {id:'dreams',name:'Dreams & Nightmares Case',price:0.55,color:'#8847ff',theme:'nightmare',special:'Unique Art'},
  // Recoil
  {id:'recoil',name:'Recoil Case',price:0.72,color:'#4b69ff',theme:'cyber'},
  // Revolution
  {id:'revolution',name:'Revolution Case',price:0.88,color:'#00c8ff',theme:'neon'},
  // Kilowatt
  {id:'kilowatt',name:'Kilowatt Case',price:1.20,color:'#f0a500',theme:'electric',special:'New 2024 Skins'},
  // Gallery
  {id:'gallery',name:'Gallery Case',price:0.65,color:'#d32ce6',theme:'art'},
  // Event Cases
  {id:'sticker2021',name:'Stockholm 2021 Souvenir',price:8.50,color:'#e4ae39',theme:'souvenir',special:'‚≠ê Souvenir'},
  {id:'sticker2022',name:'Antwerp 2022 Souvenir',price:12.00,color:'#ff6b35',theme:'souvenir',special:'‚≠ê Souvenir'},
  {id:'paris2023',name:'Paris 2023 Souvenir',price:15.00,color:'#4b69ff',theme:'souvenir',special:'‚≠ê Souvenir'},
  // Special/Event
  {id:'event_halloween',name:'Halloween Horror Case',price:2.50,color:'#ff6b35',theme:'halloween',special:'üéÉ Limited Event'},
  {id:'event_christmas',name:'Winter Gift Case',price:3.00,color:'#5e98d9',theme:'christmas',special:'üéÑ Limited Event'},
  {id:'event_summer',name:'Summer Heat Case',price:1.80,color:'#f0a500',theme:'summer',special:'‚òÄÔ∏è Limited Event'},
  // Ultra Rare
  {id:'ancient',name:'The Ancient Case',price:4.20,color:'#8847ff',theme:'ancient',special:'‚òÖ Ultra Rare Pool'},
];

const CASINO_GAMES=[
  {id:'blackjack',name:'Blackjack',icon:'üÉè',desc:'Beat the dealer to 21',color:'#1a3a25'},
  {id:'roulette',name:'Roulette',icon:'üéØ',desc:'Bet on Red, Black or Green',color:'#3a1a1a'},
  {id:'crash',name:'Crash',icon:'üöÄ',desc:'Cash out before it crashes',color:'#0d1f3a'},
  {id:'mines',name:'Mines',icon:'üí£',desc:'Dodge the mines for multipliers',color:'#1a1a0d'},
  {id:'slots',name:'Slots',icon:'üé∞',desc:'Classic 3-reel slot machine',color:'#1a0a1a'},
  {id:'plinko',name:'Plinko',icon:'üîµ',desc:'Drop balls for big multipliers',color:'#0a1a2a'},
  {id:'coinflip',name:'Coinflip',icon:'ü™ô',desc:'50/50 ‚Äî CT vs T side',color:'#1a1204'},
];

const UPGRADES = [
  // Click Power
  {id:'mpad',name:'Mousepad Pro',desc:'+$0.50/click',cost:50,icon:'üñ±Ô∏è',clickAdd:0.50,max:30,cat:'click'},
  {id:'mech',name:'Mechanical Keyboard',desc:'+$2/click',cost:600,icon:'‚å®Ô∏è',clickAdd:2,max:25,cat:'click'},
  {id:'gmouse',name:'Gaming Mouse',desc:'+$10/click',cost:8000,icon:'üñ±Ô∏è',clickAdd:10,max:20,cat:'click'},
  {id:'golden',name:'Golden Mouse',desc:'+$50/click',cost:75000,icon:'‚ú®',clickAdd:50,max:15,cat:'click'},
  {id:'quantum',name:'Quantum Clicker',desc:'+$250/click',cost:600000,icon:'‚öõÔ∏è',clickAdd:250,max:10,cat:'click'},
  {id:'cosmic',name:'Cosmic Force',desc:'+$2000/click',cost:5000000,icon:'üåå',clickAdd:2000,max:5,cat:'click'},
  // Passive Income
  {id:'autoclk',name:'Auto Clicker',desc:'+$0.50/s',cost:100,icon:'ü§ñ',cpsAdd:0.5,max:50,cat:'passive'},
  {id:'farm1',name:'Click Farm I',desc:'+$5/s',cost:2500,icon:'üè≠',cpsAdd:5,max:40,cat:'passive'},
  {id:'farm2',name:'Click Farm II',desc:'+$25/s',cost:25000,icon:'üèóÔ∏è',cpsAdd:25,max:30,cat:'passive'},
  {id:'aibot',name:'AI Bot Network',desc:'+$200/s',cost:250000,icon:'üß†',cpsAdd:200,max:20,cat:'passive'},
  {id:'megafarm',name:'Mega Farm',desc:'+$1500/s',cost:2000000,icon:'üåÜ',cpsAdd:1500,max:10,cat:'passive'},
  {id:'infinity',name:'Infinity Engine',desc:'+$15,000/s',cost:20000000,icon:'‚ôæÔ∏è',cpsAdd:15000,max:5,cat:'passive'},
  // Luck
  {id:'luck1',name:'Lucky Charm',desc:'+5% case luck',cost:1200,icon:'üçÄ',luckAdd:5,max:20,cat:'luck'},
  {id:'luck2',name:'Horseshoe',desc:'+15% case luck',cost:18000,icon:'üåà',luckAdd:15,max:10,cat:'luck'},
  {id:'luck3',name:'Crystal Ball',desc:'+40% case luck',cost:200000,icon:'üîÆ',luckAdd:40,max:5,cat:'luck'},
];

const RANKS = [
  {name:'Silver I',short:'S1',min:0,icon:'ü•à'},
  {name:'Silver II',short:'S2',min:5,icon:'ü•à'},
  {name:'Silver III',short:'S3',min:10,icon:'ü•à'},
  {name:'Silver IV',short:'S4',min:15,icon:'ü•à'},
  {name:'Silver Elite',short:'SE',min:20,icon:'ü•à'},
  {name:'Silver Elite Master',short:'SEM',min:25,icon:'ü•à'},
  {name:'Gold Nova I',short:'GN1',min:30,icon:'ü•á'},
  {name:'Gold Nova II',short:'GN2',min:35,icon:'ü•á'},
  {name:'Gold Nova III',short:'GN3',min:40,icon:'ü•á'},
  {name:'Gold Nova Master',short:'GNM',min:45,icon:'ü•á'},
  {name:'Master Guardian I',short:'MG1',min:50,icon:'üèÖ'},
  {name:'Master Guardian II',short:'MG2',min:55,icon:'üèÖ'},
  {name:'Master Guardian Elite',short:'MGE',min:60,icon:'üèÖ'},
  {name:'Distinguished Master Guardian',short:'DMG',min:65,icon:'üèÜ'},
  {name:'Legendary Eagle',short:'LE',min:70,icon:'ü¶Ö'},
  {name:'Legendary Eagle Master',short:'LEM',min:75,icon:'ü¶Ö'},
  {name:'Supreme Master First Class',short:'SMFC',min:80,icon:'üëë'},
  {name:'The Global Elite',short:'GE',min:90,icon:'üåü'},
];

const ACHIEVEMENTS = [
  {id:'first_open',name:'First Open',desc:'Open your first case',icon:'üì¶',done:false,req:'casesOpened',val:1},
  {id:'open_100',name:'Centurion',desc:'Open 100 cases',icon:'üíØ',done:false,req:'casesOpened',val:100},
  {id:'open_1000',name:'Case Addict',desc:'Open 1000 cases',icon:'üì¶',done:false,req:'casesOpened',val:1000},
  {id:'first_knife',name:'Knife!',desc:'Unbox your first knife',icon:'üî™',done:false,req:'knivesUnboxed',val:1},
  {id:'rich',name:'Millionaire',desc:'Earn $1,000,000 total',icon:'üíé',done:false,req:'totalEarned',val:1000000},
  {id:'gambler',name:'High Roller',desc:'Win 10 casino games',icon:'üé≤',done:false,req:'casinoWins',val:10},
  {id:'collector',name:'Collector',desc:'Have 50 skins in inventory',icon:'üéí',done:false,req:'invCount',val:50},
  {id:'rebirth1',name:'Phoenix',desc:'Complete first rebirth',icon:'üî•',done:false,req:'rebirths',val:1},
  {id:'profit100',name:'Profit Pro',desc:'Make $100 profit from selling',icon:'üìà',done:false,req:'sellProfit',val:100},
];

const ROULETTE_SEQUENCE = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];

// ============================================================
// GAME STATE
// ============================================================
let G; // main game state

function defaultState(){
  return {
    balance:100,bankBalance:0,loan:0,
    clicks:0,totalClicks:0,totalEarned:100,sellProfit:0,
    cps:0,clickValue:0.50,
    winStreak:0,lastSpinDate:'',inspectSkinId:null,
    xp:0,level:1,bpLevel:1,bpXP:0,bpPremium:false,
    rebirths:0,luckBonus:0,
    casesOpened:0,knivesUnboxed:0,casinoWins:0,casinoLosses:0,totalBet:0,
    inventory:[],bankSkins:[],favorites:[],
    upgrades:{},
    history:[],marketHistory:[],
    lastInterest:Date.now(),lastLoanInterest:Date.now(),
    username:'',avatar:'',since:new Date().toLocaleDateString(),
    achievements:[...ACHIEVEMENTS],
    missions:generateMissions(),
    seasonEvents:[],
    marketTrend:Array.from({length:20},()=>+(0.8+Math.random()*0.4).toFixed(2)),
    jpEntries:[],jpPot:0,
    sfxOn:true,theme:'dark',
    totalNetWorthHistory:[100],
    netWorthSamples:[{t:Date.now(),v:100}],
  };
}

function generateMissions(){
  const daily=[
    {id:'d1',name:'Open 5 Cases',desc:'Open any 5 cases',icon:'üì¶',type:'daily',req:'casesOpened',start:0,goal:5,reward:50,claimed:false},
    {id:'d2',name:'Win at Casino',desc:'Win 3 casino games',icon:'üé≤',type:'daily',req:'casinoWins',start:0,goal:3,reward:30,claimed:false},
    {id:'d3',name:'Click 1000 Times',desc:'Click the money button 1000 times',icon:'üëÜ',type:'daily',req:'totalClicks',start:0,goal:1000,reward:25,claimed:false},
  ];
  const weekly=[
    {id:'w1',name:'Open 50 Cases',desc:'Open 50 cases this week',icon:'üì¶',type:'weekly',req:'casesOpened',start:0,goal:50,reward:500,claimed:false},
    {id:'w2',name:'Big Gambler',desc:'Win $500 from casino',icon:'üèÜ',type:'weekly',req:'casinoWinAmount',start:0,goal:500,reward:200,claimed:false},
    {id:'w3',name:'Collector Week',desc:'Get 20 skins in inventory',icon:'üéí',type:'weekly',req:'invCount',goal:20,reward:150,claimed:false},
    {id:'w4',name:'Rebirth Ready',desc:'Earn $10,000 total',icon:'üí∞',type:'weekly',req:'totalEarned',start:0,goal:10000,reward:300,claimed:false},
  ];
  return{daily,weekly,casinoWinAmount:0};
}

// ============================================================
// PERSISTENCE
// ============================================================
function saveGame(){try{localStorage.setItem('csroll_state',JSON.stringify(G));}catch(e){}}
function loadGame(){
  try{
    const d=localStorage.getItem('csroll_state');
    if(d){G=JSON.parse(d);if(!G.missions)G.missions=generateMissions();if(!G.marketTrend)G.marketTrend=Array.from({length:20},()=>+(0.8+Math.random()*0.4).toFixed(2));}
  }catch(e){G=null;}
}

// ============================================================
// AUTH
// ============================================================
let ACCOUNTS = {};
function loadAccounts(){try{ACCOUNTS=JSON.parse(localStorage.getItem('csroll_accounts')||'{}');}catch(e){ACCOUNTS={};}}
function saveAccounts(){localStorage.setItem('csroll_accounts',JSON.stringify(ACCOUNTS));}
let currentUser=null;

function switchLoginTab(t){
  document.querySelectorAll('.login-tab').forEach(el=>el.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('login-form').style.display=t==='login'?'block':'none';
  document.getElementById('register-form').style.display=t==='register'?'block':'none';
  document.getElementById('auth-error').textContent='';
}
function doLogin(){
  const user=document.getElementById('login-user').value.trim();
  const pass=document.getElementById('login-pass').value;
  if(!user||!pass){setAuthError('Please fill in all fields');return;}
  if(!ACCOUNTS[user]||ACCOUNTS[user].pass!==pass){setAuthError('Invalid username or password');return;}
  currentUser=user;
  const saved=ACCOUNTS[user].state;
  G=saved||defaultState();
  G.username=user;
  if(!G.missions)G.missions=generateMissions();
  if(!G.marketTrend)G.marketTrend=Array.from({length:20},()=>+(0.8+Math.random()*0.4).toFixed(2));
  startApp();
}
function doRegister(){
  const user=document.getElementById('reg-user').value.trim();
  const pass=document.getElementById('reg-pass').value;
  if(!user||!pass){setAuthError('Please fill all fields');return;}
  if(user.length<3){setAuthError('Username must be 3+ characters');return;}
  if(ACCOUNTS[user]){setAuthError('Username already taken');return;}
  ACCOUNTS[user]={pass,state:null};
  saveAccounts();
  currentUser=user;
  G=defaultState();
  G.username=user;
  startApp();
}
function setAuthError(msg){document.getElementById('auth-error').textContent=msg;}
function doLogout(){
  if(G)ACCOUNTS[currentUser].state=G;
  saveAccounts();
  location.reload();
}
function startApp(){
  document.getElementById('login-page').style.display='none';
  document.getElementById('app').style.display='flex';
  if(currentUser==='d3vi0us')document.getElementById('admin-nav').style.display='flex';
  initApp();
}

// ============================================================
// APP INIT
// ============================================================
function initApp(){
  renderSidebar();
  renderCases();
  renderUpgrades();
  renderInventory();
  renderMissions();
  renderBattlePass();
  renderStats();
  renderLeaderboard();
  renderMarket();
  renderCasino();
  initPlinko();
  initRouletteBelt();
  initMinesGrid();
  startPassiveIncome();
  checkWeekend();
  checkInterest();
  updateSpecialUI();
  setInterval(saveGame,10000);
  setInterval(updateBP,1000);
  setInterval(checkInterest,60000);
  setInterval(()=>{fluctuateMarket();renderMarketChart();},5000);
  showPage('clicker');
  notify('Welcome back, '+G.username+'! üéÆ','success');
}

// ============================================================
// SIDEBAR/UI UPDATES
// ============================================================
function renderSidebar(){
  if(!G)return;
  const lvl=getLevel();
  const rank=getRank();
  const initials=G.username.slice(0,2).toUpperCase();
  document.getElementById('sb-balance').textContent='$'+fmt(G.balance);
  document.getElementById('sb-level').textContent='LVL '+G.level;
  document.getElementById('sb-xp-text').textContent=G.xp+' / '+xpForLevel(G.level)+' XP';
  const pct=Math.min(100,(G.xp/xpForLevel(G.level))*100);
  document.getElementById('sb-xp-bar').style.width=pct+'%';
  document.getElementById('sb-avatar').textContent=initials;
  document.getElementById('sb-username').textContent=G.username;
  document.getElementById('sb-rank').textContent=rank.icon+' '+rank.name;
  document.getElementById('top-rank').textContent=rank.short;
  document.getElementById('top-inv-count').textContent=G.inventory.length;
  document.getElementById('rebirth-count').textContent=G.rebirths;
  document.getElementById('rebirth-luck').textContent='+'+(G.rebirths*25)+'%';
  document.getElementById('profile-name').textContent=G.username;
  document.getElementById('profile-avatar').textContent=initials;
  document.getElementById('profile-rank-badge').innerHTML=rank.icon+' '+rank.name;
  document.getElementById('profile-level').textContent='Level '+G.level;
  document.getElementById('profile-xp-text').textContent=G.xp+' / '+xpForLevel(G.level)+' XP';
  document.getElementById('profile-xp-bar').style.width=pct+'%';
  document.getElementById('profile-rebirths').textContent=G.rebirths;
  document.getElementById('profile-since').textContent=G.since;
  document.getElementById('bank-total').textContent='$'+fmt(G.bankBalance);
  document.getElementById('loan-display').textContent='$'+fmt(G.loan);
  checkMissionBadge();
}

function xpForLevel(l){return 100*Math.pow(1.4,l-1)|0;}
function getLevel(){return G.level;}
function getRank(){
  for(let i=RANKS.length-1;i>=0;i--)if(G.level>=RANKS[i].min)return RANKS[i];
  return RANKS[0];
}

function addXP(amt){
  G.xp+=amt;
  while(G.xp>=xpForLevel(G.level)){
    G.xp-=xpForLevel(G.level);
    G.level++;
    G.bpXP+=50;
    notify('üéâ Level Up! You are now Level '+G.level,'success');
    checkBPLevelUp();
  }
  renderSidebar();
}
function addBalance(amt,label,type='win'){
  G.balance+=amt;
  G.totalEarned+=Math.max(0,amt);
  addHistory(label,amt,type);
  if(G.balance<0)G.balance=0;
  renderSidebar();
  saveGame();
}
function fmt(n){return Number(n).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,',');}
function showPage(p){
  document.querySelectorAll('.page').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(el=>el.classList.remove('active'));
  const pg=document.getElementById('page-'+p);
  if(pg)pg.classList.add('active');
  const navs=document.querySelectorAll('.nav-item');
  navs.forEach(el=>{if(el.getAttribute('onclick')&&el.getAttribute('onclick').includes("'"+p+"'"))el.classList.add('active');});
  const titles={clicker:'Click Farm',cases:'Cases',casino:'Casino',battles:'Case Battles',jackpot:'Jackpot',tradeup:'Trade-Up',inventory:'Inventory',bank:'Bank',market:'Marketplace',profile:'Profile',missions:'Missions',battlepass:'Battle Pass',stats:'Statistics',leaderboard:'Leaderboard',settings:'Settings',admin:'Admin Panel'};
  document.getElementById('topbar-title').textContent=titles[p]||p;
  if(p==='stats')renderStats();
  if(p==='inventory')renderInventory();
  if(p==='market'){renderMarket();renderMarketChart();}
  if(p==='leaderboard')renderLeaderboard();
  if(p==='missions'){updateMissionProgress();renderMissions();}
  if(p==='profile')renderAchievements();
}
function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebar-overlay').classList.toggle('open');
}
function closeSidebar(){
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('open');
}

// ============================================================
// HISTORY
// ============================================================
function addHistory(desc,val,type='neutral'){
  const item={desc,val,type,time:Date.now()};
  G.history.unshift(item);
  if(G.history.length>100)G.history.pop();
  const panel=document.getElementById('history-panel');
  const statsPanel=document.getElementById('stats-history');
  renderHistoryPanel(panel);
  renderHistoryPanel(statsPanel);
  // track net worth
  G.netWorthSamples.push({t:Date.now(),v:G.balance+G.bankBalance+inventoryValue()});
  if(G.netWorthSamples.length>50)G.netWorthSamples.shift();
}
function renderHistoryPanel(panel){
  if(!panel)return;
  panel.innerHTML=G.history.slice(0,30).map(h=>{
    const cls=h.val>0?'pos':h.val<0?'neg':'';
    const prefix=h.val>0?'+':'';
    return `<div class="history-item"><span class="history-icon">${h.val>0?'üíö':'‚ù§Ô∏è'}</span><span class="history-desc">${h.desc}</span><span class="history-val ${cls}">${prefix}$${fmt(Math.abs(h.val))}</span><span class="history-time">${timeAgo(h.time)}</span></div>`;
  }).join('');
}
function timeAgo(t){
  const d=(Date.now()-t)/1000;
  if(d<60)return d|0+'s';if(d<3600)return (d/60|0)+'m';return (d/3600|0)+'h';
}
function inventoryValue(){return G.inventory.reduce((s,i)=>s+i.price,0);}

// ============================================================
// CLICKER
// ============================================================
function doClick(e){
  playSound('click');
  const val=G.clickValue*(1+G.rebirths*0.1);
  G.balance+=val;G.totalEarned+=val;G.totalClicks++;G.clicks++;
  // Float text
  const btn=document.getElementById('click-btn');
  const rect=btn.getBoundingClientRect();
  const span=document.createElement('div');
  span.className='float-text';
  span.textContent='+$'+val.toFixed(2);
  span.style.cssText=`left:${e.clientX-rect.left-20}px;top:${e.clientY-rect.top-20}px;position:absolute;pointer-events:none`;
  btn.parentElement.style.position='relative';
  btn.parentElement.appendChild(span);
  setTimeout(()=>span.remove(),800);
  addXP(1);
  updateClickerDisplay();
  checkMissions();
  renderSidebar();
}
function updateClickerDisplay(){
  document.getElementById('click-val-display').textContent='+$'+fmt(G.clickValue*(1+G.rebirths*0.1))+' per click';
  document.getElementById('total-clicks-display').textContent=fmt(G.totalClicks)+' total clicks';
  document.getElementById('cps-display').textContent='$'+fmt(G.cps*(1+G.rebirths*0.1))+'/s';
}
function startPassiveIncome(){
  setInterval(()=>{
    if(!G)return;
    const earned=G.cps*(1+G.rebirths*0.1)/10;
    G.balance+=earned;G.totalEarned+=earned;
    renderSidebar();
    updateClickerDisplay();
  },100);
}
function doRebirth(){
  if(G.balance<100000){notify('Need $100,000 to Rebirth!','error');return;}
  if(!confirm('Rebirth? You lose all cash and upgrades but gain permanent +25% luck and keep inventory.'))return;
  G.rebirths++;
  G.luckBonus=G.rebirths*25;
  G.balance=0;
  G.cps=0;G.clickValue=0.50;
  G.upgrades={};
  renderUpgrades();
  notify('üî• Rebirth #'+G.rebirths+'! +25% Luck bonus!','success');
  renderSidebar();
  addXP(500);
}

function renderUpgrades(){
  const grid=document.getElementById('upgrades-grid');
  const cats={click:'üñ±Ô∏è Click Power',passive:'üí∞ Passive Income',luck:'üçÄ Luck Boosts'};
  let html='';
  Object.keys(cats).forEach(cat=>{
    html+=`<div style="grid-column:1/-1;margin-top:8px"><div class="section-title" style="font-size:15px">${cats[cat]}</div></div>`;
    UPGRADES.filter(u=>u.cat===cat).forEach(u=>{
      const count=G.upgrades[u.id]||0;
      const atMax=u.max&&count>=u.max;
      const nextCost=Math.ceil(u.cost*Math.pow(1.5,count));
      const canAfford=G.balance>=nextCost;
      const pct=Math.min(100,u.max?count/u.max*100:0);
      const perPurchaseLabel=u.clickAdd?`+$${u.clickAdd}/click`:u.cpsAdd?`+$${u.cpsAdd}/s`:u.luckAdd?`+${u.luckAdd}% luck`:'';
      html+=`<div class="upgrade-card ${atMax?'owned':canAfford?'':'locked'}" onclick="purchaseUpgrade('${u.id}')">
        <div class="upgrade-icon">${u.icon}</div>
        <div class="upgrade-info">
          <div class="upgrade-name">${u.name} ${count>0?`<span style="color:var(--accent);font-size:11px">Lv${count}</span>`:''}</div>
          <div class="upgrade-desc">${perPurchaseLabel}</div>
          <div style="background:var(--bg5);height:3px;border-radius:2px;margin:5px 0;overflow:hidden"><div style="height:100%;width:${pct}%;background:${atMax?'var(--green)':'var(--accent)'};border-radius:2px;transition:width .3s"></div></div>
          <div class="upgrade-cost">${atMax?`<span style="color:var(--green)">‚òÖ MAX (${count}/${u.max})</span>`:canAfford?`$${fmt(nextCost)}<span style="color:var(--text3);font-size:10px;margin-left:4px">${count+1}/${u.max}</span>`:`<span style="color:var(--text3)">$${fmt(nextCost)}</span>`}</div>
        </div>
      </div>`;
    });
  });
  grid.innerHTML=html;
}
function purchaseUpgrade(id){
  const u=UPGRADES.find(x=>x.id===id);
  if(!u)return;
  const count=G.upgrades[id]||0;
  if(u.max&&count>=u.max){notify('Max level reached!','error');return;}
  const cost=Math.ceil(u.cost*Math.pow(1.5,count));
  if(G.balance<cost){notify('Not enough funds!','error');return;}
  G.balance-=cost;
  G.upgrades[id]=(count+1);
  if(u.clickAdd)G.clickValue+=u.clickAdd;
  if(u.cpsAdd)G.cps+=u.cpsAdd;
  if(u.luckAdd)G.luckBonus=(G.luckBonus||0)+u.luckAdd;
  addHistory('Upgrade: '+u.name+' Lv'+(count+1),-cost,'expense');
  playSound('buy');
  notify(u.name+' ‚Üí Level '+(count+1)+'!','success');
  renderUpgrades();
  renderSidebar();
}

// ============================================================
// CASES
// ============================================================
let currentCase=null,openQty=1,lastWin=null,multiWins=[];

// SVG Art Generator for cases
function getCaseSVG(c){
  const col = c.color;
  const themes = {
    blue:`<polygon points="40,12 65,30 65,50 40,58 15,50 15,30" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><circle cx="40" cy="35" r="10" fill="${col}" opacity="0.3"/><circle cx="40" cy="35" r="5" fill="${col}" opacity="0.7"/>`,
    purple:`<rect x="18" y="18" width="44" height="34" rx="3" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><line x1="18" y1="28" x2="62" y2="28" stroke="${col}" stroke-width="1" opacity="0.5"/><circle cx="40" cy="41" r="6" fill="${col}" opacity="0.5"/>`,
    pink:`<ellipse cx="40" cy="35" rx="22" ry="18" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><path d="M28,25 Q40,15 52,25 Q60,35 52,45 Q40,55 28,45 Q20,35 28,25Z" fill="${col}" opacity="0.2"/>`,
    gold:`<polygon points="40,10 50,25 66,25 54,37 58,53 40,44 22,53 26,37 14,25 30,25" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.9"/><polygon points="40,18 46,28 57,28 49,34 51,46 40,39 29,46 31,34 23,28 34,28" fill="${col}" opacity="0.3"/>`,
    cyan:`<path d="M40,12 L60,22 L60,48 L40,58 L20,48 L20,22Z" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><path d="M30,30 L50,30 L50,42 L30,42Z" fill="none" stroke="${col}" stroke-width="1" opacity="0.5"/>`,
    knife:`<path d="M25,15 L55,20 L58,45 L40,52 L22,45Z" fill="none" stroke="${col}" stroke-width="2" opacity="0.9"/><path d="M35,25 L48,28 L48,42 L35,42Z" fill="${col}" opacity="0.4"/><circle cx="40" cy="18" r="3" fill="${col}"/>`,
    orange:`<rect x="15" y="18" width="50" height="34" rx="6" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><path d="M20,28 Q40,18 60,28" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.6"/><rect x="28" y="32" width="24" height="12" rx="3" fill="${col}" opacity="0.3"/>`,
    green:`<polygon points="40,12 62,24 62,46 40,58 18,46 18,24" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><polygon points="40,20 56,29 56,43 40,52 24,43 24,29" fill="${col}" opacity="0.2"/><circle cx="40" cy="35" r="5" fill="${col}" opacity="0.7"/>`,
    ice:`<polygon points="40,12 55,20 60,36 55,52 40,58 25,52 20,36 25,20" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><line x1="40" y1="12" x2="40" y2="58" stroke="${col}" stroke-width="0.5" opacity="0.4"/><line x1="20" y1="36" x2="60" y2="36" stroke="${col}" stroke-width="0.5" opacity="0.4"/>`,
    dark:`<rect x="16" y="16" width="48" height="38" rx="4" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.7"/><rect x="22" y="22" width="36" height="26" rx="2" fill="${col}" opacity="0.15"/><circle cx="40" cy="35" r="7" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.6"/>`,
    tan:`<circle cx="40" cy="35" r="22" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><circle cx="40" cy="35" r="15" fill="none" stroke="${col}" stroke-width="1" opacity="0.5"/><circle cx="40" cy="35" r="6" fill="${col}" opacity="0.5"/>`,
    red:`<path d="M20,20 L60,20 L65,50 L40,58 L15,50Z" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><path d="M25,25 L55,25 L60,48 L40,54 L20,48Z" fill="${col}" opacity="0.2"/>`,
    spectrum:`<path d="M40,12 A28,28 0,1,1,39.9,12" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><path d="M40,20 A20,20 0,1,1,39.9,20" fill="none" stroke="${col}" stroke-width="1" opacity="0.5"/><path d="M40,28 A12,12 0,1,1,39.9,28" fill="${col}" opacity="0.3"/>`,
    sunset:`<path d="M15,45 Q40,10 65,45 Z" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><path d="M20,45 Q40,18 60,45" fill="none" stroke="${col}" stroke-width="1" opacity="0.5"/><ellipse cx="40" cy="45" rx="18" ry="5" fill="${col}" opacity="0.3"/>`,
    prism:`<polygon points="40,10 65,55 15,55" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.9"/><line x1="40" y1="10" x2="40" y2="55" stroke="${col}" stroke-width="0.5" opacity="0.4"/><polygon points="40,20 58,52 22,52" fill="${col}" opacity="0.2"/>`,
    anniversary:`<circle cx="40" cy="35" r="23" fill="none" stroke="${col}" stroke-width="2" opacity="0.8"/><text x="40" y="31" text-anchor="middle" font-size="9" fill="${col}" font-weight="700" opacity="0.9">CS</text><text x="40" y="43" text-anchor="middle" font-size="7" fill="${col}" opacity="0.7">20 YEARS</text>`,
    nightmare:`<path d="M22,15 Q40,8 58,15 L62,55 L40,62 L18,55Z" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><path d="M32,28 Q40,22 48,28 Q52,35 48,42 Q40,48 32,42 Q28,35 32,28Z" fill="${col}" opacity="0.3"/>`,
    cyber:`<rect x="14" y="14" width="52" height="42" rx="2" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><line x1="14" y1="24" x2="66" y2="24" stroke="${col}" stroke-width="1" opacity="0.4"/><line x1="14" y1="46" x2="66" y2="46" stroke="${col}" stroke-width="1" opacity="0.4"/><rect x="22" y="28" width="16" height="14" rx="1" fill="${col}" opacity="0.3"/><rect x="42" y="28" width="16" height="14" rx="1" fill="${col}" opacity="0.3"/>`,
    neon:`<circle cx="40" cy="35" r="22" fill="none" stroke="${col}" stroke-width="2" opacity="0.8"/><circle cx="40" cy="35" r="14" fill="none" stroke="${col}" stroke-width="1" opacity="0.5"/><path d="M28,35 Q34,22 40,20 Q46,22 52,35 Q46,48 40,50 Q34,48 28,35Z" fill="${col}" opacity="0.25"/>`,
    electric:`<polygon points="40,10 58,22 64,40 50,55 30,55 16,40 22,22" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.9"/><path d="M44,18 L36,36 L44,36 L36,52" fill="none" stroke="${col}" stroke-width="2.5" stroke-linecap="round"/>`,
    art:`<rect x="15" y="15" width="50" height="40" rx="3" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><rect x="20" y="20" width="20" height="15" rx="2" fill="${col}" opacity="0.3"/><rect x="44" y="20" width="16" height="15" rx="2" fill="${col}" opacity="0.2"/><rect x="20" y="39" width="40" height="10" rx="2" fill="${col}" opacity="0.2"/>`,
    souvenir:`<polygon points="40,10 52,28 70,28 56,40 62,58 40,46 18,58 24,40 10,28 28,28" fill="none" stroke="${col}" stroke-width="2" opacity="0.9"/><polygon points="40,18 49,31 62,31 52,38 56,52 40,43 24,52 28,38 18,31 31,31" fill="${col}" opacity="0.35"/>`,
    halloween:`<path d="M25,20 Q40,8 55,20 L58,50 Q50,58 40,60 Q30,58 22,50Z" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><ellipse cx="33" cy="34" rx="5" ry="7" fill="${col}" opacity="0.4"/><ellipse cx="47" cy="34" rx="5" ry="7" fill="${col}" opacity="0.4"/><path d="M32,46 Q40,52 48,46" fill="none" stroke="${col}" stroke-width="2"/>`,
    christmas:`<polygon points="40,10 55,30 65,30 50,45 55,60 40,50 25,60 30,45 15,30 25,30" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.9"/><circle cx="40" cy="30" r="4" fill="${col}" opacity="0.7"/><circle cx="30" cy="42" r="3" fill="${col}" opacity="0.5"/><circle cx="50" cy="42" r="3" fill="${col}" opacity="0.5"/>`,
    summer:`<circle cx="40" cy="35" r="22" fill="none" stroke="${col}" stroke-width="2" opacity="0.9"/><path d="M40,13 L40,57 M18,35 L62,35 M24,19 L56,51 M56,19 L24,51" stroke="${col}" stroke-width="1" opacity="0.4"/>`,
    ancient:`<path d="M22,58 L18,20 L40,12 L62,20 L58,58Z" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><path d="M29,52 L26,24 L40,18 L54,24 L51,52Z" fill="${col}" opacity="0.2"/><circle cx="40" cy="35" r="8" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.6"/><circle cx="40" cy="35" r="3" fill="${col}" opacity="0.7"/>`,
    violet:`<rect x="15" y="15" width="50" height="40" rx="8" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><circle cx="40" cy="25" r="8" fill="${col}" opacity="0.3"/><rect x="22" y="36" width="36" height="12" rx="4" fill="${col}" opacity="0.25"/>`,
    teal:`<hexagon/><polygon points="40,10 62,22 62,48 40,60 18,48 18,22" fill="none" stroke="${col}" stroke-width="1.5" opacity="0.8"/><polygon points="40,18 56,27 56,43 40,52 24,43 24,27" fill="${col}" opacity="0.2"/><line x1="30" y1="35" x2="50" y2="35" stroke="${col}" stroke-width="1.5" opacity="0.6"/>`,
  };
  const shape = themes[c.theme] || themes.blue;
  return `<svg width="80" height="70" viewBox="0 0 80 70" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="cg${c.id}" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="${col}" stop-opacity="0.25"/>
        <stop offset="100%" stop-color="#080910" stop-opacity="1"/>
      </linearGradient>
      <filter id="glow${c.id}"><feGaussianBlur stdDeviation="2" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    </defs>
    <rect width="80" height="70" rx="8" fill="url(#cg${c.id})"/>
    <rect x="0" y="0" width="80" height="8" rx="8" fill="${col}" opacity="0.5"/>
    <rect x="0" y="6" width="80" height="2" fill="${col}" opacity="0.3"/>
    <g filter="url(#glow${c.id})" transform="translate(0,3)">${shape}</g>
    <rect x="20" y="60" width="40" height="4" rx="2" fill="${col}" opacity="0.4"/>
  </svg>`;
}

// SVG skin art generator
function getSkinSVG(skin){
  const col = RARITIES[skin.rarity].color;
  const isKnife = skin.rarity === 'knife';
  const patterns = {
    Doppler:`<defs><radialGradient id="d${skin.id.toString().slice(-4)}" cx="50%" cy="30%"><stop offset="0%" stop-color="${col}"/><stop offset="100%" stop-color="#0a0a14"/></radialGradient></defs>`,
    Fade:`<defs><linearGradient id="f${skin.id.toString().slice(-4)}" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#ff6b35"/><stop offset="50%" stop-color="${col}"/><stop offset="100%" stop-color="#4b69ff"/></linearGradient></defs>`,
  };
  const finishPat = patterns[skin.finish] || '';
  const gradId = `sg${skin.id.toString().slice(-6).replace('.','_')}`;
  if(isKnife){
    return `<svg width="100%" height="100%" viewBox="0 0 100 80" xmlns="http://www.w3.org/2000/svg">
      <defs><linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="${col}" stop-opacity="0.9"/><stop offset="60%" stop-color="${col}" stop-opacity="0.6"/><stop offset="100%" stop-color="#1a1b23" stop-opacity="0.8"/></linearGradient></defs>
      <rect width="100" height="80" fill="#0d0e14"/>
      <path d="M15,40 L70,25 L82,30 L82,38 L70,45Z" fill="url(#${gradId})" opacity="0.9"/>
      <path d="M15,40 L70,25 L82,30" fill="none" stroke="${col}" stroke-width="0.8" opacity="0.5"/>
      <path d="M60,32 L72,28 L78,32 L72,38 L60,38Z" fill="${col}" opacity="0.4"/>
      <rect x="18" y="36" width="20" height="8" rx="2" fill="#2a2b38"/>
      <rect x="20" y="37" width="16" height="6" rx="1" fill="${col}" opacity="0.5"/>
      <circle cx="17" cy="40" r="3" fill="${col}" opacity="0.6"/>
      <text x="50" y="66" text-anchor="middle" font-size="7" fill="${col}" opacity="0.7" font-family="Barlow Condensed">${skin.wear}</text>
    </svg>`;
  }
  // Rifle/pistol silhouette
  const weaponShapes = {
    'AK-47':`<path d="M10,38 L75,38 L78,33 L72,28 L30,28 L28,32 L10,32Z" fill="url(#${gradId})"/><rect x="15" y="32" width="8" height="6" rx="1" fill="${col}" opacity="0.5"/><rect x="60" y="30" width="12" height="3" rx="1" fill="${col}" opacity="0.6"/>`,
    'AWP':`<path d="M8,35 L80,35 L82,30 L30,28 L8,30Z" fill="url(#${gradId})"/><rect x="50" y="25" width="20" height="5" rx="1" fill="${col}" opacity="0.7"/><circle cx="72" cy="27" r="4" fill="none" stroke="${col}" stroke-width="1"/>`,
    'M4A4':`<path d="M10,37 L72,37 L75,32 L65,27 L30,27 L28,32 L10,32Z" fill="url(#${gradId})"/><rect x="14" y="32" width="9" height="5" rx="1" fill="${col}" opacity="0.5"/>`,
    default:`<path d="M10,38 L70,38 L73,33 L65,28 L32,28 L30,33 L10,33Z" fill="url(#${gradId})"/><rect x="13" y="33" width="8" height="5" rx="1" fill="${col}" opacity="0.5"/><rect x="55" y="30" width="10" height="3" rx="1" fill="${col}" opacity="0.6"/>`,
  };
  const ws = weaponShapes[skin.weapon] || weaponShapes.default;
  return `<svg width="100%" height="100%" viewBox="0 0 100 80" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="${gradId}" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="${col}" stop-opacity="0.9"/><stop offset="100%" stop-color="#0d0e14" stop-opacity="0.7"/></linearGradient></defs>
    <rect width="100" height="80" fill="#0d0e14"/>
    ${ws}
    <text x="50" y="56" text-anchor="middle" font-size="6" fill="${col}" opacity="0.6" font-family="Barlow Condensed">${skin.weapon.slice(0,12)}</text>
    <text x="50" y="64" text-anchor="middle" font-size="5.5" fill="rgba(255,255,255,0.4)" font-family="Barlow Condensed">${skin.finish.slice(0,14)}</text>
    <text x="50" y="72" text-anchor="middle" font-size="5" fill="${col}" opacity="0.5" font-family="Barlow Condensed">${skin.wear} ¬∑ ${skin.float.toFixed(4)}</text>
  </svg>`;
}

function renderCases(){
  const grid=document.getElementById('cases-grid');
  const bcs=document.getElementById('battle-case-select');
  if(bcs)bcs.innerHTML=CASES.map(c=>`<option value="${c.id}">${c.name} ($${fmt(c.price)})</option>`).join('');
  grid.innerHTML=CASES.map(c=>`
    <div class="case-card" onclick="openCaseModal('${c.id}')" style="border-color:${c.color}30">
      <div class="case-shine"></div>
      <div class="case-img" style="display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 0 12px ${c.color}80)">${getCaseSVG(c)}</div>
      <div class="case-name">${c.name}</div>
      <div class="case-price" style="color:${c.price>5?'var(--gold)':c.price>1?'var(--accent)':'var(--text2)'}">$${fmt(c.price)}</div>
      ${c.special?`<div style="font-size:10px;color:${c.color};margin-top:2px;font-weight:600">${c.special}</div>`:''}
    </div>
  `).join('');
}
function openCaseModal(id){
  currentCase=CASES.find(c=>c.id===id);
  if(!currentCase)return;
  document.getElementById('modal-case-name').textContent=currentCase.name;
  document.getElementById('case-modal').style.display='flex';
  document.getElementById('win-display').style.display='none';
  document.getElementById('spinner-section').style.display='block';
  document.getElementById('modal-actions').style.display='flex';
  updateCaseCostDisplay();
  buildSpinnerTrack();
}
function closeCase(){document.getElementById('case-modal').style.display='none';lastWin=null;multiWins=[];}
function setOpenQty(n){
  openQty=n;
  document.querySelectorAll('.quantity-btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  updateCaseCostDisplay();
}
function updateCaseCostDisplay(){
  if(!currentCase)return;
  const total=currentCase.price*openQty;
  document.getElementById('case-cost-display').textContent='Total: $'+fmt(total);
}

function rollRarity(){
  const luckMult = isWeekend() ? 2 : 1;
  const bonusMult = 1 + G.luckBonus/100;
  // Adjust weights: higher rarities get a boost
  let weights = DROP_RATES.map((r,i)=>{
    if(i>3)return {rarity:r.rarity,weight:r.weight*luckMult*bonusMult};
    return r;
  });
  const total=weights.reduce((s,r)=>s+r.weight,0);
  let roll=Math.random()*total;
  for(const r of weights){roll-=r.weight;if(roll<=0)return r.rarity;}
  return 'consumer';
}

function openCase(){
  if(!currentCase)return;
  const totalCost=currentCase.price*openQty;
  if(G.balance<totalCost){notify('Not enough funds!','error');return;}
  G.balance-=totalCost;
  addHistory('Opened '+openQty+'√ó '+currentCase.name,-totalCost,'expense');
  G.casesOpened+=openQty;
  addXP(openQty*5);
  multiWins=[];
  for(let i=0;i<openQty;i++){
    const rarity=rollRarity();
    const skin=generateSkin(rarity,currentCase.name);
    multiWins.push(skin);
  }
  lastWin=multiWins[0];
  playSound('case_open');
  animateSpin(multiWins[0]);
  checkMissions();
  checkAchievements();
}

function buildSpinnerTrack(){
  const track=document.getElementById('spinner-track');
  const items=[];
  for(let i=0;i<60;i++){
    const rarity=rollRarity();
    const skin=generateSkin(rarity);
    items.push(skin);
  }
  track.innerHTML=items.map(s=>`
    <div class="spinner-item rarity-${s.rarity}" style="border-color:${RARITIES[s.rarity].color}80;overflow:hidden;padding:0;width:120px;height:140px">
      <div style="width:100%;height:95px;overflow:hidden">${getSkinSVG(s)}</div>
      <div style="padding:2px 4px;font-size:9px;text-align:center;color:${RARITIES[s.rarity].color};font-weight:600;line-height:1.2;background:var(--bg3)">${s.name.slice(0,22)}</div>
      <div class="item-rarity" style="background:${RARITIES[s.rarity].color}"></div>
    </div>
  `).join('');
  track.style.transform='translateX(0)';
}

function animateSpin(winSkin){
  const track=document.getElementById('spinner-track');
  const itemW=128;// 120+8 gap
  const items=track.children;
  // Place win skin at index 45
  const winIndex=45;
  // Replace item at winIndex with winSkin
  const winEl=items[winIndex];
  if(winEl){
    winEl.innerHTML=`<div class="item-icon">${winSkin.icon}</div><div class="item-name">${winSkin.name}</div><div class="item-rarity" style="background:${RARITIES[winSkin.rarity].color}"></div>`;
    winEl.className=`spinner-item rarity-${winSkin.rarity}`;
  }
  // Center of container
  const containerW=document.getElementById('spinner-container').offsetWidth;
  const targetX=-(winIndex*itemW)+(containerW/2-60);
  const jitter=(Math.random()-0.5)*60;
  track.style.transition='transform 4s cubic-bezier(.15,.6,.2,1)';
  track.style.transform=`translateX(${targetX+jitter}px)`;
  setTimeout(()=>{
    track.style.transition='none';
    showWinDisplay(winSkin);
  },4100);
}

function showWinDisplay(skin){
  document.getElementById('spinner-section').style.display='none';
  document.getElementById('modal-actions').style.display='none';
  const wd=document.getElementById('win-display');
  wd.style.display='flex';
  const winIconEl=document.getElementById('win-icon');
  winIconEl.innerHTML=getSkinSVG(skin);
  winIconEl.style.borderColor=RARITIES[skin.rarity].color;
  winIconEl.className='rarity-'+skin.rarity;
  document.getElementById('win-name').textContent=skin.name;
  document.getElementById('win-rarity').textContent=RARITIES[skin.rarity].name;
  document.getElementById('win-rarity').style.color=RARITIES[skin.rarity].color;
  document.getElementById('win-value').textContent='$'+fmt(skin.price);
  document.getElementById('win-value').style.color=RARITIES[skin.rarity].color;
  if(skin.rarity==='knife'||skin.rarity==='covert'){
    showKnifeOverlay(skin);
    spawnParticles();
    playSound('knife');
  }else if(skin.rarity==='classified'){playSound('rare');}
  if(multiWins.length>1){
    G.inventory.push(...multiWins);
    addHistory('Won '+multiWins.length+' skins from '+currentCase.name,multiWins.reduce((s,x)=>s+x.price,0),'win');
    renderInventory();renderSidebar();
  }
  checkAchievements();
}

function addWinToInventory(){
  if(!lastWin)return;
  if(multiWins.length<=1){
    G.inventory.push(lastWin);
    addHistory('Added '+lastWin.name+' to inventory',lastWin.price,'win');
  }
  renderInventory();renderSidebar();
  closeCase();notify('Added to inventory!','success');
}
function sellWin(){
  if(!lastWin)return;
  const skins=multiWins.length>0?multiWins:[lastWin];
  const total=skins.reduce((s,x)=>s+x.price,0);
  if(multiWins.length<=1){
    G.balance+=total;G.totalEarned+=total;G.sellProfit+=total;
    addHistory('Sold '+lastWin.name,total,'win');
  }
  renderSidebar();closeCase();
  notify('Sold for $'+fmt(total)+'!','success');
}

// ============================================================
// KNIFE OVERLAY
// ============================================================
function showKnifeOverlay(skin){
  const overlay=document.getElementById('knife-overlay');
  const iconEl=document.getElementById('knife-icon');
  iconEl.innerHTML=`<div style="width:200px;height:150px;overflow:hidden;border-radius:16px;border:2px solid ${RARITIES[skin.rarity].color}">${getSkinSVG(skin)}</div>`;
  document.getElementById('knife-name').textContent=skin.name;
  document.getElementById('knife-val').textContent='$'+fmt(skin.price);
  overlay.style.display='flex';
}
function closeKnifeOverlay(){document.getElementById('knife-overlay').style.display='none';}
function spawnParticles(){
  const p=document.getElementById('particles');
  p.innerHTML='';
  for(let i=0;i<40;i++){
    const el=document.createElement('div');
    el.className='particle';
    const dur=(0.8+Math.random()*1.5).toFixed(2);
    el.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*100}%;--dur:${dur}s;--tx:${(Math.random()-0.5)*200}px;--ty:${-(50+Math.random()*200)}px;background:${['#f1c40f','#e4ae39','#fff','#ff6b35'][Math.random()*4|0]};animation-delay:${Math.random()*0.5}s`;
    p.appendChild(el);
  }
}

// ============================================================
// INVENTORY
// ============================================================
let invFilterRarity='all',invSortMode='date';

function renderInventory(){
  let items=[...G.inventory];
  if(invFilterRarity==='favorites')items=items.filter(i=>i.fav);
  else if(invFilterRarity!=='all')items=items.filter(i=>i.rarity===invFilterRarity);
  if(invSortMode==='price-h')items.sort((a,b)=>b.price-a.price);
  else if(invSortMode==='price-l')items.sort((a,b)=>a.price-b.price);
  else if(invSortMode==='rarity'){
    const order=['knife','covert','classified','restricted','milspec','industrial','consumer'];
    items.sort((a,b)=>order.indexOf(a.rarity)-order.indexOf(b.rarity));
  }else items.sort((a,b)=>b.date-a.date);
  const grid=document.getElementById('inventory-grid');
  const totalVal=G.inventory.reduce((s,i)=>s+i.price,0);
  document.getElementById('inv-total-val').textContent='$'+fmt(totalVal);
  if(!items.length){grid.innerHTML='<div style="color:var(--text3);padding:20px;grid-column:1/-1;text-align:center">No skins found</div>';return;}
  grid.innerHTML=items.map(skin=>`
    <div class="inv-item rarity-${skin.rarity}" style="border-color:${RARITIES[skin.rarity].color}50;cursor:pointer" onclick="inspectSkin('${skin.id}')">
      <button class="fav-star ${skin.fav?'active':''}" onclick="toggleFav('${skin.id}');event.stopPropagation()">‚≠ê</button>
      <div class="inv-item-img rarity-bg-${skin.rarity}" style="height:100px;overflow:hidden">${getSkinSVG(skin)}</div>
      <div class="inv-item-info">
        <div class="inv-item-name" title="${skin.name}">${skin.name}</div>
        <div class="inv-item-price" style="color:${RARITIES[skin.rarity].color}">$${fmt(skin.price)}</div>
        <div class="inv-item-float">${skin.wear} ¬∑ ${skin.float.toFixed(4)}</div>
        <div style="font-size:9px;color:var(--text3)">Seed: ${skin.pattern}</div>
        <div style="display:flex;gap:4px;margin-top:4px">
          <button class="btn btn-red" style="font-size:10px;padding:2px 6px" onclick="sellSkin('${skin.id}');event.stopPropagation()">Sell</button>
          <button class="btn btn-secondary" style="font-size:10px;padding:2px 6px" onclick="bankSkin('${skin.id}');event.stopPropagation()">Bank</button>
        </div>
      </div>
    </div>
  `).join('');
  renderBankSkins();
  document.getElementById('top-inv-count').textContent=G.inventory.length;
}
function invFilter(r){
  invFilterRarity=r;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  renderInventory();
}
function invSort(v){invSortMode=v;renderInventory();}
function toggleFav(id){
  const skin=G.inventory.find(s=>s.id===id);
  if(skin){skin.fav=!skin.fav;saveGame();renderInventory();}
}
function sellSkin(id){
  const idx=G.inventory.findIndex(s=>s.id===id);
  if(idx<0)return;
  const skin=G.inventory[idx];
  G.balance+=skin.price;G.totalEarned+=skin.price;G.sellProfit+=skin.price;
  addHistory('Sold '+skin.name,skin.price,'win');
  G.inventory.splice(idx,1);
  renderInventory();renderSidebar();notify('Sold for $'+fmt(skin.price),'success');
}
function sellAll(){
  if(!G.inventory.length)return;
  const total=G.inventory.reduce((s,i)=>s+i.price,0);
  G.balance+=total;G.totalEarned+=total;G.sellProfit+=total;
  addHistory('Sold all skins ('+G.inventory.length+')',total,'win');
  G.inventory=[];
  renderInventory();renderSidebar();notify('Sold all skins for $'+fmt(total),'success');
}
function bankSkin(id){
  const idx=G.inventory.findIndex(s=>s.id===id);
  if(idx<0)return;
  const skin=G.inventory.splice(idx,1)[0];
  skin.banked=true;
  G.bankSkins.push(skin);
  renderInventory();renderBankSkins();notify('Skin locked in bank!','success');
}
function renderBankSkins(){
  const el=document.getElementById('bank-skins');
  if(!el)return;
  if(!G.bankSkins.length){el.innerHTML='<div style="color:var(--text3);padding:12px">No skins in bank</div>';return;}
  el.innerHTML=G.bankSkins.map(skin=>`
    <div class="inv-item rarity-${skin.rarity}" style="border-color:${RARITIES[skin.rarity].color}40">
      <div class="inv-item-img rarity-bg-${skin.rarity}">${skin.icon}</div>
      <div class="inv-item-info">
        <div class="inv-item-name">${skin.name}</div>
        <div class="inv-item-price">$${fmt(skin.price)}</div>
        <button class="btn btn-secondary" style="font-size:10px;padding:2px 6px;margin-top:4px" onclick="withdrawBankSkin('${skin.id}')">Withdraw</button>
      </div>
    </div>
  `).join('');
}
function withdrawBankSkin(id){
  const idx=G.bankSkins.findIndex(s=>s.id===id);
  if(idx<0)return;
  const skin=G.bankSkins.splice(idx,1)[0];
  skin.banked=false;
  G.inventory.push(skin);
  renderInventory();renderBankSkins();notify('Skin returned to inventory!','success');
}

// ============================================================
// CASINO GAMES
// ============================================================
function renderCasino(){
  const grid=document.getElementById('games-grid');
  grid.innerHTML=CASINO_GAMES.map(g=>`
    <div class="game-card" onclick="showGame('${g.id}')">
      <div class="game-card-banner" style="background:linear-gradient(135deg,${g.color},${g.color}88)"><span style="font-size:56px">${g.icon}</span></div>
      <div class="game-card-body">
        <div class="game-card-name">${g.name}</div>
        <div class="game-card-desc">${g.desc}</div>
      </div>
    </div>
  `).join('');
}
function showCasinoHub(){
  document.querySelectorAll('.game-panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('casino-hub').style.display='block';
}
function showGame(id){
  document.getElementById('casino-hub').style.display='none';
  document.querySelectorAll('.game-panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('game-'+id)?.classList.add('active');
  if(id==='crash')initCrash();
  if(id==='plinko')drawPlinko();
}
function setBet(inputId,mult){
  const el=document.getElementById(inputId);
  el.value=Math.max(1,(parseFloat(el.value)||0)*mult).toFixed(2);
}
function setBetMax(inputId){document.getElementById(inputId).value=G.balance.toFixed(2);}
function casinoWin(amount,label){
  G.winStreak=(G.winStreak||0)+1;
  const streakBonus=Math.min(5,G.winStreak);
  const bonusMult=1+((streakBonus-1)*0.1);
  const finalAmt=+(amount*bonusMult).toFixed(2);
  G.balance+=finalAmt;G.totalEarned+=finalAmt;G.casinoWins++;
  G.missions.casinoWinAmount=(G.missions.casinoWinAmount||0)+finalAmt;
  if(G.winStreak>1)label+=` üî•${G.winStreak} streak (${((bonusMult-1)*100).toFixed(0)}% bonus)`;
  addHistory(label,finalAmt,'win');addXP(10);checkMissions();renderSidebar();
  if(G.winStreak===3)notify('üî• 3 Win Streak! +20% bonus!','success');
  if(G.winStreak===5)notify('üî•üî•üî• 5 Win Streak! MAX +40% bonus!','success');
}
function casinoLose(amount,label){
  G.winStreak=0;
  G.balance-=amount;G.casinoLosses++;G.totalBet+=amount;
  addHistory(label,-amount,'loss');addXP(2);checkMissions();renderSidebar();
}
function checkBal(amt){if(G.balance<amt){notify('Insufficient funds!','error');return false;}return true;}

// --- BLACKJACK ---
const DECK_CARDS=[{v:'A',s:'‚ô†'},{v:'2',s:'‚ô†'},{v:'3',s:'‚ô†'},{v:'4',s:'‚ô†'},{v:'5',s:'‚ô†'},{v:'6',s:'‚ô†'},{v:'7',s:'‚ô†'},{v:'8',s:'‚ô†'},{v:'9',s:'‚ô†'},{v:'10',s:'‚ô†'},{v:'J',s:'‚ô†'},{v:'Q',s:'‚ô†'},{v:'K',s:'‚ô†'},{v:'A',s:'‚ô•'},{v:'2',s:'‚ô•'},{v:'3',s:'‚ô•'},{v:'4',s:'‚ô•'},{v:'5',s:'‚ô•'},{v:'6',s:'‚ô•'},{v:'7',s:'‚ô•'},{v:'8',s:'‚ô•'},{v:'9',s:'‚ô•'},{v:'10',s:'‚ô•'},{v:'J',s:'‚ô•'},{v:'Q',s:'‚ô•'},{v:'K',s:'‚ô•'},{v:'A',s:'‚ô¶'},{v:'2',s:'‚ô¶'},{v:'3',s:'‚ô¶'},{v:'4',s:'‚ô¶'},{v:'5',s:'‚ô¶'},{v:'6',s:'‚ô¶'},{v:'7',s:'‚ô¶'},{v:'8',s:'‚ô¶'},{v:'9',s:'‚ô¶'},{v:'10',s:'‚ô¶'},{v:'J',s:'‚ô¶'},{v:'Q',s:'‚ô¶'},{v:'K',s:'‚ô¶'},{v:'A',s:'‚ô£'},{v:'2',s:'‚ô£'},{v:'3',s:'‚ô£'},{v:'4',s:'‚ô£'},{v:'5',s:'‚ô£'},{v:'6',s:'‚ô£'},{v:'7',s:'‚ô£'},{v:'8',s:'‚ô£'},{v:'9',s:'‚ô£'},{v:'10',s:'‚ô£'},{v:'J',s:'‚ô£'},{v:'Q',s:'‚ô£'},{v:'K',s:'‚ô£'}];
let bjDeck=[],bjPlayer=[],bjDealer=[],bjBet=0,bjActive=false;
function bjShuffle(){bjDeck=[...DECK_CARDS];for(let i=bjDeck.length-1;i>0;i--){const j=Math.random()*(i+1)|0;[bjDeck[i],bjDeck[j]]=[bjDeck[j],bjDeck[i]];}}
function bjDraw(){if(bjDeck.length<10)bjShuffle();return bjDeck.pop();}
function bjCardVal(c){if(['J','Q','K'].includes(c.v))return 10;if(c.v==='A')return 11;return +c.v;}
function bjHandVal(hand){let v=hand.reduce((s,c)=>s+bjCardVal(c),0);let aces=hand.filter(c=>c.v==='A').length;while(v>21&&aces>0){v-=10;aces--;}return v;}
function bjRender(showAll=false){
  const isRed=c=>['‚ô•','‚ô¶'].includes(c.s);
  const cardHTML=c=>`<div class="card-item ${isRed(c)?'red':'black'}">${c.v}${c.s}</div>`;
  const backHTML=`<div class="card-item card-back">üÇ†</div>`;
  document.getElementById('dealer-cards').innerHTML=(showAll?bjDealer:[bjDealer[0],{back:true}]).map((c,i)=>c.back?backHTML:cardHTML(c)).join('');
  document.getElementById('player-cards').innerHTML=bjPlayer.map(cardHTML).join('');
  document.getElementById('dealer-score').textContent=showAll?bjHandVal(bjDealer):'?';
  document.getElementById('player-score').textContent=bjHandVal(bjPlayer);
}
function bjDeal(){
  const bet=parseFloat(document.getElementById('bj-bet').value)||10;
  if(!checkBal(bet))return;
  bjBet=bet;bjShuffle();bjPlayer=[bjDraw(),bjDraw()];bjDealer=[bjDraw(),bjDraw()];bjActive=true;
  bjRender();
  document.getElementById('bj-deal').style.display='none';
  document.getElementById('bj-hit').style.display='inline-flex';
  document.getElementById('bj-stand').style.display='inline-flex';
  document.getElementById('bj-double').style.display='inline-flex';
  document.getElementById('bj-result').textContent='';
  if(bjHandVal(bjPlayer)===21){bjEndGame('blackjack');return;}
  playSound('card');
}
function bjHit(){if(!bjActive)return;bjPlayer.push(bjDraw());bjRender();if(bjHandVal(bjPlayer)>21)bjEndGame('bust');playSound('card');}
function bjStand(){if(!bjActive)return;while(bjHandVal(bjDealer)<17)bjDealer.push(bjDraw());bjEndGame('stand');}
function bjDouble(){if(!bjActive)return;if(!checkBal(bjBet))return;bjBet*=2;bjPlayer.push(bjDraw());bjRender();if(bjHandVal(bjPlayer)>21)bjEndGame('bust');else bjStand();}
function bjEndGame(type){
  bjActive=false;bjRender(true);
  const pv=bjHandVal(bjPlayer),dv=bjHandVal(bjDealer);
  let msg='',win=false;
  if(type==='blackjack'){msg='üÉè BLACKJACK! +'+fmt(bjBet*1.5);G.balance-=bjBet;casinoWin(bjBet*2.5,'Blackjack BJ!');win=true;}
  else if(type==='bust'){msg='üí• BUST! You lost $'+fmt(bjBet);casinoLose(bjBet,'Blackjack Bust');}
  else if(dv>21){msg='üéâ Dealer Busted! Won $'+fmt(bjBet);G.balance-=bjBet;casinoWin(bjBet*2,'Blackjack Win');win=true;}
  else if(pv>dv){msg='‚úÖ You Win! +$'+fmt(bjBet);G.balance-=bjBet;casinoWin(bjBet*2,'Blackjack Win');win=true;}
  else if(pv===dv){msg='ü§ù Push! Bet returned';addHistory('Blackjack Push',0,'neutral');}
  else{msg='‚ùå Dealer Wins! Lost $'+fmt(bjBet);casinoLose(bjBet,'Blackjack Loss');}
  document.getElementById('bj-result').textContent=msg;
  document.getElementById('bj-result').style.color=win?'var(--green)':'var(--red)';
  document.getElementById('bj-deal').style.display='inline-flex';
  document.getElementById('bj-hit').style.display='none';
  document.getElementById('bj-stand').style.display='none';
  document.getElementById('bj-double').style.display='none';
  if(win)playSound('win');else playSound('lose');
}

// --- ROULETTE ---
const RL_COLORS={0:'green',32:'red',15:'black',19:'red',4:'black',21:'red',2:'black',25:'red',17:'black',34:'red',6:'black',27:'red',13:'black',36:'red',11:'black',30:'red',8:'black',23:'red',10:'black',5:'red',24:'black',16:'red',33:'black',1:'red',20:'black',14:'red',31:'black',9:'red',22:'black',18:'red',29:'black',7:'red',28:'black',12:'red',35:'black',3:'red',26:'black'};
function initRouletteBelt(){
  const belt=document.getElementById('rl-belt');
  if(!belt)return;
  const nums=[...ROULETTE_SEQUENCE,...ROULETTE_SEQUENCE,...ROULETTE_SEQUENCE];
  belt.innerHTML=nums.map(n=>`<div class="roulette-num ${n===0?'rl-green':RL_COLORS[n]==='red'?'rl-red':'rl-black'}">${n}</div>`).join('');
}
let rlSpinning=false;
function rlBet(color){
  if(rlSpinning){notify('Wait for spin to finish!','error');return;}
  const bet=parseFloat(document.getElementById('rl-bet').value)||10;
  if(!checkBal(bet))return;
  const result=ROULETTE_SEQUENCE[Math.floor(Math.random()*ROULETTE_SEQUENCE.length)];
  const resultColor=result===0?'green':RL_COLORS[result];
  rlSpinning=true;
  // Animate belt
  const belt=document.getElementById('rl-belt');
  const targetIdx=ROULETTE_SEQUENCE.indexOf(result)+37;// second copy
  const offset=targetIdx*50;
  belt.parentElement.style.position='relative';
  belt.style.transition='transform 3s cubic-bezier(.17,.67,.12,.99)';
  belt.style.transform=`translateX(-${offset+(Math.random()-0.5)*25}px)`;
  setTimeout(()=>{
    belt.style.transition='none';
    rlSpinning=false;
    let won=false,mult=1;
    if(color===resultColor){
      mult=color==='green'?14:2;
      casinoWin(bet*mult,'Roulette Win ('+color+')');
      document.getElementById('rl-result').textContent=`‚úÖ ${result} (${resultColor.toUpperCase()}) ‚Äî Won $${fmt(bet*mult)}`;
      document.getElementById('rl-result').style.color='var(--green)';
      playSound('win');
    }else{
      casinoLose(bet,'Roulette Loss');
      document.getElementById('rl-result').textContent=`‚ùå ${result} (${resultColor.toUpperCase()}) ‚Äî Lost $${fmt(bet)}`;
      document.getElementById('rl-result').style.color='var(--red)';
      playSound('lose');
    }
  },3100);
}

// --- CRASH ---
let crashInterval=null,crashMult=1,crashBetAmt=0,crashActive=false,crashBetPlaced=false;
let crashPoints=[];
function initCrash(){
  const canvas=document.getElementById('crash-canvas');
  if(!canvas)return;
  canvas.width=canvas.offsetWidth*window.devicePixelRatio||800;
  canvas.height=250*window.devicePixelRatio||250;
  drawCrashGraph();
}
function crashBet(){
  const bet=parseFloat(document.getElementById('crash-bet').value)||10;
  if(!checkBal(bet))return;
  crashBetAmt=bet;crashBetPlaced=true;
  crashMult=1;crashPoints=[];crashActive=true;
  document.getElementById('crash-bet-btn').style.display='none';
  document.getElementById('crash-cashout-btn').style.display='inline-flex';
  document.getElementById('crash-result').textContent='';
  document.getElementById('crash-mult').className='crash-multiplier';
  clearInterval(crashInterval);
  const auto=parseFloat(document.getElementById('crash-auto').value)||0;
  crashInterval=setInterval(()=>{
    crashMult*=(1+0.005+Math.random()*0.005);
    crashPoints.push(crashMult);
    document.getElementById('crash-mult').textContent=crashMult.toFixed(2)+'√ó';
    drawCrashGraph();
    if(auto>1&&crashMult>=auto){crashCashout();return;}
    if(Math.random()<0.005*Math.log(crashMult+1)){
      clearInterval(crashInterval);
      crashActive=false;
      casinoLose(crashBetAmt,'Crash ‚Äî Crashed at '+crashMult.toFixed(2)+'√ó');
      document.getElementById('crash-mult').className='crash-multiplier crashed';
      document.getElementById('crash-result').textContent='üí• Crashed at '+crashMult.toFixed(2)+'√ó! Lost $'+fmt(crashBetAmt);
      document.getElementById('crash-result').style.color='var(--red)';
      document.getElementById('crash-bet-btn').style.display='inline-flex';
      document.getElementById('crash-cashout-btn').style.display='none';
      playSound('lose');crashBetPlaced=false;
    }
  },80);
}
function crashCashout(){
  if(!crashBetPlaced||!crashActive)return;
  clearInterval(crashInterval);crashActive=false;crashBetPlaced=false;
  const won=crashBetAmt*crashMult;
  casinoWin(won,'Crash Cashout at '+crashMult.toFixed(2)+'√ó');
  document.getElementById('crash-result').textContent='‚úÖ Cashed out at '+crashMult.toFixed(2)+'√ó! Won $'+fmt(won);
  document.getElementById('crash-result').style.color='var(--green)';
  document.getElementById('crash-bet-btn').style.display='inline-flex';
  document.getElementById('crash-cashout-btn').style.display='none';
  playSound('win');
}
function drawCrashGraph(){
  const canvas=document.getElementById('crash-canvas');
  if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const w=canvas.width,h=canvas.height;
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#13141a';ctx.fillRect(0,0,w,h);
  // Grid
  ctx.strokeStyle='#22232e';ctx.lineWidth=1;
  for(let i=0;i<5;i++){ctx.beginPath();ctx.moveTo(0,h/5*i);ctx.lineTo(w,h/5*i);ctx.stroke();}
  if(crashPoints.length<2)return;
  const maxM=Math.max(...crashPoints,2);
  const pts=crashPoints;
  ctx.beginPath();
  ctx.strokeStyle='#2ecc71';ctx.lineWidth=3;
  pts.forEach((m,i)=>{
    const x=i/(pts.length-1)*w;
    const y=h-(m-1)/(maxM-1)*h*0.9-h*0.05;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.stroke();
  // Fill
  ctx.lineTo(w,h);ctx.lineTo(0,h);ctx.closePath();
  ctx.fillStyle='rgba(46,204,113,0.1)';ctx.fill();
}

// --- MINES ---
let minesBoard=[],minesActive=false,minesRevealed=0,minesList=[];
function initMinesGrid(){
  const grid=document.getElementById('mines-grid');
  if(!grid)return;
  grid.innerHTML=Array.from({length:25},(_,i)=>`<div class="mine-cell" id="mc${i}" onclick="minesClick(${i})"></div>`).join('');
}
function minesStart(){
  const bet=parseFloat(document.getElementById('mines-bet').value)||10;
  const mines=parseInt(document.getElementById('mines-count').value)||5;
  if(!checkBal(bet))return;
  G.balance-=bet;renderSidebar();
  minesBoard=Array(25).fill('safe');
  minesList=[];
  let placed=0;
  while(placed<mines){const idx=Math.floor(Math.random()*25);if(minesBoard[idx]!=='mine'){minesBoard[idx]='mine';minesList.push(idx);placed++;}}
  minesActive=true;minesRevealed=0;
  for(let i=0;i<25;i++){const c=document.getElementById('mc'+i);c.className='mine-cell';c.textContent='';}
  document.getElementById('mines-start-btn').style.display='none';
  document.getElementById('mines-cashout-btn').style.display='inline-flex';
  updateMinesMultiplier();
  document.getElementById('mines-result').textContent='';
  addHistory('Mines Bet',-bet,'expense');
}
function minesClick(i){
  if(!minesActive)return;
  const c=document.getElementById('mc'+i);
  if(c.classList.contains('revealed'))return;
  if(minesBoard[i]==='mine'){
    c.className='mine-cell revealed-mine revealed';c.textContent='üí£';
    minesActive=false;
    // Reveal all mines
    minesList.forEach(m=>{const mc=document.getElementById('mc'+m);mc.className='mine-cell revealed-mine revealed';mc.textContent='üí£';});
    document.getElementById('mines-start-btn').style.display='inline-flex';
    document.getElementById('mines-cashout-btn').style.display='none';
    document.getElementById('mines-result').textContent='üí• BOOM! You hit a mine!';
    document.getElementById('mines-result').style.color='var(--red)';
    playSound('lose');
  }else{
    c.className='mine-cell revealed-safe revealed';c.textContent='üíé';minesRevealed++;
    updateMinesMultiplier();playSound('click');
  }
}
function updateMinesMultiplier(){
  const mines=parseInt(document.getElementById('mines-count').value)||5;
  const safe=25-mines;
  const mult=Math.pow(safe/(safe-minesRevealed+1),minesRevealed)*1.05;
  document.getElementById('mines-mult').textContent=mult.toFixed(2)+'√ó';
}
function minesCashout(){
  if(!minesActive)return;
  const bet=parseFloat(document.getElementById('mines-bet').value)||10;
  const mines=parseInt(document.getElementById('mines-count').value)||5;
  const safe=25-mines;
  const mult=Math.pow(safe/(safe-minesRevealed+1),minesRevealed)*1.05;
  const won=bet*mult;
  minesActive=false;
  casinoWin(won,'Mines Cashout ('+minesRevealed+' gems)');
  document.getElementById('mines-result').textContent='‚úÖ Cashed out! Won $'+fmt(won);
  document.getElementById('mines-result').style.color='var(--green)';
  document.getElementById('mines-start-btn').style.display='inline-flex';
  document.getElementById('mines-cashout-btn').style.display='none';
  playSound('win');
}

// --- SLOTS ---
const SLOT_SYMBOLS=['üçí','üçã','üçá','üîî','‚≠ê','7Ô∏è‚É£','üíé'];
const SLOT_MULTS={'üíéüíéüíé':100,'7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£':50,'üçíüçíüçí':20,'üçãüçãüçã':15,'üçáüçáüçá':12,'üîîüîîüîî':10,'‚≠ê‚≠ê‚≠ê':8};
let slotSpinning=false;
function slotsPlay(){
  if(slotSpinning)return;
  const bet=parseFloat(document.getElementById('slots-bet').value)||5;
  if(!checkBal(bet))return;
  G.balance-=bet;renderSidebar();
  slotSpinning=true;
  playSound('slots');
  const results=[];
  for(let r=0;r<3;r++){
    const el=document.getElementById('reel-'+r);
    el.classList.add('spinning');
    setTimeout(()=>{
      el.classList.remove('spinning');
      const sym=SLOT_SYMBOLS[Math.random()*SLOT_SYMBOLS.length|0];
      el.textContent=sym;results[r]=sym;
      if(results.length===3&&!results.includes(undefined)){
        const combo=results.join('');
        const mult=SLOT_MULTS[combo]||(results[0]===results[1]&&results[1]===results[2]?5:0);
        slotSpinning=false;
        if(mult>0){
          const won=bet*mult;casinoWin(won,'Slots '+combo);
          document.getElementById('slots-result').textContent='üéâ '+combo+' = '+mult+'√ó ‚Äî +$'+fmt(won);
          document.getElementById('slots-result').style.color='var(--green)';playSound('win');
        }else{
          casinoLose(bet,'Slots Loss');
          document.getElementById('slots-result').textContent='‚ùå No match ‚Äî Lost $'+fmt(bet);
          document.getElementById('slots-result').style.color='var(--red)';playSound('lose');
        }
      }
    },300+r*200);
  }
  addHistory('Slots Bet',-bet,'expense');
}

// --- PLINKO ---
const PLINKO_ROWS = 12;
const PLINKO_MULTS = [1000,130,26,9,4,2,0.2,2,4,9,26,130,1000];
let plinkoCtx=null, plinkoActive=false, plinkoCanvas=null, plinkoPegs=[];
function plinkoBucketColor(m){
  if(m>=100)return '#e4ae39'; if(m>=10)return '#d32ce6'; if(m>=2)return '#4b69ff'; if(m>=1)return '#5e98d9'; return '#eb4b4b';
}
function clamp(v,mn,mx){return Math.max(mn,Math.min(mx,v));}
function easeInOut(t){return t<0.5?2*t*t:-1+(4-2*t)*t;}

function initPlinko(){
  plinkoCanvas=document.getElementById('plinko-canvas');
  if(!plinkoCanvas)return;
  plinkoCanvas.width=440; plinkoCanvas.height=420;
  plinkoCtx=plinkoCanvas.getContext('2d');
  buildPlinkoPegs(); drawPlinkoBoard();
}
function buildPlinkoPegs(){
  plinkoPegs=[];
  const W=440,TOP=28,BOTTOM=365;
  const rowSpacing=(BOTTOM-TOP)/(PLINKO_ROWS-1);
  for(let r=0;r<PLINKO_ROWS;r++){
    const numPegs=r+3;
    const rowY=TOP+r*rowSpacing;
    const span=W*0.14+(W*0.72)*(r/(PLINKO_ROWS-1));
    const startX=W/2-span/2;
    for(let c=0;c<numPegs;c++){
      const px=numPegs>1?startX+(span/(numPegs-1))*c:W/2;
      plinkoPegs.push({x:px,y:rowY,r,c});
    }
  }
}
function drawPlinkoBoard(ball=null,pathPts=null,hBucket=-1){
  if(!plinkoCtx||!plinkoCanvas)return;
  const W=plinkoCanvas.width,H=plinkoCanvas.height,ctx=plinkoCtx;
  ctx.clearRect(0,0,W,H);
  const bg=ctx.createLinearGradient(0,0,0,H);
  bg.addColorStop(0,'#0b0c14'); bg.addColorStop(1,'#13141a');
  ctx.fillStyle=bg; ctx.fillRect(0,0,W,H);
  // Side walls
  ctx.fillStyle='rgba(255,255,255,0.03)'; ctx.fillRect(0,0,8,H); ctx.fillRect(W-8,0,8,H);
  // Path trail
  if(pathPts&&pathPts.length>1){
    ctx.beginPath(); ctx.moveTo(pathPts[0].x,pathPts[0].y);
    for(let i=1;i<pathPts.length;i++)ctx.lineTo(pathPts[i].x,pathPts[i].y);
    ctx.strokeStyle='rgba(240,165,0,0.25)'; ctx.lineWidth=2.5; ctx.setLineDash([4,4]); ctx.stroke(); ctx.setLineDash([]);
  }
  // Pegs
  plinkoPegs.forEach(p=>{
    const g=ctx.createRadialGradient(p.x-1,p.y-2,1,p.x,p.y,6);
    g.addColorStop(0,'#b0d4f0'); g.addColorStop(1,'#4b69ff');
    ctx.beginPath(); ctx.arc(p.x,p.y,5,0,Math.PI*2); ctx.fillStyle=g; ctx.fill();
    ctx.strokeStyle='rgba(255,255,255,0.3)'; ctx.lineWidth=0.5; ctx.stroke();
  });
  // Buckets
  const numB=PLINKO_MULTS.length, bw=W/numB, bt=H-52;
  PLINKO_MULTS.forEach((m,i)=>{
    const bx=bw*i; const col=plinkoBucketColor(m); const hl=i===hBucket;
    ctx.fillStyle=col+(hl?'ee':'55');
    if(ctx.roundRect){ctx.beginPath();ctx.roundRect(bx+1,bt,bw-2,48,4);ctx.fill();}
    else{ctx.fillRect(bx+1,bt,bw-2,48);}
    if(hl){ctx.strokeStyle=col;ctx.lineWidth=2;ctx.beginPath();if(ctx.roundRect)ctx.roundRect(bx+1,bt,bw-2,48,4);else ctx.rect(bx+1,bt,bw-2,48);ctx.stroke();}
    ctx.fillStyle='#fff'; ctx.font=`bold ${m>=100?9:10}px 'Barlow Condensed',sans-serif`; ctx.textAlign='center';
    ctx.fillText(m>=1000?'1K√ó':m+'√ó',bx+bw/2,bt+26);
  });
  // Ball
  if(ball){
    const bg2=ctx.createRadialGradient(ball.x-2,ball.y-2,1,ball.x,ball.y,9);
    bg2.addColorStop(0,'#fff'); bg2.addColorStop(0.4,'#f0a500'); bg2.addColorStop(1,'#c07800');
    ctx.beginPath(); ctx.arc(ball.x,ball.y,8,0,Math.PI*2);
    ctx.shadowColor='#f0a500'; ctx.shadowBlur=16; ctx.fillStyle=bg2; ctx.fill(); ctx.shadowBlur=0;
  }
}
function plinkoDrop(){
  if(plinkoActive){notify('Ball still in flight!','error');return;}
  if(!plinkoCanvas)initPlinko();
  const bet=parseFloat(document.getElementById('plinko-bet').value)||10;
  if(!checkBal(bet))return;
  G.balance-=bet; renderSidebar();
  addHistory('Plinko Bet',-bet,'expense');
  plinkoActive=true;
  document.getElementById('plinko-result').textContent='';
  // Simulate bounces
  let bucketPos=0;
  const bounces=[];
  for(let r=0;r<PLINKO_ROWS;r++){const d=Math.random()<0.5?0:1;bounces.push(d);bucketPos+=d;}
  // Build waypoints through actual peg positions
  const W=440,H=420,TOP=28,BOTTOM=365;
  const rowSpacing=(BOTTOM-TOP)/(PLINKO_ROWS-1);
  const pathPts=[{x:W/2,y:8}];
  let cumB=0;
  for(let r=0;r<PLINKO_ROWS;r++){
    cumB+=bounces[r];
    const numPegs=r+3;
    const span=W*0.14+(W*0.72)*(r/(PLINKO_ROWS-1));
    const startX=W/2-span/2;
    const pegSpacing=numPegs>1?span/(numPegs-1):0;
    const ry=TOP+r*rowSpacing;
    // Ball lands between peg (cumB-1) and (cumB) in gap
    const gx=startX+(cumB-0.5)*pegSpacing+(Math.random()-0.5)*4;
    pathPts.push({x:clamp(gx,12,W-12),y:ry+rowSpacing*0.45});
  }
  const bw=W/PLINKO_MULTS.length;
  pathPts.push({x:bw*bucketPos+bw/2,y:H-26});
  // Animate
  let pIdx=0,prog=0;
  const ball={x:pathPts[0].x,y:pathPts[0].y};
  const SPEED=0.07;
  const tick=()=>{
    if(!plinkoActive)return;
    prog+=SPEED;
    if(prog>=1){
      prog=0; pIdx++;
      if(pIdx>=pathPts.length-1){
        ball.x=pathPts[pathPts.length-1].x; ball.y=pathPts[pathPts.length-1].y;
        drawPlinkoBoard(ball,pathPts,bucketPos); plinkoActive=false;
        const mult=PLINKO_MULTS[bucketPos];
        setTimeout(()=>{
          if(mult>=1){
            casinoWin(bet*mult,'Plinko '+(mult>=1000?'1000':mult)+'√ó');
            document.getElementById('plinko-result').textContent='‚úÖ '+(mult>=1000?'1000':mult)+'√ó ‚Äî Won $'+fmt(bet*mult);
            document.getElementById('plinko-result').style.color=plinkoBucketColor(mult);
            playSound(mult>=100?'knife':'win');
          }else{
            const got=+(bet*mult).toFixed(2); G.balance+=got; renderSidebar();
            addHistory('Plinko '+mult+'√ó partial',got,'neutral');
            document.getElementById('plinko-result').textContent='‚ùå '+mult+'√ó ‚Äî Lost $'+fmt(bet-got);
            document.getElementById('plinko-result').style.color='var(--red)'; playSound('lose');
          }
          drawPlinkoBoard(null,null,bucketPos);
          setTimeout(()=>drawPlinkoBoard(),1800);
        },300);
        return;
      }
    }
    const fr=pathPts[pIdx],to=pathPts[pIdx+1];
    const t=easeInOut(prog);
    ball.x=fr.x+(to.x-fr.x)*t; ball.y=fr.y+(to.y-fr.y)*t;
    drawPlinkoBoard(ball,null,-1);
    requestAnimationFrame(tick);
  };
  requestAnimationFrame(tick);
}

// --- COINFLIP ---
let cfFlipping=false;
function coinflip(side){
  if(cfFlipping)return;
  const bet=parseFloat(document.getElementById('cf-bet').value)||10;
  if(!checkBal(bet))return;
  cfFlipping=true;
  const coin=document.getElementById('coin');
  coin.classList.remove('flipping');void coin.offsetWidth;coin.classList.add('flipping');
  playSound('coin');
  setTimeout(()=>{
    const result=Math.random()<0.5?'heads':'tails';
    cfFlipping=false;
    const res=document.getElementById('cf-result');
    if(result===side){casinoWin(bet*2,'Coinflip Win');res.textContent=`‚úÖ ${result.toUpperCase()}! Won $${fmt(bet)}`;res.style.color='var(--green)';playSound('win');}
    else{casinoLose(bet,'Coinflip Loss');res.textContent=`‚ùå ${result.toUpperCase()}! Lost $${fmt(bet)}`;res.style.color='var(--red)';playSound('lose');}
  },1600);
  addHistory('Coinflip Bet',-bet,'expense');
}

// ============================================================
// JACKPOT
// ============================================================
const BOT_NAMES=['xXSniper99Xx','CSGO_Pro','Drop_King','MrHyper','SilentStrike'];
function jpEnter(){
  const bet=parseFloat(document.getElementById('jp-bet-input').value)||50;
  if(!checkBal(bet))return;
  G.balance-=bet;G.jpPot=(G.jpPot||0)+bet;
  G.jpEntries=G.jpEntries||[];
  const colors=['#4b69ff','#d32ce6','#eb4b4b','#2ecc71','#f0a500'];
  G.jpEntries.push({name:G.username,amount:bet,color:colors[G.jpEntries.length%colors.length]});
  // Add bots
  const botAmt=bet*(0.2+Math.random()*2);
  G.jpEntries.push({name:BOT_NAMES[Math.random()*BOT_NAMES.length|0],amount:+botAmt.toFixed(2),color:colors[Math.random()*colors.length|0]});
  G.jpPot+=botAmt;
  renderJackpot();addHistory('Jackpot Entry',-bet,'expense');renderSidebar();
  notify('Entered jackpot with $'+fmt(bet),'success');
}
function renderJackpot(){
  document.getElementById('jp-total').textContent='$'+fmt(G.jpPot||0);
  const entries=G.jpEntries||[];
  document.getElementById('jp-players-count').textContent=entries.length+' players';
  const total=entries.reduce((s,e)=>s+e.amount,0)||1;
  document.getElementById('jp-entries').innerHTML=entries.map(e=>`
    <div class="jackpot-entry">
      <div class="jackpot-bar" style="width:${(e.amount/total*100).toFixed(1)}%;background:${e.color};min-width:20px;height:8px;border-radius:4px;flex-shrink:0"></div>
      <span style="font-weight:600;min-width:100px">${e.name}</span>
      <span style="font-family:'Barlow Condensed',sans-serif;color:var(--accent)">${(e.amount/total*100).toFixed(1)}%</span>
      <span style="margin-left:auto;color:var(--text2)">$${fmt(e.amount)}</span>
    </div>
  `).join('');
}
function jpSpin(){
  if(!G.jpEntries||!G.jpEntries.length){notify('No entries!','error');return;}
  // Weighted random
  const total=G.jpEntries.reduce((s,e)=>s+e.amount,0);
  let roll=Math.random()*total;
  let winner=G.jpEntries[0];
  for(const e of G.jpEntries){roll-=e.amount;if(roll<=0){winner=e;break;}}
  // Animate strip
  const strip=document.getElementById('jp-strip');
  const colors=G.jpEntries.map(e=>e.color);
  const segments=[];for(let i=0;i<80;i++)segments.push(G.jpEntries[i%G.jpEntries.length]);
  // Place winner near end
  const winIdx=70;segments[winIdx]={...winner};
  strip.innerHTML=segments.map(s=>`<div class="jackpot-strip-seg" style="background:${s.color};width:${(s.amount/total*400).toFixed(0)}px;min-width:60px">${s.name}</div>`).join('');
  document.getElementById('jp-wheel-wrap').style.display='block';
  const segW=Math.max(60,winner.amount/total*400);
  const targetX=winIdx*segW-(strip.parentElement.offsetWidth/2-segW/2);
  strip.style.transition='none';strip.style.transform='translateX(0)';
  setTimeout(()=>{strip.style.transition='transform 4s cubic-bezier(.17,.67,.12,.99)';strip.style.transform=`translateX(-${targetX}px)`;},50);
  setTimeout(()=>{
    const pot=G.jpPot||0;
    if(winner.name===G.username){
      G.balance+=pot;G.totalEarned+=pot;
      addHistory('üèÜ Won Jackpot!',pot,'win');
      document.getElementById('jp-result').textContent='üèÜ YOU WON the jackpot! +$'+fmt(pot);
      document.getElementById('jp-result').style.color='var(--gold)';
      notify('üèÜ JACKPOT! You won $'+fmt(pot)+'!','rare');playSound('knife');
    }else{
      document.getElementById('jp-result').textContent=winner.name+' won the jackpot ($'+fmt(pot)+')!';
      document.getElementById('jp-result').style.color='var(--red)';
    }
    G.jpPot=0;G.jpEntries=[];renderJackpot();renderSidebar();saveGame();
  },4200);
}

// ============================================================
// CASE BATTLES
// ============================================================
const battleBots=['[BOT] AWP_God','[BOT] HeadShot','[BOT] FragMaster','[BOT] CaseKing'];
function startBattle(){
  const caseId=document.getElementById('battle-case-select').value;
  const mode=document.getElementById('battle-mode').value;
  const rounds=parseInt(document.getElementById('battle-rounds').value)||3;
  const c=CASES.find(x=>x.id===caseId);
  if(!c)return;
  const numPlayers=mode==='1v1'?2:mode==='2v2'?4:4;
  const totalCost=c.price*rounds;
  if(!checkBal(totalCost))return;
  G.balance-=totalCost;renderSidebar();
  addHistory('Case Battle Entry',-totalCost,'expense');
  const players=[{name:G.username,skins:[],total:0,isPlayer:true}];
  for(let i=1;i<numPlayers;i++)players.push({name:battleBots[i-1],skins:[],total:0,isPlayer:false});
  for(const p of players){for(let r=0;r<rounds;r++){const s=generateSkin(rollRarity(),c.name);p.skins.push(s);p.total+=s.price;}}
  const winner=players.reduce((a,b)=>b.total>a.total?b:a);
  const allSkins=players.flatMap(p=>p.skins);
  const prize=allSkins.reduce((s,sk)=>s+sk.price,0);
  const wrap=document.getElementById('battle-result-wrap');
  wrap.style.display='block';
  wrap.innerHTML=`
    <div class="section-title">‚öîÔ∏è Battle Results</div>
    <div class="battle-result-row" style="display:flex;gap:12px;flex-wrap:wrap">
      ${players.map(p=>`
        <div class="battle-col ${p.name===winner.name?'winner':''}">
          <div style="font-weight:700;font-size:16px;margin-bottom:4px">${p.name===winner.name?'üëë ':''}${p.name}</div>
          <div style="font-family:'Barlow Condensed',sans-serif;font-size:22px;color:${p.name===winner.name?'var(--gold)':'var(--text2)'}">$${fmt(p.total)}</div>
          <div class="battle-items">${p.skins.map(s=>`<div class="battle-item rarity-${s.rarity}" style="border-color:${RARITIES[s.rarity].color}60">${s.icon}<div class="battle-item-val">$${fmt(s.price)}</div></div>`).join('')}</div>
        </div>
      `).join('')}
    </div>
    <div style="text-align:center;margin-top:12px;font-family:'Rajdhani',sans-serif;font-size:20px">
      ${winner.name===G.username?`<span style="color:var(--gold)">üèÜ You won the battle! +$${fmt(prize)}</span>`:`<span style="color:var(--red)">‚ùå ${winner.name} won the battle!</span>`}
    </div>
  `;
  if(winner.isPlayer){casinoWin(prize,'Case Battle Win');playSound('win');}
  else playSound('lose');
}

// ============================================================
// TRADE-UP CONTRACT
// ============================================================
let tradeupSlots=Array(10).fill(null);
function renderTradeupGrid(){
  const grid=document.getElementById('tradeup-grid');
  grid.innerHTML=tradeupSlots.map((_,i)=>`
    <div class="tradeup-slot ${tradeupSlots[i]?'filled rarity-'+tradeupSlots[i].rarity:''}" onclick="tradeupAddSkin(${i})">
      ${tradeupSlots[i]?tradeupSlots[i].icon+'<div style="font-size:8px;margin-top:2px">'+tradeupSlots[i].name.slice(0,15)+'</div>':'‚ûï'}
    </div>
  `).join('');
  const filled=tradeupSlots.filter(Boolean);
  const rarities=[...new Set(filled.map(s=>s.rarity))];
  const info=document.getElementById('tradeup-info');
  if(filled.length<10)info.textContent=`Select ${10-filled.length} more skin(s) of the same rarity`;
  else if(rarities.length>1)info.textContent='All skins must be the same rarity!';
  else info.textContent='Ready! Costs: $'+fmt(filled.reduce((s,x)=>s+x.price,0))+' avg ‚Üí higher tier';
}
function tradeupAddSkin(slot){
  // Show quick picker from inventory
  const rarity=tradeupSlots.find(Boolean)?.rarity;
  const avail=G.inventory.filter(s=>!tradeupSlots.includes(s)&&(!rarity||s.rarity===rarity));
  if(!avail.length){notify('No eligible skins in inventory!','error');return;}
  const skin=avail[0];// Auto-pick first; a real UI would show a picker
  tradeupSlots[slot]=skin;
  renderTradeupGrid();
}
function doTradeup(){
  const filled=tradeupSlots.filter(Boolean);
  if(filled.length<10){notify('Need 10 skins!','error');return;}
  const rarities=[...new Set(filled.map(s=>s.rarity))];
  if(rarities.length>1){notify('All skins must be same rarity!','error');return;}
  const rarityOrder=['consumer','industrial','milspec','restricted','classified','covert','knife'];
  const idx=rarityOrder.indexOf(rarities[0]);
  const nextRarity=rarityOrder[Math.min(idx+1,rarityOrder.length-1)];
  // Remove from inventory
  filled.forEach(s=>{const i=G.inventory.findIndex(x=>x.id===s.id);if(i>=0)G.inventory.splice(i,1);});
  tradeupSlots=Array(10).fill(null);
  const result=generateSkin(nextRarity,'Trade-Up');
  G.inventory.push(result);
  renderTradeupGrid();renderInventory();
  document.getElementById('tradeup-result').innerHTML=`<span style="color:${RARITIES[nextRarity].color}">üéâ Trade-Up Result: ${result.icon} ${result.name} ($${fmt(result.price)})</span>`;
  addXP(50);notify('Trade-Up complete! Got a '+RARITIES[nextRarity].name,'success');
  if(nextRarity==='knife'||nextRarity==='covert'){showKnifeOverlay(result);spawnParticles();}
}

// ============================================================
// BANK
// ============================================================
function bankDeposit(){
  const amt=parseFloat(document.getElementById('deposit-amount').value)||0;
  if(amt<=0||!checkBal(amt))return;
  G.balance-=amt;G.bankBalance+=amt;
  addHistory('Deposited to Bank',-amt,'expense');renderSidebar();notify('Deposited $'+fmt(amt),'success');
}
function bankWithdraw(){
  const amt=parseFloat(document.getElementById('withdraw-amount').value)||0;
  if(amt<=0||G.bankBalance<amt){notify('Insufficient bank balance!','error');return;}
  G.bankBalance-=amt;G.balance+=amt;
  addHistory('Withdrew from Bank',amt,'win');renderSidebar();notify('Withdrew $'+fmt(amt),'success');
}
function takeLoan(){
  const amt=parseFloat(document.getElementById('loan-amount').value)||0;
  if(amt<=0)return;
  G.loan=(G.loan||0)+amt;G.balance+=amt;
  addHistory('Bank Loan',amt,'win');renderSidebar();
  notify('‚ö†Ô∏è Loan of $'+fmt(amt)+' taken (10% daily interest)','error');
}
function repayLoan(){
  const loan=G.loan||0;if(!loan)return;
  if(!checkBal(loan)){notify('Not enough to repay!','error');return;}
  G.balance-=loan;G.loan=0;
  addHistory('Repaid Loan',-loan,'expense');renderSidebar();notify('Loan repaid!','success');
}
function checkInterest(){
  if(!G)return;
  const now=Date.now();
  const dayMs=86400000;
  if(G.bankBalance>0&&now-G.lastInterest>dayMs){
    const interest=G.bankBalance*0.02;
    G.bankBalance+=interest;G.totalEarned+=interest;
    addHistory('Bank Interest',interest,'win');G.lastInterest=now;
    notify('üí∞ Bank interest: +$'+fmt(interest),'success');
  }
  if(G.loan>0&&now-G.lastLoanInterest>dayMs){
    const interest=G.loan*0.10;G.loan+=interest;
    addHistory('Loan Interest',-interest,'expense');G.lastLoanInterest=now;
    notify('‚ö†Ô∏è Loan interest: -$'+fmt(interest),'error');
  }
  renderSidebar();
}

// ============================================================
// MARKETPLACE
// ============================================================
let marketItems=[];
function generateMarketItems(){
  if(marketItems.length>0)return;
  for(let i=0;i<40;i++){
    const rarity=rollRarity();
    const skin=generateSkin(rarity,'Market');
    skin.listed=true;skin.seller=BOT_NAMES[Math.random()*BOT_NAMES.length|0];
    skin.trend=G.marketTrend[G.marketTrend.length-1]||1;
    marketItems.push(skin);
  }
}
function fluctuateMarket(){
  const trend=G.marketTrend;
  const last=trend[trend.length-1];
  const change=(Math.random()-0.48)*0.05;
  const newVal=Math.max(0.5,Math.min(2,last+change));
  trend.push(+newVal.toFixed(3));
  if(trend.length>30)trend.shift();
  marketItems.forEach(i=>i.price=+(i.price*(0.99+Math.random()*0.02)).toFixed(2));
}
function renderMarket(){
  generateMarketItems();
  const search=document.getElementById('market-search')?.value?.toLowerCase()||'';
  const sort=document.getElementById('market-sort')?.value||'popular';
  let items=[...marketItems];
  if(search)items=items.filter(i=>i.name.toLowerCase().includes(search));
  if(sort==='price-h')items.sort((a,b)=>b.price-a.price);
  else if(sort==='price-l')items.sort((a,b)=>a.price-b.price);
  const list=document.getElementById('market-list');
  if(!list)return;
  list.innerHTML=items.slice(0,20).map(i=>`
    <div class="market-item">
      <div class="market-item-img" style="background:${RARITIES[i.rarity].color}20;padding:10px;border-radius:8px">${i.icon}</div>
      <div class="market-item-info">
        <div style="font-weight:600;font-size:13px">${i.name}</div>
        <div style="font-size:11px;color:${RARITIES[i.rarity].color}">${RARITIES[i.rarity].name}</div>
        <div style="font-size:11px;color:var(--text3)">${i.wear} ¬∑ Float: ${i.float.toFixed(4)}</div>
        <div style="font-size:11px;color:var(--text3)">Seller: ${i.seller}</div>
      </div>
      <div style="text-align:right">
        <div class="market-price">$${fmt(i.price)}</div>
        <button class="market-btn" onclick="buyMarketItem('${i.id}')">Buy</button>
      </div>
    </div>
  `).join('');
}
function buyMarketItem(id){
  const item=marketItems.find(i=>i.id===id);
  if(!item)return;
  if(!checkBal(item.price))return;
  G.balance-=item.price;
  const newSkin={...item,date:Date.now(),listed:false};
  G.inventory.push(newSkin);
  marketItems=marketItems.filter(i=>i.id!==id);
  addHistory('Market Buy: '+item.name,-item.price,'expense');
  renderInventory();renderMarket();renderSidebar();
  notify('Purchased '+item.name,'success');
}
function renderMarketChart(){
  const canvas=document.getElementById('market-canvas');
  if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const w=canvas.width,h=canvas.height;
  const pts=G.marketTrend;
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#13141a';ctx.fillRect(0,0,w,h);
  if(pts.length<2)return;
  const min=Math.min(...pts),max=Math.max(...pts);
  const range=max-min||0.1;
  const lastVal=pts[pts.length-1];
  const firstVal=pts[0];
  const isUp=lastVal>=firstVal;
  ctx.beginPath();ctx.strokeStyle=isUp?'#2ecc71':'#e74c3c';ctx.lineWidth=2;
  pts.forEach((v,i)=>{const x=i/(pts.length-1)*w;const y=h-(v-min)/range*(h-10)-5;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.stroke();
  ctx.lineTo(w,h);ctx.lineTo(0,h);ctx.closePath();
  ctx.fillStyle=(isUp?'rgba(46,204,113,0.1)':'rgba(231,76,60,0.1)');ctx.fill();
}

// ============================================================
// MISSIONS
// ============================================================
function updateMissionProgress(){
  if(!G.missions)return;
  const all=[...G.missions.daily,...G.missions.weekly];
  all.forEach(m=>{
    let cur=0;
    if(m.req==='casesOpened')cur=G.casesOpened-(m.start||0);
    else if(m.req==='casinoWins')cur=G.casinoWins-(m.start||0);
    else if(m.req==='totalClicks')cur=G.totalClicks-(m.start||0);
    else if(m.req==='casinoWinAmount')cur=G.missions.casinoWinAmount||0;
    else if(m.req==='invCount')cur=G.inventory.length;
    else if(m.req==='totalEarned')cur=G.totalEarned;
    m.progress=Math.min(m.goal,Math.max(0,cur));
  });
}
function renderMissions(){
  updateMissionProgress();
  renderMissionList('daily-missions',G.missions.daily);
  renderMissionList('weekly-missions',G.missions.weekly);
}
function renderMissionList(id,list){
  const el=document.getElementById(id);if(!el)return;
  el.innerHTML=list.map(m=>{
    const pct=Math.min(100,((m.progress||0)/m.goal)*100);
    const done=m.progress>=m.goal;
    return `<div class="mission-card">
      <div class="mission-icon">${m.icon}</div>
      <div class="mission-info">
        <div class="mission-name">${m.name}</div>
        <div style="font-size:12px;color:var(--text2)">${m.desc}</div>
        <div class="mission-prog"><div class="mission-fill" style="width:${pct}%"></div></div>
        <div style="font-size:11px;color:var(--text3);margin-top:3px">${m.progress||0} / ${m.goal}</div>
        ${done&&!m.claimed?`<button class="mission-claim-btn" style="display:inline-block" onclick="claimMission('${m.id}')">Claim $${fmt(m.reward)}</button>`:
          m.claimed?'<div style="font-size:11px;color:var(--green);margin-top:4px">‚úì Claimed</div>':''}
      </div>
      <div class="mission-reward">+$${fmt(m.reward)}</div>
    </div>`;
  }).join('');
}
function claimMission(id){
  const all=[...G.missions.daily,...G.missions.weekly];
  const m=all.find(x=>x.id===id);
  if(!m||m.claimed||m.progress<m.goal)return;
  m.claimed=true;addBalance(m.reward,'Mission Reward: '+m.name,'win');
  notify('Claimed $'+fmt(m.reward)+' reward!','success');addXP(50);renderMissions();
}
function checkMissions(){updateMissionProgress();checkMissionBadge();}
function checkMissionBadge(){
  if(!G.missions)return;
  const all=[...G.missions.daily,...G.missions.weekly];
  const hasClaimable=all.some(m=>!m.claimed&&(m.progress||0)>=m.goal);
  const badge=document.getElementById('mission-badge');
  if(badge)badge.style.display=hasClaimable?'inline':'none';
}

// ============================================================
// BATTLE PASS
// ============================================================
const BP_REWARDS=[
  {level:1,free:'üì¶ Case',premium:'üí∞ $50'},
  {level:2,free:'üí∞ $25',premium:'üé® Rare Skin'},
  {level:3,free:'üé≤ Free Spin',premium:'üíé Classified Skin'},
  {level:4,free:'üí∞ $50',premium:'üí∞ $200'},
  {level:5,free:'üì¶ 2√ó Cases',premium:'üî™ Knife Chance'},
  {level:6,free:'üí∞ $75',premium:'üí∞ $300'},
  {level:7,free:'üéí Skin',premium:'üåü Covert Skin'},
  {level:8,free:'üí∞ $100',premium:'üí∞ $500'},
  {level:9,free:'üì¶ 3√ó Cases',premium:'üíé Ultra Rare'},
  {level:10,free:'üëë Title',premium:'üî™ Guaranteed Knife'},
];
function renderBattlePass(){
  const track=document.getElementById('bp-track');
  if(!track)return;
  track.innerHTML=BP_REWARDS.map((r,i)=>`
    <div class="bp-node">
      <div class="bp-circle ${(G.bpLevel||1)>i+1?'completed':(G.bpLevel||1)===i+1?'current':''}">
        ${(G.bpLevel||1)>i+1?'‚úì':(i+1)}
      </div>
      <div class="bp-label">Lv ${i+1}</div>
      <div class="bp-reward" style="color:#88b87a">${r.free}</div>
      ${G.bpPremium?`<div class="bp-reward" style="color:var(--gold)">${r.premium}</div>`:''}
    </div>
  `).join('');
  document.getElementById('bp-level-display').textContent=G.bpLevel||1;
  const xpNeeded=500;
  document.getElementById('bp-xp-display').textContent=(G.bpXP||0)+' / '+xpNeeded;
  document.getElementById('bp-xp-bar').style.width=Math.min(100,((G.bpXP||0)/xpNeeded)*100)+'%';
}
function updateBP(){
  if(!G)return;
  checkBPLevelUp();
}
function checkBPLevelUp(){
  const xpNeeded=500;
  while((G.bpXP||0)>=xpNeeded){
    G.bpXP-=xpNeeded;G.bpLevel=(G.bpLevel||1)+1;
    claimBPReward(G.bpLevel-1);renderBattlePass();
    notify('üé´ Battle Pass Level '+(G.bpLevel)+'!','success');
  }
}
function claimBPReward(levelIdx){
  const reward=BP_REWARDS[levelIdx];if(!reward)return;
  if(reward.free.includes('$')){const amt=parseInt(reward.free.replace(/[^0-9]/g,''));addBalance(amt,'BP Reward: '+reward.free,'win');}
  else if(reward.free.includes('Case')){
    const num=parseInt(reward.free)||1;
    for(let i=0;i<num;i++){const s=generateSkin(rollRarity(),'Battle Pass');G.inventory.push(s);}
    renderInventory();notify('üì¶ Got '+reward.free+' from Battle Pass!','success');
  }
  if(G.bpPremium&&reward.premium){
    if(reward.premium.includes('$')){const amt=parseInt(reward.premium.replace(/[^0-9]/g,''));addBalance(amt,'BP Premium Reward','win');}
    else if(reward.premium.includes('Knife')){const s=generateSkin('knife','Battle Pass');G.inventory.push(s);showKnifeOverlay(s);spawnParticles();renderInventory();}
    else if(reward.premium.includes('Covert')){const s=generateSkin('covert','BP Premium');G.inventory.push(s);renderInventory();}
    else if(reward.premium.includes('Classified')){const s=generateSkin('classified','BP Premium');G.inventory.push(s);renderInventory();}
  }
}
function upgradeToPremium(){
  if(G.bpPremium){notify('Already Premium!');return;}
  if(!checkBal(9.99))return;
  G.balance-=9.99;G.bpPremium=true;renderBattlePass();renderSidebar();
  notify('‚≠ê Upgraded to Premium Battle Pass!','success');
  document.getElementById('premium-upgrade').style.display='none';
}

// ============================================================
// STATS
// ============================================================
function renderStats(){
  const totalInvVal=G.inventory.reduce((s,i)=>s+i.price,0);
  const netWorth=G.balance+G.bankBalance+totalInvVal;
  const stats=[
    {label:'Total Cases Opened',val:fmt(G.casesOpened)},
    {label:'Casino Wins',val:fmt(G.casinoWins)},
    {label:'Casino Losses',val:fmt(G.casinoLosses)},
    {label:'Total Earned',val:'$'+fmt(G.totalEarned)},
    {label:'Sell Profit',val:'$'+fmt(G.sellProfit)},
    {label:'Net Worth',val:'$'+fmt(netWorth)},
    {label:'Inventory Value',val:'$'+fmt(totalInvVal)},
    {label:'Skins in Inventory',val:G.inventory.length},
    {label:'Total Clicks',val:fmt(G.totalClicks)},
    {label:'Current Level',val:G.level},
    {label:'Rebirths',val:G.rebirths},
    {label:'Knives Unboxed',val:G.knivesUnboxed||0},
  ];
  const cards=document.getElementById('stat-cards');
  if(cards)cards.innerHTML=stats.map(s=>`<div class="stat-card"><div class="stat-val">${s.val}</div><div class="stat-label">${s.label}</div></div>`).join('');
  // Draw net worth chart
  const canvas=document.getElementById('stats-canvas');
  if(!canvas)return;
  const pts=G.netWorthSamples;
  if(pts.length<2)return;
  const ctx=canvas.getContext('2d');
  canvas.width=canvas.offsetWidth||600;
  const w=canvas.width,h=150;canvas.height=h;
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#13141a';ctx.fillRect(0,0,w,h);
  const vals=pts.map(p=>p.v);
  const min=Math.min(...vals),max=Math.max(...vals);
  const range=max-min||1;
  ctx.beginPath();ctx.strokeStyle='#f0a500';ctx.lineWidth=2;
  pts.forEach((p,i)=>{const x=i/(pts.length-1)*w;const y=h-(p.v-min)/range*(h-20)-10;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.stroke();
  ctx.lineTo(w,h);ctx.lineTo(0,h);ctx.closePath();ctx.fillStyle='rgba(240,165,0,0.08)';ctx.fill();
  renderHistoryPanel(document.getElementById('stats-history'));
}

// ============================================================
// LEADERBOARD
// ============================================================
let lbMode='wealth';
const LB_BOTS=[
  {name:'xXSniper99Xx',level:42,casesOpened:3842,casinoWins:289,netWorth:87500,avatar:'‚ö°'},
  {name:'DROP_KING',level:67,casesOpened:12400,casinoWins:890,netWorth:312000,avatar:'üëë'},
  {name:'FragMaster99',level:28,casesOpened:1240,casinoWins:105,netWorth:24000,avatar:'üíÄ'},
  {name:'CaseAddict',level:55,casesOpened:8900,casinoWins:440,netWorth:185000,avatar:'üì¶'},
  {name:'HighRoller',level:80,casesOpened:22000,casinoWins:1200,netWorth:750000,avatar:'üíé'},
];
function showLB(mode){
  lbMode=mode;
  document.querySelectorAll('#page-leaderboard .filter-btn').forEach((b,i)=>{b.classList.toggle('active',['wealth','opens','wins'][i]===mode);});
  renderLeaderboard();
}
function renderLeaderboard(){
  const me={name:G.username,level:G.level,casesOpened:G.casesOpened,casinoWins:G.casinoWins,netWorth:G.balance+G.bankBalance+inventoryValue(),avatar:G.username.slice(0,2).toUpperCase(),isMe:true};
  const all=[...LB_BOTS,me];
  let sorted;
  if(lbMode==='wealth')sorted=all.sort((a,b)=>b.netWorth-a.netWorth);
  else if(lbMode==='opens')sorted=all.sort((a,b)=>b.casesOpened-a.casesOpened);
  else sorted=all.sort((a,b)=>b.casinoWins-a.casinoWins);
  const rankColors=['gold','silver','bronze'];
  const el=document.getElementById('leaderboard-list');
  if(!el)return;
  el.innerHTML=sorted.map((p,i)=>`
    <div class="lb-item" style="${p.isMe?'border-color:var(--accent);':''}">
      <div class="lb-rank ${rankColors[i]||''}">${i+1}</div>
      <div class="lb-avatar" style="background:${['#4b69ff','#8847ff','#d32ce6','#eb4b4b','#f0a500','#2ecc71'][i%6]}20;border:1px solid ${['#4b69ff','#8847ff','#d32ce6','#eb4b4b','#f0a500','#2ecc71'][i%6]}60">${p.avatar||p.name.slice(0,2).toUpperCase()}</div>
      <div class="lb-info">
        <div class="lb-name">${p.name}${p.isMe?' (You)':''}</div>
        <div class="lb-val">Level ${p.level} ¬∑ ${p.casesOpened} cases</div>
      </div>
      <div class="lb-amount">${lbMode==='wealth'?'$'+fmt(p.netWorth):lbMode==='opens'?fmt(p.casesOpened)+' opens':fmt(p.casinoWins)+' wins'}</div>
    </div>
  `).join('');
}

// ============================================================
// ACHIEVEMENTS
// ============================================================
function checkAchievements(){
  G.achievements.forEach(a=>{
    if(a.done)return;
    let cur=0;
    if(a.req==='casesOpened')cur=G.casesOpened;
    else if(a.req==='knivesUnboxed')cur=G.knivesUnboxed;
    else if(a.req==='totalEarned')cur=G.totalEarned;
    else if(a.req==='casinoWins')cur=G.casinoWins;
    else if(a.req==='invCount')cur=G.inventory.length;
    else if(a.req==='rebirths')cur=G.rebirths;
    else if(a.req==='sellProfit')cur=G.sellProfit;
    if(cur>=a.val){a.done=true;notify('üèÜ Achievement Unlocked: '+a.name,'success');addXP(100);}
  });
}
function renderAchievements(){
  const grid=document.getElementById('achievements-grid');
  if(!grid)return;
  grid.innerHTML=(G.achievements||ACHIEVEMENTS).map(a=>`
    <div class="card ${a.done?'':''}">
      <div style="font-size:28px;margin-bottom:6px">${a.done?a.icon:'üîí'}</div>
      <div style="font-weight:700;font-size:13px;margin-bottom:2px">${a.name}</div>
      <div style="font-size:11px;color:var(--text2)">${a.desc}</div>
      ${a.done?'<div style="font-size:11px;color:var(--green);margin-top:4px">‚úì Unlocked</div>':''}
    </div>
  `).join('');
}

// ============================================================
// WEEKEND BONUS
// ============================================================
function isWeekend(){const d=new Date().getDay();return d===0||d===6;}
function checkWeekend(){
  const w=isWeekend();
  document.getElementById('weekend-banner').classList.toggle('hidden',!w);
  document.getElementById('weekend-banner2').classList.toggle('hidden',!w);
  document.getElementById('weekend-stat').style.display=w?'flex':'none';
}

// ============================================================
// ADMIN PANEL
// ============================================================
function adminAddBalance(){const amt=parseFloat(document.getElementById('admin-balance').value)||0;addBalance(amt,'Admin: Add Balance','win');notify('Added $'+fmt(amt),'success');}
function adminAddXP(){const amt=parseInt(document.getElementById('admin-xp').value)||0;addXP(amt);notify('Added '+amt+' XP','success');}
function adminSpawnSkin(){const r=document.getElementById('admin-skin-rarity').value;const s=generateSkin(r,'Admin Spawn');G.inventory.push(s);renderInventory();renderSidebar();notify('Spawned: '+s.name,'success');if(r==='knife'){showKnifeOverlay(s);spawnParticles();}}
function adminSetLevel(){const l=parseInt(document.getElementById('admin-level').value)||1;G.level=l;G.xp=0;renderSidebar();notify('Level set to '+l,'success');}
function adminToggleLuck(){G.luckBonus=G.luckBonus>0?0:100;notify('Luck bonus: '+(G.luckBonus>0?'ON (100%)':'OFF'),'success');}
function adminMaxUpgrades(){UPGRADES.forEach(u=>{const maxL=u.max||10;const cur=G.upgrades[u.id]||0;const add=maxL-cur;for(let i=0;i<add;i++){if(u.clickAdd)G.clickValue+=u.clickAdd;if(u.cpsAdd)G.cps+=u.cpsAdd;if(u.luckAdd)G.luckBonus=(G.luckBonus||0)+u.luckAdd;}G.upgrades[u.id]=maxL;});renderUpgrades();renderSidebar();notify('All upgrades maxed!','success');}

// ============================================================
// NOTIFICATIONS
// ============================================================
function notify(msg,type='info'){
  const c=document.getElementById('notif-container');
  const n=document.createElement('div');
  n.className='notif '+(type||'');
  n.textContent=msg;
  c.appendChild(n);
  setTimeout(()=>{n.style.animation='notifOut .3s forwards';setTimeout(()=>n.remove(),300);},3000);
}

// ============================================================
// SOUND (Web Audio API)
// ============================================================
let audioCtx=null;
function getAudio(){if(!audioCtx)try{audioCtx=new(window.AudioContext||window.webkitAudioContext)();}catch(e){}return audioCtx;}
function playSound(type){
  if(!G?.sfxOn)return;
  try{
    const ctx=getAudio();if(!ctx)return;
    const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);
    const sounds={click:[800,0.03,0.05,'square'],win:[523,0.15,0.3,'sine'],lose:[200,0.1,0.2,'sawtooth'],rare:[1046,0.2,0.5,'sine'],knife:[1600,0.3,1,'sine'],buy:[660,0.1,0.15,'sine'],card:[440,0.05,0.08,'triangle'],slots:[330,0.1,0.15,'square'],coin:[880,0.15,0.3,'sine'],case_open:[392,0.2,0.4,'sine']};
    const s=sounds[type]||sounds.click;
    o.type=s[3];o.frequency.setValueAtTime(s[0],ctx.currentTime);
    if(type==='win')o.frequency.exponentialRampToValueAtTime(s[0]*1.5,ctx.currentTime+s[2]);
    if(type==='knife'){o.frequency.setValueAtTime(s[0],ctx.currentTime);o.frequency.exponentialRampToValueAtTime(s[0]*2,ctx.currentTime+0.1);o.frequency.exponentialRampToValueAtTime(s[0],ctx.currentTime+0.5);}
    g.gain.setValueAtTime(s[1],ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+s[2]);
    o.start();o.stop(ctx.currentTime+s[2]+0.01);
  }catch(e){}
}

// ============================================================
// SETTINGS
// ============================================================
function toggleSFX(){
  const on=document.getElementById('sfx-toggle').checked;
  G.sfxOn=on;
  document.getElementById('sfx-knob').style.transform=on?'translateX(20px)':'translateX(0)';
  document.querySelector('#sfx-toggle+span').style.background=on?'var(--accent)':'var(--bg5)';
  saveGame();
}
function setTheme(t){
  G.theme=t;
  if(t==='light'){document.documentElement.style.setProperty('--bg','#f0f2f5');document.documentElement.style.setProperty('--bg2','#ffffff');document.documentElement.style.setProperty('--bg3','#f8f9fb');document.documentElement.style.setProperty('--bg4','#e8eaef');document.documentElement.style.setProperty('--text','#1a1b23');document.documentElement.style.setProperty('--text2','#5a5b70');}
  else{document.documentElement.style.setProperty('--bg','#0d0e12');document.documentElement.style.setProperty('--bg2','#13141a');document.documentElement.style.setProperty('--bg3','#1a1b23');document.documentElement.style.setProperty('--bg4','#22232e');document.documentElement.style.setProperty('--text','#e8e9f0');document.documentElement.style.setProperty('--text2','#9a9bb0');}
  saveGame();
}
function resetAllData(){
  if(!confirm('RESET ALL DATA? This cannot be undone!'))return;
  ACCOUNTS[currentUser].state=null;saveAccounts();location.reload();
}

// ============================================================
// SKIN INSPECT
// ============================================================
let inspectedSkinId=null;
function inspectSkin(id){
  const skin=G.inventory.find(s=>s.id===id);
  if(!skin)return;
  inspectedSkinId=id;
  const col=RARITIES[skin.rarity].color;
  document.getElementById('inspect-title').textContent=skin.name;
  document.getElementById('inspect-title').style.color=col;
  document.getElementById('inspect-art').innerHTML=`<div style="width:100%;height:100%">${getSkinSVG(skin)}</div>`;
  document.getElementById('inspect-weapon').textContent=skin.weapon;
  document.getElementById('inspect-finish').textContent=skin.finish;
  document.getElementById('inspect-rarity').textContent=RARITIES[skin.rarity].name;
  document.getElementById('inspect-rarity').style.color=col;
  document.getElementById('inspect-wear').textContent=skin.wear;
  document.getElementById('inspect-float').textContent=skin.float.toFixed(8);
  document.getElementById('inspect-seed').textContent=skin.pattern;
  document.getElementById('inspect-price').textContent='$'+fmt(skin.price);
  document.getElementById('inspect-price').style.color=col;
  document.getElementById('inspect-float-marker').style.left=(skin.float*100)+'%';
  document.getElementById('inspect-modal').style.display='flex';
}
function closeInspect(){document.getElementById('inspect-modal').style.display='none';inspectedSkinId=null;}
function sellInspected(){if(!inspectedSkinId)return;sellSkin(inspectedSkinId);closeInspect();}

// ============================================================
// DAILY SPIN WHEEL
// ============================================================
const SPIN_PRIZES=[
  {label:'$50',value:50,type:'cash',color:'#4b69ff'},
  {label:'$250',value:250,type:'cash',color:'#2ecc71'},
  {label:'$10',value:10,type:'cash',color:'#5e98d9'},
  {label:'Skin!',value:0,type:'skin_random',color:'#d32ce6'},
  {label:'$1,000',value:1000,type:'cash',color:'#e4ae39'},
  {label:'500 XP',value:500,type:'xp',color:'#00c8ff'},
  {label:'$100',value:100,type:'cash',color:'#8847ff'},
  {label:'KNIFE!',value:0,type:'skin_knife',color:'#e4ae39'},
  {label:'$500',value:500,type:'cash',color:'#eb4b4b'},
  {label:'200 XP',value:200,type:'xp',color:'#ff6b35'},
  {label:'$2,500',value:2500,type:'cash',color:'#f0a500'},
  {label:'Rare Skin',value:0,type:'skin_covert',color:'#eb4b4b'},
];
let spinCanvas=null,spinCtx=null,spinAngle=0,spinSpinning=false;

function drawSpinWheel(angle=0){
  const canvas=document.getElementById('spin-canvas');
  if(!canvas)return;
  if(!spinCtx)spinCtx=canvas.getContext('2d');
  const ctx=spinCtx,W=280,cx=140,cy=140,R=130;
  ctx.clearRect(0,0,W,W);
  const sliceAngle=(Math.PI*2)/SPIN_PRIZES.length;
  SPIN_PRIZES.forEach((p,i)=>{
    const start=angle+sliceAngle*i,end=start+sliceAngle;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,R,start,end); ctx.closePath();
    ctx.fillStyle=p.color+'cc'; ctx.fill();
    ctx.strokeStyle='rgba(255,255,255,0.15)'; ctx.lineWidth=1.5; ctx.stroke();
    ctx.save(); ctx.translate(cx,cy); ctx.rotate(start+sliceAngle/2);
    ctx.textAlign='right'; ctx.fillStyle='#fff';
    ctx.font=`bold ${p.label.length>4?9:11}px 'Barlow Condensed',sans-serif`;
    ctx.shadowColor='rgba(0,0,0,.7)'; ctx.shadowBlur=3;
    ctx.fillText(p.label,R-8,4); ctx.restore();
  });
  // Center circle
  ctx.beginPath(); ctx.arc(cx,cy,18,0,Math.PI*2);
  const grad=ctx.createRadialGradient(cx,cy,2,cx,cy,18);
  grad.addColorStop(0,'#f0a500'); grad.addColorStop(1,'#c07800');
  ctx.fillStyle=grad; ctx.fill();
  ctx.strokeStyle='rgba(255,255,255,0.5)'; ctx.lineWidth=2; ctx.stroke();
  ctx.fillStyle='#000'; ctx.font='bold 10px Rajdhani'; ctx.textAlign='center';
  ctx.fillText('GO',cx,cy+4);
}

function openSpinModal(){
  document.getElementById('spin-modal').style.display='flex';
  const today=new Date().toDateString();
  const canSpin=G.lastSpinDate!==today;
  document.getElementById('spin-btn').disabled=!canSpin;
  document.getElementById('spin-btn').style.opacity=canSpin?'1':'0.5';
  document.getElementById('spin-result').textContent=canSpin?'':'Already spun today ‚Äî come back tomorrow!';
  document.getElementById('spin-result').style.color='var(--text2)';
  drawSpinWheel(spinAngle);
}
function closeSpinModal(){document.getElementById('spin-modal').style.display='none';}

function doSpin(){
  const today=new Date().toDateString();
  if(G.lastSpinDate===today){notify('Already spun today!','error');return;}
  if(spinSpinning)return;
  spinSpinning=true;
  document.getElementById('spin-btn').disabled=true;
  document.getElementById('spin-result').textContent='';
  // Pick winner
  const weights=[1,5,8,3,0.5,6,4,0.3,2,7,1,1];
  const total=weights.reduce((s,w)=>s+w,0);
  let roll=Math.random()*total,winIdx=0;
  for(let i=0;i<weights.length;i++){roll-=weights[i];if(roll<=0){winIdx=i;break;}}
  const sliceAngle=(Math.PI*2)/SPIN_PRIZES.length;
  // Target: winning slice at top (angle = -PI/2)
  const targetAngle=-Math.PI/2-(sliceAngle*winIdx+sliceAngle/2);
  const spins=5+Math.random()*3;
  const totalRotation=spins*Math.PI*2+targetAngle-spinAngle;
  const duration=4000,start=performance.now();
  const startAngle=spinAngle;
  const tick=(now)=>{
    const el=performance.now()-start;
    const t=Math.min(1,el/duration);
    const eased=1-Math.pow(1-t,4);
    spinAngle=startAngle+totalRotation*eased;
    drawSpinWheel(spinAngle);
    if(t<1){requestAnimationFrame(tick);}
    else{
      spinSpinning=false;
      G.lastSpinDate=today;
      const prize=SPIN_PRIZES[winIdx];
      document.getElementById('spin-badge').style.display='none';
      if(prize.type==='cash'){
        addBalance(prize.value,'Daily Spin: '+prize.label,'win');
        document.getElementById('spin-result').textContent='üéâ You won '+prize.label+'!';
        playSound('win');
      }else if(prize.type==='xp'){
        addXP(prize.value);
        document.getElementById('spin-result').textContent='üéâ You won '+prize.label+'!';
      }else if(prize.type==='skin_knife'){
        const s=generateSkin('knife','Daily Spin');G.inventory.push(s);
        renderInventory();showKnifeOverlay(s);spawnParticles();
        document.getElementById('spin-result').textContent='üî™ You got a KNIFE: '+s.name+'!';
        playSound('knife');
      }else if(prize.type==='skin_covert'){
        const s=generateSkin('covert','Daily Spin');G.inventory.push(s);renderInventory();
        document.getElementById('spin-result').textContent='‚ö° You got: '+s.name+'!';
        playSound('rare');
      }else if(prize.type==='skin_random'){
        const s=generateSkin(rollRarity(),'Daily Spin');G.inventory.push(s);renderInventory();
        document.getElementById('spin-result').textContent='üéÅ You got: '+s.name+'!';
      }
      document.getElementById('spin-result').style.color=prize.color;
      saveGame();
    }
  };
  requestAnimationFrame(tick);
}


// ============================================================
// SPECIAL UI UPDATES (streak, spin badge)
// ============================================================
function updateSpecialUI(){
  if(!G)return;
  const streak=G.winStreak||0;
  const el=document.getElementById('streak-stat');
  if(el)el.style.display=streak>=2?'flex':'none';
  const sv=document.getElementById('streak-val');
  if(sv)sv.textContent=streak+'üî•';
  const today=new Date().toDateString();
  const badge=document.getElementById('spin-badge');
  if(badge)badge.style.display=G.lastSpinDate===today?'none':'inline';
}
setInterval(updateSpecialUI,1000);

document.addEventListener('DOMContentLoaded',()=>{
  const sfx=document.getElementById('sfx-toggle');
  if(sfx)sfx.checked=G?.sfxOn!==false;
  const knob=document.getElementById('sfx-knob');
  const track=knob?.previousElementSibling;
  if(knob&&track){
    document.getElementById('sfx-toggle').addEventListener('change',function(){
      knob.style.transform=this.checked?'translateX(20px)':'translateX(0)';
      track.style.background=this.checked?'var(--accent)':'var(--bg5)';
    });
  }
});
</script>
</body>
</html>
